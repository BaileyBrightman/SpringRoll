/*! CloudKidFramework 0.0.3 */
!function(){"use strict";!function(){var a=function(a,b,c){this.initialize(a,b,c)},b=a.prototype;a.TASK_ABOUT_TO_START="onItemAboutToLoad",a.TASK_STARTING="onItemLoading",a.TASK_DONE="onItemLoaded",b.task=null,b.data=null,b.type=null,b.initialize=function(a,b,c){this.type=a,this.task=b,this.data=c},namespace("cloudkid").TaskEvent=a}(),function(){var a=function(a,b){this.initialize(a,b)},b=a.prototype;b.id=null,b.callback=null,b._isDestroyed=!1,b.initialize=function(a,b){this.id=a,this.callback=b},b.done=function(a,b){this.callback&&this.callback(a,this,b)},b.start=function(){Debug.assert(!1,"Base implementation of Task cannot be called")},b.cancel=function(){return!0},b.toString=function(){return"[Task ID ("+this.id+")]"},b.destroy=function(){this._isDestroyed||(this._isDestroyed=!0,this.callback=null,this.id=null)},namespace("cloudkid").Task=a}(),function(){var a=cloudkid.Task,b=function(a,b,c,d){this.initialize(a,b,c,d)},c=b.prototype=new a;c.Task_initialize=c.initialize,c.Task_destroy=c.destroy,c.serviceCall=null,c.args=null,c.initialize=function(a,b,c,d){if(this.Task_initialize(a,c),this.serviceCall=b,this.args=[],d){var e=Array.prototype.slice.call(arguments);this.args=e.slice(3)}},c.start=function(a){this.serviceCall.apply(null,[a].concat(this.args))},c.toString=function(){return"[FunctionTask ID ("+this.id+")]"},c.destroy=function(){this._isDestroyed||(this.Task_destroy(),this.serviceCall=null,this.args=null)},namespace("cloudkid").FunctionTask=b}(),function(a){var b=cloudkid.MediaLoader,c=cloudkid.Task,d=cloudkid.LoaderQueueItem,e=function(a,b,c,d,e,f){this.initialize(a,b,c,d,e,f)},f=e.prototype=new c;f.Task_initialize=f.initialize,f.Task_destroy=f.destroy,f.url=null,f.data=null,f.priority=null,f.updateCallback=null,f.initialize=function(b,c,e,f,g,h){this.url=c,this.updateCallback=f,this.priority=g===a?d.PRIORITY_NORMAL:g,this.data=h,this.Task_initialize(b,e)},f.start=function(a){b.instance.load(this.url,a,this.updateCallback,this.priority,this.data)},f.cancel=function(){return b.instance.cancel(this.url)},f.toString=function(){return"[LoadTask ID ("+this.id+"), URL ("+this.url+")]"},f.destroy=function(){this._isDestroyed||(this.Task_destroy(),this.updateCallback=null,this.url=null,this.data=null)},namespace("cloudkid").LoadTask=e}(),function(){var a=cloudkid.TaskEvent,b=function(a){this.initialize(a)},c=b.prototype;c.addEventListener=null,c.removeEventListener=null,c.removeAllEventListeners=null,c.dispatchEvent=null,c.hasEventListener=null,c._listeners=null,createjs.EventDispatcher&&createjs.EventDispatcher.initialize(c),b.VERSION="${version}",b.ALL_TASKS_DONE="onAllTasksDone",c.tasks=null,c._currentTasks=null,c.paused=!0,c._tasksInProgress=0,c._isDestroyed=!1,b.process=function(a,c,d,e){e=e||!0,d=d||!0;var f=b.ALL_TASKS_DONE,g=new b(a);return g.addEventListener(f,function(){g.removeEventListener(f),e&&g.destroy(),null!==c&&c()}),d?g.startAll():g.startNext(),g},c.initialize=function(a){this._currentTasks=[],this.tasks=a||[]},c.addTask=function(a){this.tasks.push(a)},c.addTasks=function(a){this.removeAll(),this.tasks=a},c.removeAll=function(){this._tasksInProgress=0,this.paused=!0;var a,b;if(this._currentTasks&&this._currentTasks.length>0)for(b=0;b<this._currentTasks.length;b++)a=this._currentTasks[b],a.cancel()&&a.destroy();if(this.tasks&&this.tasks.length>0)for(b=0;b<this.tasks.length;b++)a=this.tasks[b],a.destroy();this._currentTasks.length=0,this.tasks.length=0},c.cancelTask=function(a){var b;for(b=0;b<this._currentTasks.length;++b)this._currentTasks[b].id==a&&this._currentTasks[b].cancel()&&(this._currentTasks[b].destroy(),this._currentTasks.splice(b,1),--this._tasksInProgress,--b);for(b=0;b<this.tasks.length;++b)this.tasks[b].id==a&&(this.tasks[b].destroy(),this.tasks.splice(b,1),--b)},c.startNext=function(){if(!this._isDestroyed){Debug.assert(!!this.tasks,"startNext(): There are no task for this Task Manager");for(var b;this.tasks.length>0&&!(b=this.tasks.shift()););return b?(this._currentTasks.push(b),this.paused=!1,this.dispatchEvent(new a(a.TASK_ABOUT_TO_START,b)),this.paused?null:(this.dispatchEvent(new a(a.TASK_STARTING,b)),this._tasksInProgress++,b.start(this.onTaskDone.bind(this,b)),b)):null}},c.onTaskDone=function(c,d){if(!this._isDestroyed){this._tasksInProgress--,this.dispatchEvent(new a(a.TASK_DONE,c,d)),c.done(d,this);var e=this._currentTasks.indexOf(c);e>-1&&this._currentTasks.splice(e,1),c.destroy(),0===this._tasksInProgress&&0===this.tasks.length?this.dispatchEvent(new a(b.ALL_TASKS_DONE,null)):this.paused||this.startNext()}},c.startAll=function(){Debug.assert(!!this.tasks,"startAll(): There are no task for this Task Manager");for(var a=[];;){var b=this.startNext();if(!b)break;a.push(b)}return a},c.destroy=function(){this._isDestroyed||(this._isDestroyed=!0,this.removeAll(),this._currentTasks=null,this.tasks=null)},namespace("cloudkid").TaskManager=b}(),function(){var a=cloudkid.Task,b=cloudkid.LoadTask,c=cloudkid.TaskEvent,d=cloudkid.TaskManager,e=function(a,b,c){this.initialize(a,b,c)},f=e.prototype=new a;f.Task_initialize=f.initialize,f.Task_destroy=f.destroy,f.list=null,f._manager=null,f._results=null,f.initialize=function(c,d,e){this.Task_initialize(c,e);for(var f=[],g=0;g<d.length;g++)d[g]&&(d[g]instanceof a?f.push(d[g]):d[g].id&&d[g].src&&f.push(new b(d[g].id,d[g].src,d[g].callback,d[g].updateCallback,d[g].priority,d[g].data)));this.list=f},f.start=function(a){this._results={},this._manager=new d(this.list.slice()),this._manager.addEventListener(c.TASK_DONE,this._onTaskDone.bind(this)),this._manager.addEventListener(d.ALL_TASKS_DONE,this._onAllTasksComplete.bind(this,a)),this._manager.startAll()},f._onTaskDone=function(a){this._isDestroyed||(this._results[a.task.id]=a.data)},f._onAllTasksComplete=function(a){this._isDestroyed||a(this._results)},f.cancel=function(){return this._manager.removeAll(),!0},f.toString=function(){return"[ListTask ID ("+this.id+"), tasks ("+this.list+")]"},f.destroy=function(){if(!this._isDestroyed){this.Task_destroy(),this._results=null;for(var a=0;a<this.list.length;a++)this.list[a].destroy();this._manager&&(this._manager.destroy(),this._manager=null),this.list=null}},namespace("cloudkid").ListTask=e}(),function(){var a=function(a,b,c,d,e){this.initialize(a,b,c,d,e)},b=a.prototype=new cloudkid.Task;b.Task_initialize=b.initialize,b.Task_destroy=b.destroy,b.urls=null,b.updateCallback=null,b.generateCanvas=!1,b._assetLoader=null,b.initialize=function(a,b,c,d,e){for(var f=cloudkid.MediaLoader.instance.cacheManager,g=0;g<b.length;++g)b[g]=f.prepare(b[g]);this.urls=b,this.updateCallback=d,this.generateCanvas=e||!1,this.Task_initialize(a,c)},b.start=function(a){var b=cloudkid.Application.instance.options;this._assetLoader=new PIXI.AssetLoader(this.urls,b.crossOrigin,this.generateCanvas,b.basePath),this._assetLoader.onComplete=a,this.updateCallback&&(this._assetLoader.onProgress=this.onProgress.bind(this)),this._assetLoader.load()},b.onProgress=function(){this.updateCallback()},b.cancel=function(){return this._assetLoader.onComplete=null,this._assetLoader.onProgress=null,!0},b.toString=function(){return"[PixiTask ID ("+this.id+"), URLs ("+this.urls.join(", ")+")]"},b.destroy=function(){this._isDestroyed||(this.Task_destroy(),this.updateCallback=null,this.urls=null,this._assetLoader&&(this._assetLoader.onComplete=null,this._assetLoader.onProgress=null),this._assetLoader=null)},namespace("cloudkid").PixiTask=a}();}();