/*! CloudKidFramework 0.0.6 */
!function(){"use strict";!function(){var a=function(a,b,c){this.task=b,this.data=c,this.type=a};a.TASK_ABOUT_TO_START="onItemAboutToLoad",a.TASK_STARTING="onItemLoading",a.TASK_DONE="onItemLoaded",namespace("cloudkid").TaskEvent=a}(),function(){var a=function(a,b){this.id=a,this.callback=b,this._isDestroyed=!1},b=a.prototype;b.done=function(a,b){this.callback&&this.callback(a,this,b)},b.start=function(){Debug.assert(!1,"Base implementation of Task cannot be called")},b.cancel=function(){return!0},b.toString=function(){return"[Task ID ("+this.id+")]"},b.destroy=function(){this._isDestroyed||(this._isDestroyed=!0,this.callback=null,this.id=null)},namespace("cloudkid").Task=a}(),function(){var a=include("cloudkid.Task"),b=function(b,c,d,e){if(a.call(this,b,d),this.serviceCall=c,this.args=null,e){var f=Array.prototype.slice.call(arguments);this.args=f.slice(3)}},c=a.prototype,d=b.prototype=Object.create(c);d.start=function(a){this.serviceCall.apply(null,[a].concat(this.args))},d.toString=function(){return"[FunctionTask ID ("+this.id+")]"},d.destroy=function(){this._isDestroyed||(c.destroy.call(this),this.serviceCall=null,this.args=null)},namespace("cloudkid").FunctionTask=b}(),function(a){var b,c,d=include("cloudkid.Task"),e=function(e,f,g,h,i,j){b||(b=include("cloudkid.Loader"),c=include("cloudkid.LoaderQueueItem")),d.call(this,e,g),this.url=f,this.data=j,this.priority=i===a?c.PRIORITY_NORMAL:i,this.updateCallback=h},f=d.prototype,g=e.prototype=Object.create(f);g.start=function(a){b.instance.load(this.url,a,this.updateCallback,this.priority,this.data)},g.cancel=function(){return b.instance.cancel(this.url)},g.toString=function(){return"[LoadTask ID ("+this.id+"), URL ("+this.url+")]"},g.destroy=function(){this._isDestroyed||(f.destroy.call(this),this.updateCallback=null,this.url=null,this.data=null)},namespace("cloudkid").LoadTask=e}(),function(){var a,b=include("cloudkid.EventDispatcher"),c=function(c){a||(a=include("cloudkid.TaskEvent")),b.call(this),this.tasks=c||[],this._currentTasks=[],this.paused=!0,this._tasksInProgress=0,this._isDestroyed=!1},d=c.prototype=Object.create(b.prototype);c.VERSION="${version}",c.ALL_TASKS_DONE="onAllTasksDone",c.process=function(a,b,d,e){e=e||!0,d=d||!0;var f=c.ALL_TASKS_DONE,g=new c(a);return g.on(f,function(){g.off(f),e&&g.destroy(),null!==b&&b()}),d?g.startAll():g.startNext(),g},d.addTask=function(a){this.tasks.push(a)},d.addTasks=function(a){this.removeAll(),this.tasks=a},d.removeAll=function(){this._tasksInProgress=0,this.paused=!0;var a,b;if(this._currentTasks&&this._currentTasks.length>0)for(b=0;b<this._currentTasks.length;b++)a=this._currentTasks[b],a.cancel()&&a.destroy();if(this.tasks&&this.tasks.length>0)for(b=0;b<this.tasks.length;b++)a=this.tasks[b],a.destroy();this._currentTasks.length=0,this.tasks.length=0},d.cancelTask=function(a){var b;for(b=0;b<this._currentTasks.length;++b)this._currentTasks[b].id==a&&this._currentTasks[b].cancel()&&(this._currentTasks[b].destroy(),this._currentTasks.splice(b,1),--this._tasksInProgress,--b);for(b=0;b<this.tasks.length;++b)this.tasks[b].id==a&&(this.tasks[b].destroy(),this.tasks.splice(b,1),--b)},d.startNext=function(){if(!this._isDestroyed){Debug.assert(!!this.tasks,"startNext(): There are no task for this Task Manager");for(var b;this.tasks.length>0&&!(b=this.tasks.shift()););return b?(this._currentTasks.push(b),this.paused=!1,this.has(a.TASK_ABOUT_TO_START)&&this.trigger(a.TASK_ABOUT_TO_START,new a(a.TASK_ABOUT_TO_START,b)),this.paused?null:(this.has(a.TASK_STARTING)&&this.trigger(a.TASK_STARTING,new a(a.TASK_STARTING,b)),this._tasksInProgress++,b.start(this.onTaskDone.bind(this,b)),b)):null}},d.onTaskDone=function(b,d){if(!this._isDestroyed){this._tasksInProgress--,this.has(a.TASK_DONE)&&this.trigger(a.TASK_DONE,new a(a.TASK_DONE,b,d)),b.done(d,this);var e=this._currentTasks.indexOf(b);e>-1&&this._currentTasks.splice(e,1),b.destroy(),0===this._tasksInProgress&&0===this.tasks.length?this.trigger(c.ALL_TASKS_DONE):this.paused||this.startNext()}},d.startAll=function(){Debug.assert(!!this.tasks,"startAll(): There are no task for this Task Manager");for(var a=[];;){var b=this.startNext();if(!b)break;a.push(b)}return a},d.destroy=function(){this._isDestroyed||(this._isDestroyed=!0,this.off(),this.removeAll(),this._currentTasks=null,this.tasks=null)},namespace("cloudkid").TaskManager=c}(),function(){var a=include("cloudkid.Task"),b=include("cloudkid.LoadTask"),c=include("cloudkid.TaskEvent"),d=include("cloudkid.TaskManager"),e=function(c,d,e){a.call(this,c,e),this._manager=null,this._results=null;for(var f=[],g=0;g<d.length;g++)d[g]&&(d[g]instanceof a?f.push(d[g]):d[g].id&&d[g].src&&f.push(new b(d[g].id,d[g].src,d[g].callback,d[g].updateCallback,d[g].priority,d[g].data)));this.list=f},f=a.prototype,g=e.prototype=Object.create(f);g.start=function(a){this._results={},this._manager=new d(this.list.slice()),this._manager.on(c.TASK_DONE,this._onTaskDone.bind(this)),this._manager.on(d.ALL_TASKS_DONE,this._onAllTasksComplete.bind(this,a)),this._manager.startAll()},g._onTaskDone=function(a){this._isDestroyed||(this._results[a.task.id]=a.data)},g._onAllTasksComplete=function(a){this._isDestroyed||a(this._results)},g.cancel=function(){return this._manager.removeAll(),!0},g.toString=function(){return"[ListTask ID ("+this.id+"), tasks ("+this.list+")]"},g.destroy=function(){if(!this._isDestroyed){f.destroy.call(this),this._results=null;for(var a=0;a<this.list.length;a++)this.list[a].destroy();this._manager&&(this._manager.destroy(),this._manager=null),this.list=null}},namespace("cloudkid").ListTask=e}(),function(){var a,b,c,d=include("cloudkid.Task"),e=function(e,f,g,h,i){a||(c=include("PIXI.AssetLoader"),a=include("cloudkid.Loader"),b=include("cloudkid.Application")),d.call(this,e,g),this.updateCallback=h,this.generateCanvas=i||!1,this._assetLoader=null;for(var j=a.instance.cacheManager,k=0;k<f.length;++k)f[k]=j.prepare(f[k]);this.urls=f},f=d.prototype,g=e.prototype=Object.create(f);g.start=function(a){var d=b.instance.options;this._assetLoader=new c(this.urls,d.crossOrigin,this.generateCanvas,d.basePath),this._assetLoader.onComplete=a,this.updateCallback&&(this._assetLoader.onProgress=this.onProgress.bind(this)),this._assetLoader.load()},g.onProgress=function(){this.updateCallback()},g.cancel=function(){return this._assetLoader.onComplete=null,this._assetLoader.onProgress=null,!0},g.toString=function(){return"[PixiTask ID ("+this.id+"), URLs ("+this.urls.join(", ")+")]"},g.destroy=function(){this._isDestroyed||(f.destroy.call(this),this.updateCallback=null,this.urls=null,this._assetLoader&&(this._assetLoader.onComplete=null,this._assetLoader.onProgress=null),this._assetLoader=null)},namespace("cloudkid").PixiTask=e}();}();