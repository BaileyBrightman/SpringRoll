/*! SpringRoll 0.2.0 */
!function(){"use strict";!function(){var a=function(){},b=a.prototype;b._filters=[],b.add=function(a,b){if(!a||"string"!=typeof a&&a instanceof RegExp==!1)throw"invalide replace value";if("string"!=typeof b)throw"invalid replacement value";if(this._filters){for(var c=this._filters.length-1;c>=0;c--)if(a.toString()==this._filters[c].replace.toString())throw"Filter already exists.";this._filters.push({replace:a,replacement:b})}},b.filter=function(a){if(!this._filters)return a;for(var b=this._filters.length-1;b>=0;b--){var c=this._filters[b].replace,d=this._filters[b].replacement;a=a.replace(c,d)}return a},b.destroy=function(){this._filters=null},namespace("springroll").StringFilters=a}(),function(){var a=(include("springroll.Debug",!1),include("springroll.StringFilters"),function(a){this.filters=a.filters,this.tracker=a.tracker,this.player=a.player,this.display=a.display}),b=a.prototype;b.playMovie=function(a,b,c,d){return this.tracker?this.trackMoviePlay(a,b,c,d,"movie"):this.display.animator.play(a,b,options)},b.playInstruction=function(a,b,c,d){var e=this.tracker,f=this.display.animator;return f.canAnimate(a)?e?this.trackMoviePlay(a,b,c,d,"instruction"):f.play(a,b,c,d):(d=c,c=b,b=a,e?void this.trackVOPlay(b,e.startInstruction,e.endInstruction,c,d):void this.player.play(b,c,d))},b.playIncorrectFeedback=function(a,b,c,d){var e=this.tracker,f=this.display.animator;return f.canAnimate(a)?e?this.trackMoviePlay(a,b,c,d,"incorrect"):f.play(a,b,c,d):(d=c,c=b,b=a,e?void this.trackVOPlay(b,e.startIncorrectFeedback,e.endIncorrectFeedback,c,d):void this.player.play(b,c,d))},b.playCorrectFeedback=function(a,b,c,d){var e=this.tracker,f=this.display.animator;return f.canAnimate(a)?e?this.trackMoviePlay(a,b,c,d,"correct"):f.play(a,b,c,d):(d=c,c=b,b=a,e?void this.trackVOPlay(b,e.startCorrectFeedback,e.endCorrectFeedback,c,d):void this.player.play(b,c,d))},b.trackVOPlay=function(a,b,d,e,f){var g=this.display.animator;this.player.stop(),this._trackerAnimatorInstance&&g.stop(this._trackerAnimatorInstance);var h=this.player.captions,i=function(a){d.call(this.tracker),a&&a()};f===!0&&(f=e),this.player.play(a,i.bind(this,e),i.bind(this,f)),b.call(this.tracker,h.getFullCaption(a),c(a),"audio",h.getLength(a))},b.trackMoviePlay=function(a,b,c,d,e){var f=this.tracker,g=this.display.animator;this.player.stop(),this._trackerAnimatorInstance&&g.stop(this._trackerAnimatorInstance),Array.isArray(b)||(b=[b]);for(var h,i,j,k,l,m,n,o=0,p="",q="",r=this.player.captions,s=0,t=b.length;t>s;++s){switch(h=b[s],n=null,m=null,typeof h){case"number":o+=h;break;case"string":h=this.filters.filter(h),o+=g.getDuration(a,h),n=h,m=r.getFullCaption(h),b[s]={anim:h,audio:h};break;case"object":h.anim=i=this.filters.filter(h.anim),h.audio&&("object"==typeof h.audio?h.audio.alias=j=this.filters.filter(h.audio.alias):h.audio=j=this.filters.filter(h.audio)),o+=g.getDuration(a,i),j?"string"!=typeof j&&(j=j.alias):j=i,m=r.getFullCaption(j),n=j}n&&(q.length>0&&(q+=","),q+=n),m&&(p.length>0&&(p+=" "),p+=m)}switch(o=0|o,e){case"instruction":f.startInstruction(p,q,"animation",o),k=f.endInstruction.bind(f);break;case"correct":f.startCorrectFeedback(p,q,"animation",o),k=f.endCorrectFeedback.bind(f);break;case"incorrect":f.startIncorrectFeedback(p,q,"animation",o),k=f.endIncorrectFeedback.bind(f);break;case"movie":f.startMovie(q,o,p),k=f.endMovie.bind(f),l=f.skipMovie.bind(f)}var u=function(a,b){this._trackerAnimatorInstance=null,a&&a(),b&&b()},v=u.bind(this,k,c),w=u.bind(this,l?l:k,d===!0?c:d);return this._trackerAnimatorInstance=a,g.play(a,b,v,w)};var c=function(a){if(Array.isArray(a)){for(var b="",c=0,d=a.length;d>c;++c)"string"==typeof a[c]&&(b.length>0&&(b+=","),b+=a[c]);return b}return String(a)};b.stop=function(){this._trackerAnimatorInstance?this.display.animator.stop(this._trackerAnimatorInstance):this.player.stop()},b.isPlaying=function(){return this.player.playing||!!this._trackerAnimatorInstance},b.destroy=function(){this.tracker=null,this.player=null},namespace("springroll").TrackingGameMedia=a}(),function(){var a,b,c=include("springroll.Game"),d=include("springroll.Debug",!1),e=include("springroll.Captions"),f=(include("springroll.Application"),include("springroll.Sound")),g=include("Bellhop"),h=include("springroll.TaskManager"),i=include("springroll.LoadTask"),j=include("springroll.UIScaler"),k=include("springroll.TrackingGameMedia"),l=include("springroll.StringFilters"),m=include("springroll.PageVisibility"),n=function(d){b=include("springroll.HintPlayer",!1),a=include("springroll.ProgressTracker",!1),d=d||{};var e={captions:"captions",captionsPath:"assets/config/captions.json",configPath:"assets/config/config.json",debug:!1,parseQueryString:!1,cacheBust:!1,canvasId:"stage",resizeElement:"frame",singlePlay:!1,playOptions:null};if(c.call(this,Object.merge(e,d)),!this.name)throw"TrackingGame name is undefined";if(this.tracker=null,this.filters=null,this.scaler=null,this.config=null,this.media=null,this.singlePlay=!!this.options.singlePlay,this.playOptions=this.options.playOptions||{},this.messenger=new g,this.messenger.connect(),this.messenger.supported){var f=this.messenger;f.on({soundMuted:C,captionsMuted:D,musicMuted:E.bind(this,"music"),voMuted:E.bind(this,"vo"),sfxMuted:E.bind(this,"sfx"),captionsStyles:B.bind(this),pause:u.bind(this),singlePlay:v.bind(this),close:x.bind(this)}),this.autoPause=!1,this._pageVisibility=new m(f.send.bind(f,"gameFocus",!0),f.send.bind(f,"gameFocus",!1))}this.hint=b?new b(this):null,this.filters=new l,this.filters.add("%INTERACTION%",this.hasTouch?"_touch":"_mouse"),this.once("soundReady",t.bind(this))},o=c.prototype,p=extend(n,c),q="loaded",r="configLoaded",s="loading",t=function(){this._readyToInit=!1;var a=[new i("config",this.options.configPath,z.bind(this))];this.options.captionsPath&&a.push(new i("captions",this.options.captionsPath,y.bind(this))),this.trigger(s,a),h.process(a,A.bind(this))},u=function(a){this.paused=!!a.data,this.enabled=!this.paused},v=function(a){Object.merge(this.playOptions,a.data||{}),this.singlePlay=!0};p.singlePlayEnd=function(){this.singlePlay&&this.endGame()};var w=function(){return void this.endGame("left_site")},x=function(){this.endGame("closed_container")},y=function(a){this.addCaptions(a.content)},z=function(b,c,d){var e=this.config=b.content,f=e.sounds;f&&(f.vo&&this.addSounds(f.vo),f.sfx&&this.addSounds(f.sfx),f.music&&this.addSounds(f.music)),a&&e.spec&&(this.tracker=new a(this,e.spec,!1,e.specDictionary||null),this.tracker.on("track",this.progressEvent.bind(this)),window.onbeforeunload=w.bind(this)),this.media=new k(this),this.trigger(r,e,d)},A=function(){this.initStates();var a=this.config,b=a.designedSettings;if(!b)throw"'designedSettings' required in config";if(!a.scaling)throw"'scaling' required in config";this.scaler=new j(this,b,a.scaling,!0,this.display),this.messenger.send("loadDone"),this.tracker&&this.tracker.startGame(),this._readyToInit=!0,this.trigger(q),this._doInit()},B=function(a){var b=a.data,c=this.captions||{},d=c.textField||null;d&&d.nodeName&&(d.className="size-"+b.size+" bg-"+b.background+" color-"+b.color+" edge-"+b.edge+" font-"+b.font+" align-"+b.align)},C=function(a){f.instance.muteAll=!!a.data},D=function(a){e.muteAll=!!a.data},E=function(a,b){f.instance.setContextMute(a,!!b.data)};p.progressEvent=function(a){this.messenger.send("progressEvent",a)},p.trackEvent=function(a,b,c){this.messenger.send("trackEvent",{category:this.name,action:a,label:b,value:c})},p.normalizePosition=function(a,b,c){if(a instanceof createjs.Point&&(c=b,b=a.y,a=a.x),c&&c.localToGlobal){var d=c.localToGlobal(a,b);a=d.x,b=d.y}var e=this.display;return{x:0|a,y:0|b,stage_width:e.width,stage_height:e.height}},p.playMovie=function(a,b,c,d){return this.media.playMovie(a,b,c,d)},p.playInstruction=function(a,b,c,d){return this.media.playInstruction(a,b,c,d)},p.playIncorrectFeedback=function(a,b,c,d){return this.media.playIncorrectFeedback(a,b,c,d)},p.playCorrectFeedback=function(a,b,c,d){return this.media.playCorrectFeedback(a,b,c,d)},p.endGame=function(a){window.onbeforeunload=null,this.tracker.endGame(a||"game_completed"),this.destroy()},p.destroy=function(){this.hint&&(this.hint.destroy(),this.hint=null),this.scaler&&(this.scaler.destroy(),this.scaler=null),this.media&&(this.media.destroy(),this.media=null),this._pageVisibility&&(this._pageVisibility.destroy(),this._pageVisibility=null),this.config=null;var a=document.getElementById(this.options.captions);a&&a.parentNode&&a.parentNode.removeChild(a);try{o.destroy.call(this)}catch(b){d?(d.error(b.message),d.error(b.stack)):console.log(b.message,b.stack)}this.tracker&&(this.tracker.destroy(),this.tracker=null),this.messenger.send("endGame"),this.messenger.destroy(),this.messenger=null},namespace("springroll").TrackingGame=n}();}();