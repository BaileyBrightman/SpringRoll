/*! CloudKidFramework 0.0.6 */
!function(){"use strict";!function(){var a,b=function(b){a||(a=include("cloudkid.StateManager")),this.stateId=null,this.manager=null,this.panel=null,this._destroyed=!1,this._active=!1,this._isLoading=!1,this._canceled=!1,this._onEnterProceed=null,this._onLoadingComplete=null,this._enabled=!1,this._isTransitioning=!1,this.initialize(b)},c=b.prototype;c.initialize=function(a){this.panel=a},c.getCanceled=function(){return this._canceled},c._internalExit=function(){this._isTransitioning&&(this._isTransitioning=!1,this.manager._display.animator.stop(this.panel)),this._enabled=!1,this.panel.visible=!1,this._active=!1,this.exit()},c.exit=function(){},c._internalExitStart=function(){this.exitStart()},c.exitStart=function(){},c._internalEnter=function(a){this._isTransitioning&&(this._isTransitioning=!1,this.manager._display.animator.stop(this.panel)),this._enabled=!1,this._active=!0,this._canceled=!1,this._onEnterProceed=a,this.enter(),this._onEnterProceed&&(this._onEnterProceed(),this._onEnterProceed=null)},c.loadingStart=function(){return this._isLoading?void Debug.warn("loadingStart() was called while we're already loading"):(this._isLoading=!0,this.manager.loadingStart(),this._onLoadingComplete=this._onEnterProceed,void(this._onEnterProceed=null))},c.loadingDone=function(){return this._isLoading?(this._isLoading=!1,this.manager.loadingDone(),void(this._onLoadingComplete&&(this._onLoadingComplete(),this._onLoadingComplete=null))):void Debug.warn("loadingDone() was called without a load started, call loadingStart() first")},c._internalCancel=function(){this._active=!1,this._canceled=!0,this._isLoading=!1,this._internalExit(),this.cancel()},c.cancel=function(){},c.enter=function(){},c._internalEnterDone=function(){this._canceled||(this.setEnabled(!0),this.enterDone())},c.enterDone=function(){},c.getActive=function(){return this._active},c.transitionIn=function(b){this._isTransitioning=!0;var c=this;this.manager._display.animator.play(this.panel,a.TRANSITION_IN,function(){c._isTransitioning=!1,b()})},c.transitionOut=function(b){this._enabled=!1,this._isTransitioning=!0;var c=this;this.manager._display.animator.play(this.panel,a.TRANSITION_OUT,function(){c._isTransitioning=!1,b()})},c.getDestroyed=function(){return this._destroyed},c.setEnabled=function(a){this._enabled=a},c.getEnabled=function(){return this._enabled},c.destroy=function(){this.exit(),this.panel=null,this.manager=null,this._destroyed=!0,this._onEnterProceed=null,this._onLoadingComplete=null},namespace("cloudkid").BaseState=b}(),function(a){{var b=function(b,c,d){this.currentState=c,this.visibleState=d===a?c:d,this.type=b};b.prototype}b.TRANSITION_IN="onTransitionStateIn",b.TRANSITION_IN_DONE="onTransitionStateInDone",b.TRANSITION_OUT="onTransitionStateOut",b.TRANSITION_OUT_DONE="onTransitionStateOutDone",b.VISIBLE="onVisible",b.HIDDEN="onHidden",namespace("cloudkid").StateEvent=b}(),function(a){var b=include("cloudkid.EventDispatcher"),c=(include("cloudkid.BaseState"),include("cloudkid.StateEvent")),d=function(a,c,d){b.call(this),this._display=a,this._transition=c,this._transitionSounds=d||null,this._states=null,this._state=null,this._stateId=null,this._oldState=null,this._isLoading=!1,this._isTransitioning=!1,this._destroyed=!1,this._queueStateId=null,this.initialize()},e=d.prototype=Object.create(b.prototype);d.VERSION="${version}",d.TRANSITION_IN="onTransitionIn",d.TRANSITION_IN_DONE="onTransitionInDone",d.TRANSITION_OUT="onTransitionOut",d.TRANSITION_OUT_DONE="onTransitionOutDone",d.TRANSITION_INIT_DONE="onInitDone",d.LOADING_START="onLoadingStart",d.LOADING_DONE="onLoadingDone",e.initialize=function(){this._transition.stop&&this._transition.stop(),this.hideBlocker(),this._states={},this._loopTransition=this._loopTransition.bind(this)},e.addState=function(a,b){this._states[a]=b,b.stateId=a,b.manager=this,b._internalExit()},e.changeTransition=function(a){this._transition=a},e.getState=function(){return this._stateId},e.getCurrentState=function(){return this._state},e.getStateById=function(b){return Debug.assert(this._states[b]!==a,"No alias matching "+b),this._states[b]},e.isBusy=function(){return this._isLoading||this._isTransitioning},e.loadingStart=function(){this._destroyed||(this.trigger(d.LOADING_START),this._loopTransition())},e.loadingDone=function(){this._destroyed||this.trigger(d.LOADING_DONE)},e.showBlocker=function(){this._display.enabled=!1},e.hideBlocker=function(){this._display.enabled=!0},e.refresh=function(){Debug.assert(!!this._state,"No current state to refresh!"),this.setState(this._stateId)},e.setState=function(b){if(Debug.assert(this._states[b]!==a,"No current state mattching id '"+b+"'"),this._isTransitioning)return void(this._queueStateId=b);this._stateId=b,this.showBlocker(),this._oldState=this._state,this._state=this._states[b];var e;this._oldState?this._isLoading?(this._oldState._internalCancel(),this._isLoading=!1,this._state._internalEnter(this._onStateLoaded)):(this._isTransitioning=!0,this._oldState._internalExitStart(),this.showBlocker(),e=this,this.has(c.TRANSITION_OUT)&&this.trigger(c.TRANSITION_OUT,new c(c.TRANSITION_OUT,this._state,this._oldState)),this._oldState.transitionOut(function(){e.has(c.TRANSITION_OUT_DONE)&&e.trigger(c.TRANSITION_OUT_DONE,new c(c.TRANSITION_OUT_DONE,e._state,e._oldState)),e.trigger(d.TRANSITION_OUT),e._transitioning(d.TRANSITION_OUT,function(){e.trigger(d.TRANSITION_OUT_DONE),e._isTransitioning=!1,e.has(c.HIDDEN)&&e.trigger(c.HIDDEN,new c(c.HIDDEN,e._state,e._oldState)),e._oldState.panel.visible=!1,e._oldState._internalExit(),e._oldState=null,e._loopTransition(),e._processQueue()||(e._isLoading=!0,e._state._internalEnter(e._onStateLoaded.bind(e)))})})):(this._isTransitioning=!0,this._transition.visible=!0,e=this,this._loopTransition(),e.trigger(d.TRANSITION_INIT_DONE),e._isLoading=!0,e._state._internalEnter(e._onStateLoaded.bind(e)))},e._onStateLoaded=function(){this._isLoading=!1,this._isTransitioning=!0,this.has(c.VISIBLE)&&this.trigger(c.VISIBLE,new c(c.VISIBLE,this._state)),this._state.panel.visible=!0,this.trigger(d.TRANSITION_IN);var a=this;this._transitioning(d.TRANSITION_IN,function(){a._transition.visible=!1,a.trigger(d.TRANSITION_IN_DONE),a.has(c.TRANSITION_IN)&&a.trigger(c.TRANSITION_IN,new c(c.TRANSITION_IN,a._state)),a._state.transitionIn(function(){a.has(c.TRANSITION_IN_DONE)&&a.trigger(c.TRANSITION_IN_DONE,new c(c.TRANSITION_IN_DONE,a._state)),a._isTransitioning=!1,a.hideBlocker(),a._processQueue()||a._state._internalEnterDone()})})},e._processQueue=function(){if(this._queueStateId){var a=this._queueStateId;return this._queueStateId=null,this.setState(a),!0}return!1},e._loopTransition=function(){var a,b=this._display.animator;if(this._transitionSounds){a=this._transitionSounds.loop;var c=b.soundLib;c&&c.instance.soundLoaded!==!1||(a=null)}b.instanceHasAnimation(this._transition,"transitionLoop")&&b.play(this._transition,"transitionLoop",{onComplete:this._loopTransition,soundData:a})},e.showTransitionOut=function(a){this.showBlocker();var b=this,c=function(){b._loopTransition(),a&&a()};this._transitioning(d.TRANSITION_OUT,c)},e.showTransitionIn=function(a){var b=this;this._transitioning(d.TRANSITION_IN,function(){b.hideBlocker(),a&&a()})},e._transitioning=function(a,b){var c=this._transition;c.visible=!0;var e,f=this._display.animator;if(this._transitionSounds){e=a==d.TRANSITION_IN?this._transitionSounds.in:this._transitionSounds.out;var g=f.soundLib;g&&g.instance.soundLoaded!==!1||(e=null)}f.play(this._transition,a,{onComplete:b,soundData:e})},e.destroy=function(){if(this._destroyed=!0,this.off(),this._display.animator.stop(this._transition),this._transition=null,this._state=null,this._oldState=null,this._states)for(var a in this._states)this._states[a].destroy(),delete this._states[a];this._states=null},namespace("cloudkid").StateManager=d}();}();