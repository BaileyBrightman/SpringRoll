/*! SpringRoll 0.4.8 */
!function(){"use strict";!function(){var a=include("springroll.SavedData"),b=include("springroll.Application"),c=function(){this.container=null,this.id=""},d=extend(c);d.read=function(c,d){if(!this.container||!this.container.supported){var e=b.instance.options.name||"";return d(a.read(e+c))}this.container.fetch("userDataRead",function(a){d(a.data)},this.id+c,!0)},d.write=function(c,d,e){if(!this.container||!this.container.supported){var f=b.instance.options.name||"";return a.write(f+c,d),void(e&&e())}this.container.fetch("userDataWrite",function(a){e&&e()},{name:this.id+c,value:d},!0)},d.remove=function(c,d){if(!this.container||!this.container.supported){var e=b.instance.options.name||"";return a.remove(e+c),void(d&&d())}this.container.fetch("userDataRemove",function(a){d&&d()},this.id+c,!0)},d.destroy=function(){this.container=null},namespace("springroll").UserData=c}(),function(a){var b=include("springroll.ApplicationPlugin"),c=include("springroll.PageVisibility"),d=include("springroll.UserData"),e=include("Bellhop"),f=new b(50);f.setup=function(){var a=this.options,b=this.container=new e;b.connect(),this.userData=new d,a.add("keepFocus",!1).on("keepFocus",function(a){b.send("keepFocus",a)}),this.once("beforeInit",function(){b.send("loadDone")}),this.singlePlay=!1,this.playOptions={},this.singlePlayEnd=function(){return this.singlePlay?(this.endGame(),!0):!1},this.endGame=function(a){this.trigger("endGame",a||"game_completed"),this.destroy()},b.supported&&(b.fetch("singlePlay",o.bind(this)),b.fetch("playOptions",n.bind(this))),window.onerror=h.bind(this),window.onunload=window.onbeforeunload=g.bind(this)};var g=function(){return window.onunload=window.onbeforeunload=null,this.endGame("left_site"),a},h=function(a){return this.container.supported?(this.container.send("localError",String(a)),!0):void 0};f.preload=function(a){if(!this.name)throw"Application name is empty";if(this.container.supported){this.userData.id=this.name,this.userData.container=this.container,this.container.on({soundMuted:j.bind(this),captionsMuted:k.bind(this),musicMuted:l.bind(this,"music"),voMuted:l.bind(this,"vo"),sfxMuted:l.bind(this,"sfx"),captionsStyles:m.bind(this),pause:i.bind(this),close:p.bind(this)});var b=!!this.sound;this.container.send("features",{sound:b,hints:!!this.hints,music:b&&this.sound.contextExists("music"),vo:b&&this.sound.contextExists("vo"),sfx:b&&this.sound.contextExists("sfx"),captions:!!this.captions}),this.options.autoPause=!1;var d=this.container;this._pageVisibility=new c(d.send.bind(d,"focus",!0),d.send.bind(d,"focus",!1))}a()};var i=function(a){var b=!!a.data;this.autoPaused=b,this.enabled=!b},j=function(a){this.sound&&(this.sound.muteAll=!!a.data)},k=function(a){this.captions&&(this.captions.mute=!!a.data)},l=function(a,b){this.sound&&this.sound.setContextMute(a,!!b.data)},m=function(a){var b=a.data,c=this.captions||{},d=c.textField||null;d&&d.nodeName&&(d.className="size-"+b.size+" bg-"+b.background+" color-"+b.color+" edge-"+b.edge+" font-"+b.font+" align-"+b.align)},n=function(a){Object.merge(this.playOptions,a.data||{})},o=function(a){this.singlePlay=!!a.data},p=function(){this.endGame("closed_container")};f.teardown=function(){window.onerror=null,this._pageVisibility&&(this._pageVisibility.destroy(),this._pageVisibility=null),this.userData&&(this.userData.destroy(),this.userData=null),this.container&&(this.container.send("endGame"),this.container.destroy(),this.container=null)}}();}();