/*! CloudKidFramework 0.0.4 */
!function(){"use strict";!function(){var a=function(a){this.id=a,this.volume=1,this.muted=!1,this.sounds=[]};a.prototype={},namespace("cloudkid").SoundContext=a}(),function(){var a,b=function(){a=cloudkid.Sound,this._channel=null,this._endFunc=null,this._endCallback=null,this._startFunc=null,this._startParams=null,this.alias=null,this._fTime=0,this._fDur=0,this._fStart=0,this._fEnd=0,this.curVol=0,this.length=0,this.paused=!1,this.isValid=!0},c=b.prototype={};Object.defineProperty(c,"position",{get:function(){return this._channel?this._channel.getPosition():0}}),c.stop=function(){var b=a.instance,c=b._sounds[this.alias];c.playing.splice(c.playing.indexOf(this),1),a.instance._stopInst(this)},c.updateVolume=function(b){if(this._channel){if(void 0===b){var c=a.instance,d=c._sounds[this.alias];if(d.context){var e=c._contexts[d.context];b=e.muted?0:e.volume}else b=1}this._channel.setVolume(b*this.curVol)}},c.pause=function(){this.paused||(this.paused=!0,this._channel&&this._channel.pause())},c.unpause=function(){this.paused&&(this.paused=!1,this._channel&&this._channel.resume())},namespace("cloudkid").SoundInstance=b}(),function(){var a=cloudkid.Task;if(a){var b=function(a,b,c){this.initialize(a,c),this.list=b},c=b.prototype=Object.create(a.prototype);b.s=a.prototype,c.start=function(a){cloudkid.Sound.instance.preload(this.list,a)},c.destroy=function(){b.s.destroy.apply(this),this.list=null},namespace("cloudkid").SoundListTask=b}}(),function(){function a(){document.removeEventListener("touchstart",a),createjs.WebAudioPlugin.playEmptySound()}var b=cloudkid.Application,c=cloudkid.MediaLoader,d=cloudkid.LoadTask,e=cloudkid.SoundContext,f=cloudkid.SoundInstance,g=cloudkid.SoundListTask,h=cloudkid.TaskManager,i=function(){this._sounds={},this._fades=[],this._contexts={},this._pool=[],this._update=this._update.bind(this),this._markLoaded=this._markLoaded.bind(this),this._playAfterLoadBound=this._playAfterLoad.bind(this)},j=i.prototype={},k=null;j._sounds=null,j._fades=null,j._pool=null,j.supportedSound=null,j._contexts=null;var l=0,m=1,n=2;i.UNHANDLED="unhandled",i.init=function(c,d,e){if(createjs.Sound.registerPlugins(c),createjs.Sound.BrowserDetect.isIOS&&document.addEventListener("touchstart",a),k=new i,createjs.Sound.getCapabilities())k._initComplete(d,e);else if(createjs.Sound.activePlugin){var f;f=function(){createjs.Sound.getCapabilities()&&(b.instance.off("update",f),k._initComplete(d,e))},b.instance.on("update",f)}else Debug.error("Unable to initialize SoundJS with a plugin!");return k},j._initComplete=function(a,b){if(createjs.FlashPlugin&&createjs.Sound.activePlugin instanceof createjs.FlashPlugin)k.supportedSound=".mp3";else for(var c=0;c<a.length;++c){var d=a[c];if(createjs.Sound.getCapability(d)){k.supportedSound="."+d;break}}b&&b()},Object.defineProperty(i,"instance",{get:function(){return k}}),j.loadConfig=function(a,b){if(!a)return void Debug.warn("Warning - cloudkid.Sound was told to load a null config");var c=a.soundManifest,d=a.path;b=b||a.context;for(var f=0,g=c.length;g>f;++f){var h=c[f];"string"==typeof h&&(h={id:h});var i=this._sounds[h.id]={id:h.id,src:d+(h.src?h.src:h.id)+this.supportedSound,volume:h.volume?h.volume:1,state:l,playing:[],waitingToPlay:[],context:h.context||b,playAfterLoad:!1,preloadCallback:null,data:h};i.context&&(this._contexts[i.context]||(this._contexts[i.context]=new e(i.context)),this._contexts[i.context].sounds.push(i))}},j.exists=function(a){return!!this._sounds[a]},j.isUnloaded=function(a){return this._sounds[a]?this._sounds[a].state==l:!1},j.isLoaded=function(a){return this._sounds[a]?this._sounds[a].state==n:!1},j.isLoading=function(a){return this._sounds[a]?this._sounds[a].state==m:!1},j.isPlaying=function(a){var b=this._sounds[a];return b?b.playing.length+b.waitingToPlay.length>0:!1},j.fadeIn=function(a,c,d,e){var f,g;if("string"==typeof a){if(f=this._sounds[a],!f)return;f.playing.length&&(g=f.playing[f.playing.length-1])}else g=a,f=this._sounds[g.alias];if(g&&g._channel){g._fTime=0,g._fDur=c>0?c:500;var h=e>0?e:0;g._channel.setVolume(h),g.curVol=g._fStart=h,g._fEnd=d||f.volume,-1==this._fades.indexOf(g)&&(this._fades.push(g),1==this._fades.length&&b.instance.on("update",this._update))}},j.fadeOut=function(a,c,d,e){var f,g;if("string"==typeof a){if(f=this._sounds[a],!f)return;f.playing.length&&(g=f.playing[f.playing.length-1])}else g=a;g&&g._channel&&(g._fTime=0,g._fDur=c>0?c:500,e>0?(g._channel.setVolume(e),g._fStart=e):g._fStart=g._channel.getVolume(),g.curVol=g._fStart,g._fEnd=d||0,-1==this._fades.indexOf(g)&&(this._fades.push(g),1==this._fades.length&&b.instance.on("update",this._update)))},j._update=function(a){for(var c=this._fades,d=0,e=c.length-1;e>=0;--e){var f=c[e];if(!f.paused){var g=f._fTime+=a;if(g>=f._fDur){if(0===f._fEnd){var h=this._sounds[f.alias];h.playing=h.playing.splice(h.playing.indexOf(f),1),this._stopInst(f)}else f.curVol=f._fEnd,f.updateVolume();++d;var i=c.length-d;e!=i&&(c[e]=c[i])}else{var j,k=g/f._fDur;j=f._fEnd>f._fStart?f._fStart+(f._fEnd-f._fStart)*k:f._fEnd+(f._fStart-f._fEnd)*k,f.curVol=j,f.updateVolume()}}}c.length=c.length-d,0===c.length&&b.instance.off("update",this._update)},j.play=function(a,b,d,e,f,g,h,j,k){if(h===!0&&(h=-1),b==i.UNHANDLED)return createjs.Sound.play(a,e,f,g,h,j,k);var o=this._sounds[a];if(!o)return Debug.error("cloudkid.Sound: sound "+a+" not found!"),void(b&&b());var p,q,r=o.state;if(j="number"==typeof j&&j>0?j:o.volume,r==n){var s=createjs.Sound.play(a,e,f,g,h,j,k);return s&&s.playState!=createjs.Sound.PLAY_FAILED?(p=this._getSoundInst(s,o.id),s.handleExtraData&&s.handleExtraData(o.data),p.curVol=j,o.playing.push(p),p._endCallback=b,p.updateVolume(),p.length=s.getDuration(),p._channel.addEventListener("complete",p._endFunc),d&&setTimeout(d,0),p):(b&&b(),null)}return r==l?(o.state=m,o.playAfterLoad=!0,p=this._getSoundInst(null,o.id),p.curVol=j,o.waitingToPlay.push(p),p._endCallback=b,p._startFunc=d,p._startParams?(q=p._startParams,q[0]=e,q[1]=f,q[2]=g,q[3]=h,q[4]=k):p._startParams=[e,f,g,h,k],c.instance.load(o.src,this._playAfterLoadBound,null,0,o),p):r==m?(o.playAfterLoad=!0,p=this._getSoundInst(null,o.id),p.curVol=j,o.waitingToPlay.push(p),p._endCallback=b,p._startFunc=d,p._startParams?(q=p._startParams,q[0]=e,q[1]=f,q[2]=g,q[3]=h,q[4]=k):p._startParams=[e,f,g,h,k],p):void 0},j._getSoundInst=function(a,b){var c;return this._pool.length?c=this._pool.pop():(c=new f,c._endFunc=this._onSoundComplete.bind(this,c)),c._channel=a,c.alias=b,c.length=a?a.getDuration():0,c.isValid=!0,c},j._playAfterLoad=function(a){var b="string"==typeof a?a:a.id,c=this._sounds[b];if(c.state=n,c.playAfterLoad){for(var d=c.waitingToPlay,e=0;e<d.length;++e){var f=d[e],g=f._startParams,h=f.curVol,i=createjs.Sound.play(b,g[0],g[1],g[2],g[3],h,g[4]);i&&i.playState!=createjs.Sound.PLAY_FAILED?(c.playing.push(f),f._channel=i,i.handleExtraData&&i.handleExtraData(c.data),f.length=i.getDuration(),f.updateVolume(),i.addEventListener("complete",f._endFunc),f._startFunc&&f._startFunc(),f.paused&&i.pause()):(f._endCallback&&f._endCallback(),this._poolInst(f))}d.length=0}},j._onSoundComplete=function(a){a._channel.removeEventListener("complete",a._endFunc);var b=this._sounds[a.alias];b.playing.splice(b.playing.indexOf(a),1);var c=a._endCallback;this._poolInst(a),c&&c()},j.stop=function(a){var b=this._sounds[a];if(b)if(b.playing.length)this._stopSound(b);else if(b.state==m){b.playAfterLoad=!1;for(var c=b.waitingToPlay,d=0;d<c.length;++d){var e=c[d];this._poolInst(e)}c.length=0}},j._stopSound=function(a){for(var b=a.playing,c=b.length-1;c>=0;--c)this._stopInst(b[c]);b.length=0},j._stopInst=function(a){a._channel.removeEventListener("complete",a._endFunc),a._channel.stop(),this._poolInst(a)},j.stopContext=function(a){if(a=this._contexts[a])for(var b=a.sounds,c=b.length-1;c>=0;--c){var d=b[c];d.playing.length?this._stopSound(d):d.state==m&&(d.playAfterLoad=!1)}},j.pauseSound=function(a){var b;b="string"==typeof a?this._sounds[a]:a;for(var c=b.playing,d=c.length-1;d>=0;--d)c[d].pause()},j.unpauseSound=function(a){var b;b="string"==typeof a?this._sounds[a]:a;for(var c=b.playing,d=c.length-1;d>=0;--d)c[d].unpause()},j.pauseAll=function(){var a=this._sounds;for(var b in a)this.pauseSound(a[b])},j.unpauseAll=function(){var a=this._sounds;for(var b in a)this.unpauseSound(a[b])},j.setContextMute=function(a,b){if(a=this._contexts[a]){a.muted=b;for(var c=a.volume,d=a.sounds,e=d.length-1;e>=0;--e){var f=d[e];if(f.playing.length)for(var g=f.playing,h=g.length-1;h>=0;--h)g[h].updateVolume(b?0:c)}}},j.setContextVolume=function(a,b){if(a=this._contexts[a]){var c=a.muted;a.volume=b;for(var d=a.sounds,e=d.length-1;e>=0;--e){var f=d[e];if(f.playing.length)for(var g=f.playing,h=g.length-1;h>=0;--h)g[h].updateVolume(c?0:b)}}},j.preloadSound=function(a,b){var d=this._sounds[a];return d?void(d.state==l&&(d.state=m,d.preloadCallback=b||null,c.instance.load(d.src,this._markLoaded,null,0,d))):void Debug.error("Sound does not exist: "+a+" - can't preload!")},j.preload=function(a,b){if(!a||0===a.length)return void(b&&b());for(var c=[],e=0,f=a.length;f>e;++e){var g=this._sounds[a[e]];g?g.state==l&&(g.state=m,c.push(new d(g.id,g.src,this._markLoaded,null,0,g))):Debug.error("cloudkid.Sound was asked to preload "+a[e]+" but it is not a registered sound!")}c.length>0?h.process(c,function(){b&&b()}):b&&b()},j._markLoaded=function(a){var b=a.id,c=this._sounds[b];c&&(c.state=n,c.playAfterLoad&&this._playAfterLoad(b));var d=c.preloadCallback;d&&(c.preloadCallback=null,d())},j.createPreloadTask=function(a,b,c){return g?new g(a,b,c):null},j.unload=function(a){if(a)for(var b=0,c=a.length;c>b;++b){var d=this._sounds[a[b]];d&&(this._stopSound(d),d.state=l),createjs.Sound.removeSound(a[b])}},j._poolInst=function(a){a._endCallback=null,a.alias=null,a._channel=null,a._startFunc=null,a.curVol=0,a.paused=!1,a.isValid=!1,this._pool.push(a)},j.destroy=function(){k=null,this._volumes=null,this._fades=null,this._contexts=null,this._pool=null},namespace("cloudkid").Sound=i}(),function(){var a,b,c=cloudkid.Sound,d=function(c){a=cloudkid.Captions,b=cloudkid.Application,this._audioListener=this._onAudioFinished.bind(this),this._update=this._update.bind(this),this._updateCaptionPos=this._updateCaptionPos.bind(this),c&&(this.captions=c instanceof a?c:new a),this._listHelper=[]},e=d.prototype={};e.trackAudio=!1,e.audioList=null,e._listCounter=0,e._currentAudio=null,e._audioInst=null,e._callback=null,e._cancelledCallback=null,e._audioListener=null,e._playedAudio=null,e._timer=0,e.captions=null,e._listHelper=null,Object.defineProperty(e,"playing",{get:function(){return null!==this._currentAudio||this._timer>0}}),e.play=function(a,b,c){this.stop(),this._listCounter=-1,"string"==typeof a?(this._listHelper[0]=a,this.audioList=this._listHelper):this.audioList=a,this._callback=b,this._cancelledCallback=c,this._onAudioFinished()},e._onAudioFinished=function(){if(b.instance.off("update",this._update),b.instance.off("update",this._updateCaptionPos),this.captions&&this._audioInst&&this.captions.seek(this._audioInst.length),this._audioInst=null,this._listCounter++,this._listCounter>=this.audioList.length){this.captions&&this.captions.stop(),this._currentAudio=null,this._cancelledCallback=null;var a=this._callback;this._callback=null,a&&a()}else this._currentAudio=this.audioList[this._listCounter],"string"==typeof this._currentAudio?this._playAudio():"function"==typeof this._currentAudio?(this._currentAudio(),this._onAudioFinished()):(this._timer=this._currentAudio,this._currentAudio=null,b.instance.on("update",this._update))},e._update=function(a){this.captions&&this.captions.updateTime(a),this._timer-=a,this._timer<=0&&this._onAudioFinished()},e._updateCaptionPos=function(){this._audioInst&&this.captions.seek(this._audioInst.position)},e._playAudio=function(){this.trackAudio&&(this._playedAudio?-1==this._playedAudio.indexOf(this._currentAudio)&&this._playedAudio.push(this._currentAudio):this._playedAudio=[this._currentAudio]);var a=c.instance;!a.exists(this._currentAudio)&&this.captions&&this.captions.hasCaption(this._currentAudio)?(this.captions.play(this._currentAudio),this._timer=this.captions.currentDuration,this._currentAudio=null,b.instance.on("update",this._update)):(this._audioInst=a.play(this._currentAudio,this._audioListener),this.captions&&(this.captions.play(this._currentAudio),b.instance.on("update",this._updateCaptionPos)));for(var d=this._listCounter+1;d<this.audioList.length;++d){var e=this.audioList[d];if("string"==typeof e){a.isLoaded(e)||a.preloadSound(e);break}}},e.stop=function(){this._currentAudio&&(c.instance.stop(this._currentAudio),this._currentAudio=null),this.captions&&this.captions.stop(),b.instance.off("update",this._update),b.instance.off("update",this._updateCaptionPos),this.audioList=null,this._timer=0,this._callback=null;var a=this._cancelledCallback;this._cancelledCallback=null,a&&a()},e.unloadPlayedAudio=function(){c.instance.unload(this._playedAudio),this._playedAudio=null},e.destroy=function(){this.stop(),this.audioList=null,this._listHelper=null,this._currentAudio=null,this._audioInst=null,this._callback=null,this._cancelledCallback=null,this._audioListener=null,this._playedAudio=null,this.captions&&(this.captions.destroy(),this.captions=null)},namespace("cloudkid").VOPlayer=d,namespace("cloudkid").Sound.VOPlayer=d}();}();