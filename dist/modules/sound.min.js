/*! CloudKidFramework 0.0.5 */
!function(){"use strict";!function(){var a=function(a){this.id=a,this.volume=1,this.muted=!1,this.sounds=[]};namespace("cloudkid").SoundContext=a}(),function(){var a,b=function(){a||(a=include("cloudkid.Sound")),this._channel=null,this._endFunc=null,this._endCallback=null,this._startFunc=null,this._startParams=null,this.alias=null,this._fTime=0,this._fDur=0,this._fStart=0,this._fEnd=0,this.curVol=0,this.length=0,this.paused=!1,this.isValid=!0},c=b.prototype={};Object.defineProperty(c,"position",{get:function(){return this._channel?this._channel.getPosition():0}}),c.stop=function(){var b=a.instance,c=b._sounds[this.alias];c.playing.splice(c.playing.indexOf(this),1),a.instance._stopInst(this)},c.updateVolume=function(b){if(this._channel){if(void 0===b){var c=a.instance,d=c._sounds[this.alias];if(d.context){var e=c._contexts[d.context];b=e.muted?0:e.volume}else b=1}this._channel.setVolume(b*this.curVol)}},c.pause=function(){this.paused||(this.paused=!0,this._channel&&this._channel.pause())},c.unpause=function(){this.paused&&(this.paused=!1,this._channel&&this._channel.resume())},namespace("cloudkid").SoundInstance=b}(),function(){var a=include("cloudkid.Task",!1);if(a){var b=function(a,b,c){this.initialize(a,c),this.list=b},c=a.prototype,d=b.prototype=Object.create(c);d.start=function(a){cloudkid.Sound.instance.preload(this.list,a)},d.destroy=function(){c.destroy.call(this),this.list=null},namespace("cloudkid").SoundListTask=b}}(),function(){function a(){document.removeEventListener("touchstart",a),createjs.WebAudioPlugin.playEmptySound()}var b,c,d,e,f,g,h=include("cloudkid.Application"),i=include("createjs.Sound"),j=function(){b||(b=include("cloudkid.Loader"),c=include("cloudkid.LoadTask"),d=include("cloudkid.TaskManager"),e=include("cloudkid.SoundContext"),f=include("cloudkid.SoundInstance"),g=include("cloudkid.SoundListTask")),this._sounds={},this._fades=[],this._pool=[],this.supportedSound=null,this._contexts={},this._update=this._update.bind(this),this._markLoaded=this._markLoaded.bind(this),this._playAfterLoad=this._playAfterLoad.bind(this)},k=j.prototype={},l=null,m=0,n=1,o=2;j.init=function(b,c){"function"==typeof b&&(b={ready:b});var d={plugins:[createjs.WebAudioPlugin,createjs.FlashPlugin],types:["ogg","mp3"],swfPath:"assets/swfs/",ready:null};b=b||{};for(var e in d)b.hasOwnProperty(e)||(b[e]=d[e]);if(b.ready=b.ready||c,!b.ready)throw"cloudkid.Sound.init requires a ready callback";i.registerPlugins(b.plugins);var f=h.instance.options.basePath;if(createjs.FlashPlugin&&(createjs.FlashPlugin.hasOwnProperty("swfPath")?createjs.FlashPlugin.swfPath=(f||"")+b.swfPath:createjs.FlashPlugin.BASE_PATH=(f||"")+b.swfPath),i.BrowserDetect.isIOS&&document.addEventListener("touchstart",a),l=new j,i.getCapabilities())l._initComplete(b.types,b.ready);else{if(!i.activePlugin)throw"Unable to initialize SoundJS with a plugin!";var g;g=function(){i.getCapabilities()&&(h.instance.off("update",g),l._initComplete(b.types,b.ready))},h.instance.on("update",g)}return l},k._initComplete=function(a,b){if(createjs.FlashPlugin&&i.activePlugin instanceof createjs.FlashPlugin)l.supportedSound=".mp3";else for(var c=0;c<a.length;++c){var d=a[c];if(i.getCapability(d)){l.supportedSound="."+d;break}}this.pauseAll=this.pauseAll.bind(this),this.unpauseAll=this.unpauseAll.bind(this),h.instance.on("paused",this.pauseAll),h.instance.on("resumed",this.unpauseAll),b&&b()},Object.defineProperty(j,"instance",{get:function(){return l}}),k.loadConfig=function(a){if(!a)return void Debug.warn("Warning - cloudkid.Sound was told to load a null config");for(var b=a.soundManifest,c=a.path||"",d=a.context,f=0,g=b.length;g>f;++f){var h=b[f];"string"==typeof h&&(h={id:h});var i=this._sounds[h.id]={id:h.id,src:c+(h.src?h.src:h.id)+this.supportedSound,volume:h.volume?h.volume:1,loop:!!h.loop,state:m,playing:[],waitingToPlay:[],context:h.context||d,playAfterLoad:!1,preloadCallback:null,data:h};i.context&&(this._contexts[i.context]||(this._contexts[i.context]=new e(i.context)),this._contexts[i.context].sounds.push(i))}return this},k.exists=function(a){return!!this._sounds[a]},k.isUnloaded=function(a){return this._sounds[a]?this._sounds[a].state==m:!1},k.isLoaded=function(a){return this._sounds[a]?this._sounds[a].state==o:!1},k.isLoading=function(a){return this._sounds[a]?this._sounds[a].state==n:!1},k.isPlaying=function(a){var b=this._sounds[a];return b?b.playing.length+b.waitingToPlay.length>0:!1},k.fadeIn=function(a,b,c,d){var e,f;if("string"==typeof a){if(e=this._sounds[a],!e)return;e.playing.length&&(f=e.playing[e.playing.length-1])}else f=a,e=this._sounds[f.alias];if(f&&f._channel){f._fTime=0,f._fDur=b>0?b:500;var g=d>0?d:0;f._channel.setVolume(g),f.curVol=f._fStart=g,f._fEnd=c||e.volume,-1==this._fades.indexOf(f)&&(this._fades.push(f),1==this._fades.length&&h.instance.on("update",this._update))}},k.fadeOut=function(a,b,c,d){var e,f;if("string"==typeof a){if(e=this._sounds[a],!e)return;e.playing.length&&(f=e.playing[e.playing.length-1])}else f=a;f&&f._channel&&(f._fTime=0,f._fDur=b>0?b:500,d>0?(f._channel.setVolume(d),f._fStart=d):f._fStart=f._channel.getVolume(),f.curVol=f._fStart,f._fEnd=c||0,-1==this._fades.indexOf(f)&&(this._fades.push(f),1==this._fades.length&&h.instance.on("update",this._update)))},k._update=function(a){for(var b=this._fades,c=0,d=b.length-1;d>=0;--d){var e=b[d];if(!e.paused){var f=e._fTime+=a;if(f>=e._fDur){if(0===e._fEnd){var g=this._sounds[e.alias];g.playing=g.playing.splice(g.playing.indexOf(e),1),this._stopInst(e)}else e.curVol=e._fEnd,e.updateVolume();++c;var i=b.length-c;d!=i&&(b[d]=b[i])}else{var j,k=f/e._fDur;j=e._fEnd>e._fStart?e._fStart+(e._fEnd-e._fStart)*k:e._fEnd+(e._fStart-e._fEnd)*k,e.curVol=j,e.updateVolume()}}}b.length=b.length-c,0===b.length&&h.instance.off("update",this._update)},k.play=function(a,c,d,e,f,g,h,j,k){var l;c&&"function"==typeof c&&(l=c,c=null),l=(c?c.complete:l)||null,d=(c?c.start:d)||null,e=!!(c?c.interrupt:e),f=(c?c.delay:f)||0,g=(c?c.offset:g)||0,h=c?c.loop:h,j=c?c.volume:j,k=(c?c.pan:k)||0,h===!0&&(h=-1);var p=this._sounds[a];if(!p)return Debug.error("cloudkid.Sound: sound "+a+" not found!"),void(l&&l());(p.loop&&void 0===h||null===h)&&(h=-1),j="number"==typeof j?j:p.volume;var q,r,s=p.state;if(s==o){var t=i.play(a,e,f,g,h,j,k);return t&&t.playState!=i.PLAY_FAILED?(q=this._getSoundInst(t,p.id),t.handleExtraData&&t.handleExtraData(p.data),q.curVol=j,p.playing.push(q),q._endCallback=l,q.updateVolume(),q.length=t.getDuration(),q._channel.addEventListener("complete",q._endFunc),d&&setTimeout(d,0),q):(l&&l(),null)}return s==m?(p.state=n,p.playAfterLoad=!0,q=this._getSoundInst(null,p.id),q.curVol=j,p.waitingToPlay.push(q),q._endCallback=l,q._startFunc=d,q._startParams?(r=q._startParams,r[0]=e,r[1]=f,r[2]=g,r[3]=h,r[4]=k):q._startParams=[e,f,g,h,k],b.instance.load(p.src,this._playAfterLoadBound,null,0,p),q):s==n?(p.playAfterLoad=!0,q=this._getSoundInst(null,p.id),q.curVol=j,p.waitingToPlay.push(q),q._endCallback=l,q._startFunc=d,q._startParams?(r=q._startParams,r[0]=e,r[1]=f,r[2]=g,r[3]=h,r[4]=k):q._startParams=[e,f,g,h,k],q):void 0},k._getSoundInst=function(a,b){var c;return this._pool.length?c=this._pool.pop():(c=new f,c._endFunc=this._onSoundComplete.bind(this,c)),c._channel=a,c.alias=b,c.length=a?a.getDuration():0,c.isValid=!0,c},k._playAfterLoad=function(a){var b="string"==typeof a?a:a.id,c=this._sounds[b];if(c.state=o,c.playAfterLoad){for(var d=c.waitingToPlay,e=0;e<d.length;++e){var f=d[e],g=f._startParams,h=f.curVol,j=i.play(b,g[0],g[1],g[2],g[3],h,g[4]);j&&j.playState!=i.PLAY_FAILED?(c.playing.push(f),f._channel=j,j.handleExtraData&&j.handleExtraData(c.data),f.length=j.getDuration(),f.updateVolume(),j.addEventListener("complete",f._endFunc),f._startFunc&&f._startFunc(),f.paused&&j.pause()):(f._endCallback&&f._endCallback(),this._poolInst(f))}d.length=0}},k._onSoundComplete=function(a){a._channel.removeEventListener("complete",a._endFunc);var b=this._sounds[a.alias];b.playing.splice(b.playing.indexOf(a),1);var c=a._endCallback;this._poolInst(a),c&&c()},k.stop=function(a){var b=this._sounds[a];if(b)if(b.playing.length)this._stopSound(b);else if(b.state==n){b.playAfterLoad=!1;for(var c=b.waitingToPlay,d=0;d<c.length;++d){var e=c[d];this._poolInst(e)}c.length=0}},k._stopSound=function(a){for(var b=a.playing,c=b.length-1;c>=0;--c)this._stopInst(b[c]);b.length=0},k._stopInst=function(a){a._channel.removeEventListener("complete",a._endFunc),a._channel.stop(),this._poolInst(a)},k.stopContext=function(a){if(a=this._contexts[a])for(var b=a.sounds,c=b.length-1;c>=0;--c){var d=b[c];d.playing.length?this._stopSound(d):d.state==n&&(d.playAfterLoad=!1)}},k.pauseSound=function(a){var b;b="string"==typeof a?this._sounds[a]:a;for(var c=b.playing,d=c.length-1;d>=0;--d)c[d].pause()},k.unpauseSound=function(a){var b;b="string"==typeof a?this._sounds[a]:a;for(var c=b.playing,d=c.length-1;d>=0;--d)c[d].unpause()},k.pauseAll=function(){var a=this._sounds;for(var b in a)this.pauseSound(a[b])},k.unpauseAll=function(){var a=this._sounds;for(var b in a)this.unpauseSound(a[b])},k.setContextMute=function(a,b){if(a=this._contexts[a]){a.muted=b;for(var c=a.volume,d=a.sounds,e=d.length-1;e>=0;--e){var f=d[e];if(f.playing.length)for(var g=f.playing,h=g.length-1;h>=0;--h)g[h].updateVolume(b?0:c)}}},k.setMuteAll=function(a){i.setMute(!!a)},k.setContextVolume=function(a,b){if(a=this._contexts[a]){var c=a.muted;a.volume=b;for(var d=a.sounds,e=d.length-1;e>=0;--e){var f=d[e];if(f.playing.length)for(var g=f.playing,h=g.length-1;h>=0;--h)g[h].updateVolume(c?0:b)}}},k.preloadSound=function(a,c){var d=this._sounds[a];return d?void(d.state==m&&(d.state=n,d.preloadCallback=c||null,b.instance.load(d.src,this._markLoaded,null,0,d))):void Debug.error("Sound does not exist: "+a+" - can't preload!")},k.preload=function(a,b){if(!a||0===a.length)return void(b&&b());for(var e=[],f=0,g=a.length;g>f;++f){var h=this._sounds[a[f]];h?h.state==m&&(h.state=n,e.push(new c(h.id,h.src,this._markLoaded,null,0,h))):Debug.error("cloudkid.Sound was asked to preload "+a[f]+" but it is not a registered sound!")}e.length>0?d.process(e,function(){b&&b()}):b&&b()},k._markLoaded=function(a){var b=a.id,c=this._sounds[b];c&&(c.state=o,c.playAfterLoad&&this._playAfterLoad(b));var d=c.preloadCallback;d&&(c.preloadCallback=null,d())},k.createPreloadTask=function(a,b,c){return g?new g(a,b,c):null},k.unload=function(a){if(a)for(var b=0,c=a.length;c>b;++b){var d=this._sounds[a[b]];d&&(this._stopSound(d),d.state=m),i.removeSound(a[b])}},k._poolInst=function(a){a._endCallback=null,a.alias=null,a._channel=null,a._startFunc=null,a.curVol=0,a.paused=!1,a.isValid=!1,this._pool.push(a)},k.destroy=function(){if(i.removeAllSounds(),createjs.FlashPlugin&&i.activePlugin instanceof createjs.FlashPlugin){var a=document.getElementById("SoundJSFlashContainer");a&&a.parentNode&&a.parentNode.removeChild(a)}h.instance&&(h.instance.off("paused",this.pauseAll),h.instance.off("resumed",this.unpauseAll)),l=null,this._volumes=null,this._fades=null,this._contexts=null,this._pool=null},namespace("cloudkid").Sound=j}(),function(){var a,b,c=include("cloudkid.Sound"),d=function(c){b||(a=include("cloudkid.Captions"),b=include("cloudkid.Application")),this._onSoundFinished=this._onSoundFinished.bind(this),this._update=this._update.bind(this),this._updateCaptionPos=this._updateCaptionPos.bind(this),this.captions=null,c&&a&&(this.captions=c instanceof a?c:new a),this._listHelper=[],this.trackSound=!1,this.soundList=null,this._listCounter=0,this._currentSound=null,this._soundInstance=null,this._callback=null,this._cancelledCallback=null,this._playedSound=null,this._timer=0},e=d.prototype={};Object.defineProperty(e,"playing",{get:function(){return null!==this._currentSound||this._timer>0}}),e.play=function(a,b,c){this.stop(),this._listCounter=-1,"string"==typeof a?(this._listHelper[0]=a,this.soundList=this._listHelper):this.soundList=a,this._callback=b,this._cancelledCallback=c,this._onSoundFinished()},e._onSoundFinished=function(){if(b.instance.off("update",this._update),b.instance.off("update",this._updateCaptionPos),this.captions&&this._soundInstance&&this.captions.seek(this._soundInstance.length),this._soundInstance=null,this._listCounter++,this._listCounter>=this.soundList.length){this.captions&&this.captions.stop(),this._currentSound=null,this._cancelledCallback=null;var a=this._callback;this._callback=null,a&&a()}else this._currentSound=this.soundList[this._listCounter],"string"==typeof this._currentSound?this._playSound():"function"==typeof this._currentSound?(this._currentSound(),this._onSoundFinished()):(this._timer=this._currentSound,this._currentSound=null,b.instance.on("update",this._update))},e._update=function(a){this.captions&&this.captions.updateTime(a),this._timer-=a,this._timer<=0&&this._onSoundFinished()},e._updateCaptionPos=function(){this._soundInstance&&this.captions.seek(this._soundInstance.position)},e._playSound=function(){this.trackSound&&(this._playedSound?-1==this._playedSound.indexOf(this._currentSound)&&this._playedSound.push(this._currentSound):this._playedSound=[this._currentSound]);var a=c.instance;!a.exists(this._currentSound)&&this.captions&&this.captions.hasCaption(this._currentSound)?(this.captions.play(this._currentSound),this._timer=this.captions.currentDuration,this._currentSound=null,b.instance.on("update",this._update)):(this._soundInstance=a.play(this._currentSound,this._onSoundFinished),this.captions&&(this.captions.play(this._currentSound),b.instance.on("update",this._updateCaptionPos)));for(var d=this._listCounter+1;d<this.soundList.length;++d){var e=this.soundList[d];if("string"==typeof e){a.isLoaded(e)||a.preloadSound(e);break}}},e.stop=function(){this._currentSound&&(c.instance.stop(this._currentSound),this._currentSound=null),this.captions&&this.captions.stop(),b.instance.off("update",this._update),b.instance.off("update",this._updateCaptionPos),this.soundList=null,this._timer=0,this._callback=null;var a=this._cancelledCallback;this._cancelledCallback=null,a&&a()},e.unloadSound=function(){c.instance.unload(this._playedSound),this._playedSound=null},e.destroy=function(){this.stop(),this.soundList=null,this._listHelper=null,this._currentSound=null,this._soundInstance=null,this._callback=null,this._cancelledCallback=null,this._playedSound=null,this.captions&&(this.captions.destroy(),this.captions=null)},namespace("cloudkid").VOPlayer=d,namespace("cloudkid").Sound.VOPlayer=d}();}();