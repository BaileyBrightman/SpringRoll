/*! SpringRoll 0.4.0-alpha */
!function(){"use strict";!function(a){function b(a){if(!a||"object"!=typeof a)return null;var b=a.constructor();for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b}function c(a,b){if(a===b)return!0;for(var c in a)if(a[c]!=b[c])return!1;return!0}var d,e=include("PIXI.Container"),f=include("PIXI.Point"),g=include("PIXI.Sprite"),h=include("PIXI.extras.BitmapText",!1),i=include("PIXI.Text"),j=function(c,j,k){d=include("springroll.Debug",!1),e.call(this),this.back=new g(c.up),this.label=null,this._stateFlags={},this._statePriority=c.priority||m,this._stateData=null,this._currentLabelStyle=null,this._offset=new f,this._width=0,this._height=0,this.addChild(this.back),this._onOver=this._onOver.bind(this),this._onOut=this._onOut.bind(this),this._onDown=this._onDown.bind(this),this._onUp=this._onUp.bind(this),this._onUpOutside=this._onUpOutside.bind(this),this._emitPress=this._emitPress.bind(this);var l,n=this._stateData={};if(j){l=b(j),delete l.text,delete l.type,l.x===a&&(l.x="center"),l.y===a&&(l.y="center");var o=l.style=b(j.style);"bitmap"==j.type?o.align=o.align||"left":(o.font=o.font||"bold 20pt Arial",o.fill=o.fill||"black",o.align=o.align||"left",o.stroke=o.stroke||"black",o.strokeThickness=o.strokeThickness||0,o.wordWrap=o.wordWrap||!1,o.wordWrapWidth=o.wordWrapWidth||100)}for(var p=this._statePriority.length-1;p>=0;--p){var q=this._statePriority[p];this._addProperty(q),"disabled"!=q&&"up"!=q&&(this._stateFlags[q]=!1);var r=c[q];if(r?r.tex?n[q]={tex:r.tex}:n[q]={tex:r}:n[q]=n.up,j)if(r&&r.label){r=r.label;var s=n[q].label={};s.style=r.style||l.style,s.x=r.x||l.x,s.y=r.y||l.y}else n[q].label=l}if(!n.up,n.over||(n.over=n.up),n.down||(n.down=n.up),n.disabled||(n.disabled=n.up),c.offset?(this._offset.x=c.offset.x,this._offset.y=c.offset.y):this._offset.x=this._offset.y=0,c.scale){var t=c.scale||1;this.back.scale.x=this.back.scale.y=t}j&&(this.label="bitmap"==j.type&&h?new h(j.text,l.style):new i(j.text,l.style),this.label.setPivotToAlign=!0,this.addChild(this.label)),this.back.x=this._offset.x,this.back.y=this._offset.y,this._width=this.back.width,this._height=this.back.height,this.enabled=k===a?!0:!!k},k=j.prototype=Object.create(e.prototype);j.BUTTON_PRESS="buttonPress",j.BUTTON_OVER="buttonOver",j.BUTTON_OUT="buttonOut";var l=["disabled","enabled","up","over","down"],m=["disabled","down","over","up"];Object.defineProperty(k,"width",{get:function(){return this._width*this.scale.x},set:function(a){this.scale.x=a/this._width}}),Object.defineProperty(k,"height",{get:function(){return this._height*this.scale.y},set:function(a){this.scale.y=a/this._height}}),k.setText=function(a){if(this.label){this.label.text=a,this.label.updateText(),this.label.dirty=!1;for(var b,c=0;c<this._statePriority.length;++c)if(this._stateFlags[this._statePriority[c]]){b=this._stateData[this._statePriority[c]];break}if(b||(b=this._stateData.up),b=b.label,"center"==b.x){var d=this.back.width,e=this.label.width;switch(this._currentLabelStyle.align){case"center":this.label.position.x=.5*d;break;case"right":this.label.position.x=.5*(d-e)+e;break;default:this.label.position.x=.5*(d-e)}}else this.label.position.x=b.x+this._offset.x;"center"==b.y?this.label.position.y=.5*(this.back.height-this.label.height):this.label.position.y=b.y+this._offset.y}},Object.defineProperty(k,"enabled",{get:function(){return!this._stateFlags.disabled},set:function(a){this._stateFlags.disabled=!a,this.buttonMode=a,this.interactive=a,this.off("mousedown",this._onDown),this.off("touchstart",this._onDown),this.off("mouseover",this._onOver),this.off("mouseout",this._onOut),a?(this.on("mousedown",this._onDown),this.on("touchstart",this._onDown),this.on("mouseover",this._onOver),this.on("mouseout",this._onOut)):(this.off("mouseupoutside",this._onUpOutside),this.off("touchendoutside",this._onUpOutside),this.off("mouseup",this._onUp),this.off("touchend",this._onUp),this._stateFlags.down=this._stateFlags.over=!1,this._over=!1,this._touchDown=!1),this._updateState()}}),k._addProperty=function(a){l.indexOf(a)>=0||Object.defineProperty(this,a,{get:function(){return this._stateFlags[a]},set:function(b){this._stateFlags[a]=b,this._updateState()}})},k._updateState=function(){if(this.back){for(var a,b=0;b<this._statePriority.length;++b)if(this._stateFlags[this._statePriority[b]]){a=this._stateData[this._statePriority[b]];break}if(a||(a=this._stateData.up),this.back.texture=a.tex,this.label){if(a=a.label,this._currentLabelStyle&&c(this._currentLabelStyle,a.style)||(this.label.style=a.style,this._currentLabelStyle=a.style,this.label instanceof i?(this.label.updateText(),this.label.dirty=!1):this.label.forceUpdateText()),"center"==a.x){var d=this.back.width,e=this.label.width;switch(this._currentLabelStyle.align){case"center":this.label.position.x=.5*d;break;case"right":this.label.position.x=.5*(d-e)+e;break;default:this.label.position.x=.5*(d-e)}}else this.label.position.x=a.x+this._offset.x;"center"==a.y?this.label.position.y=.5*(this.back.height-this.label.height):this.label.position.y=a.y+this._offset.y}}},k._onOver=function(a){this._stateFlags.over=!0,this._updateState(),this.emit(j.BUTTON_OVER,this)},k._onOut=function(a){this._stateFlags.over=!1,this._updateState(),this.emit(j.BUTTON_OUT,this)},k._onDown=function(a){a.data.originalEvent.preventDefault(),this._stateFlags.down=!0,this._updateState(),this.on("mouseupoutside",this._onUpOutside),this.on("touchendoutside",this._onUpOutside),this.on("mouseup",this._onUp),this.on("touchend",this._onUp)},k._onUp=function(a){a.data.originalEvent.preventDefault(),this._stateFlags.down=!1,this.off("mouseupoutside",this._onUpOutside),this.off("touchendoutside",this._onUpOutside),this.off("mouseup",this._onUp),this.off("touchend",this._onUp),this._updateState(),setTimeout(this._emitPress,0)},k._emitPress=function(){this.emit(j.BUTTON_PRESS,this)},k._onUpOutside=function(a){this._stateFlags.down=!1,this.off("mouseupoutside",this._onUpOutside),this.off("touchendoutside",this._onUpOutside),this.off("mouseup",this._onUp),this.off("touchend",this._onUp),this._updateState()},k.destroy=function(){this.removeAllListeners(),this.removeChildren(),this.label=null,this.back=null,this._stateData=null,this._stateFlags=null,this._statePriority=null},namespace("springroll").Button=j,namespace("springroll.pixi").Button=j}(),function(){var a=function(a){this.obj=a,this.mouseDownObjPos={x:0,y:0},this.dragOffset=new PIXI.Point,this.mouseDownStagePos={x:0,y:0}};namespace("springroll").DragData=a,namespace("springroll.pixi").DragData=a}(),function(){var a,b,c,d=include("springroll.pixi.DragData"),e=function(d,e,f){a||(a=include("springroll.Application"),b=include("createjs.Tween",!1),c=include("PIXI.Point")),"function"!=typeof d||f||(f=e,e=d,d=a.instance.display),this.draggedObj=null,this.dragStartThreshold=20,this.mouseDownStagePos=new c(0,0),this.mouseDownObjPos=new c(0,0),this.allowStickyClick=!0,this.isTouchMove=!1,this.isHeldDrag=!1,this.isStickyClick=!1,this.snapSettings=null,this._interaction=d.renderer.plugins.interaction,this._dragOffset=null,this._dragStartCallback=e,this._dragEndCallback=f,this._triggerHeldDrag=this._triggerHeldDrag.bind(this),this._triggerStickyClick=this._triggerStickyClick.bind(this),this._stopDrag=this._stopDrag.bind(this),this._updateObjPosition=this._updateObjPosition.bind(this),this._draggableObjects=[],this._multitouch=!1,this._addedDragListeners=!1,this.helperPoint=new c(0,0)},f=e.prototype={};Object.defineProperty(f,"multitouch",{get:function(){return this._multitouch},set:function(a){if(this.draggedObj)if(this._multitouch)for(var b in this.draggedObj)this._stopDrag(b,!0);else this._stopDrag(null,!0);this._multitouch=!!a,this.draggedObj=a?{}:null}}),f.startDrag=function(a,b){this._objMouseDown(a,b)},f._objMouseDown=function(a,e){if(e.data&&e.data.global&&(e=e.data),!(!this._multitouch&&this.draggedObj||this._multitouch&&!e)){var f,g,h,i;this._multitouch?(f=new d(a),this.draggedObj[e.identifier]=f,g=f.mouseDownObjPos,h=f.mouseDownStagePos,i=f.dragOffset):(this.draggedObj=a,g=this.mouseDownObjPos,h=this.mouseDownStagePos,i=this._dragOffset=new c),b&&(b.removeTweens(a),b.removeTweens(a.position)),e.getLocalPosition(a.parent,i),i.x-=a.position.x,i.y-=a.position.y,g.x=a.position.x,g.y=a.position.y,e?(h.x=e.global.x,h.y=e.global.y,this.allowStickyClick&&"touchstart"!=e.originalEvent.type?(this._interaction.on("stagemove",this._triggerHeldDrag),this._interaction.on("stageup",this._triggerStickyClick)):(this.isTouchMove="touchstart"==e.originalEvent.type,this.isHeldDrag=!0,this._startDrag(e))):(this.isHeldDrag=!0,this._startDrag())}},f._triggerStickyClick=function(a){a=a.data,this.isStickyClick=!0;this._multitouch?this.draggedObj[a.identifier].obj:this.draggedObj;this._interaction.off("stagemove",this._triggerHeldDrag),this._interaction.off("stageup",this._triggerStickyClick),this._startDrag(a)},f._triggerHeldDrag=function(a){a=a.data;var b,c;this._multitouch?(c=this.draggedObj[a.identifier].obj,b=this.draggedObj[a.identifier].mouseDownStagePos):(c=this.draggedObj,b=this.mouseDownStagePos);var d=a.global.x-b.x,e=a.global.y-b.y;d*d+e*e>=this.dragStartThreshold*this.dragStartThreshold&&(this.isHeldDrag=!0,this._interaction.off("stagemove",this._triggerHeldDrag),this._interaction.off("stageup",this._triggerStickyClick),this._startDrag(a))},f._startDrag=function(a){var b;b=this._multitouch?this.draggedObj[a.identifier].obj:this.draggedObj,this._addedDragListeners||(this._addedDragListeners=!0,this._interaction.on("stagemove",this._updateObjPosition),this._interaction.on("stageup",this._stopDrag)),this._dragStartCallback(b)},f.stopDrag=function(a,b){var c=null;if(this._multitouch&&b)for(var d in this.draggedObj)if(this.draggedObj[d].obj==b){c=d;break}this._stopDrag(c,a===!0)},f._stopDrag=function(a,b){var c,d=null;if("number"==typeof a?d=a:a&&(a.data&&a.data.global?d=a.data.identifier:a instanceof PIXI.interaction.InteractionData&&(d=a.identifier)),this._multitouch){if(null===d){for(d in this.draggedObj)this._stopDrag(d,b);return}var e=this.draggedObj[d];if(!e)return;c=e.obj,this.mouseDownObjPos.x=e.mouseDownObjPos.x,this.mouseDownObjPos.y=e.mouseDownObjPos.y,delete this.draggedObj[d]}else c=this.draggedObj,this.draggedObj=null;if(c){var f=!this._multitouch;if(this._multitouch){var g=!1;for(d in this.draggedObj){g=!0;break}f=!g}f&&this._addedDragListeners&&(this._addedDragListeners=!1,this._interaction.off("stagemove",this._updateObjPosition),this._interaction.off("stageup",this._stopDrag)),this.isTouchMove=!1,this.isStickyClick=!1,this.isHeldMove=!1,b!==!1&&this._dragEndCallback(c)}},f._updateObjPosition=function(a){a=a.data;var b,c;if(this._multitouch){var d=this.draggedObj[a.identifier];b=d.obj,c=d.dragOffset}else b=this.draggedObj,c=this._dragOffset;if(!b||!b.parent)return void this.stopDrag(!1,b);var e=a.getLocalPosition(b.parent,this.helperPoint),f=b._dragBounds;if(f?(b.position.x=h(e.x-c.x,f.x,f.right),b.position.y=h(e.y-c.y,f.y,f.bottom)):(b.position.x=e.x-c.x,b.position.y=e.y-c.y),this.snapSettings)switch(this.snapSettings.mode){case"points":this._handlePointSnap(e,c,b);break;case"grid":break;case"line":}},f._handlePointSnap=function(a,b,c){for(var d=this.snapSettings,e=d.dist*d.dist,f=d.points,h=a.x-b.x,i=a.y-b.y,j=-1,k=null,l=f.length-1;l>=0;--l){var m=f[l],n=g(h,i,m.x,m.y);e>=n&&(j>n||-1==j)&&(j=n,k=m)}k&&(draggedObj.position.x=k.x,draggedObj.position.y=k.y)};var g=function(a,b,c,d){var e=a-c,f=b-d;return e*e+f*f},h=function(a,b,c){return b>a?b:a>c?c:a},i=function(){this.on("touchstart",this._onMouseDownListener),this.on("mousedown",this._onMouseDownListener),this.buttonMode=this.interactive=!0},j=function(){this.off("touchstart",this._onMouseDownListener),this.off("mousedown",this._onMouseDownListener),this.buttonMode=this.interactive=!1},k=function(a){this._dragMan._objMouseDown(this,a)};f.addObject=function(a,b){b&&(b.right=b.x+b.width,b.bottom=b.y+b.height),a._dragBounds=b,this._draggableObjects.indexOf(a)>=0||(a.enableDrag=i,a.disableDrag=j,a._onMouseDownListener=k.bind(a),a._dragMan=this,this._draggableObjects.push(a))},f.removeObject=function(a){var b=this._draggableObjects.indexOf(a);b>=0&&(a.disableDrag(),delete a.enableDrag,delete a.disableDrag,delete a._onMouseDownListener,delete a._dragMan,delete a._dragBounds,this._draggableObjects.splice(b,1))},f.destroy=function(){this.stopDrag(!1),this._updateObjPosition=null,this._dragStartCallback=null,this._dragEndCallback=null,this._triggerHeldDrag=null,this._triggerStickyClick=null,this._stopDrag=null,this._interaction=null;for(var a=this._draggableObjects.length-1;a>=0;--a){var b=this._draggableObjects[a];b.disableDrag(),delete b.enableDrag,delete b.disableDrag,delete b._onMouseDownListener,delete b._dragMan,delete b._dragBounds}this._draggableObjects=null},namespace("springroll").DragManager=e,namespace("springroll.pixi").DragManager=e}();}();