/*! SpringRoll 0.3.0 */
!function(){"use strict";!function(){var a,b=function(b,c,d,e){a||(a=include("springroll.UIScaler")),this._item=b,this._settings=c,this._designedScreen=d,this._adapter=e;var f=e.getScale(b),g=e.getPosition(b);switch(this.origScaleX=f.x||1,this.origScaleY=f.y||1,this.origWidth=b.width||0,this.origBounds=e.getLocalBounds(b),this.origMarginHori=0,this.origMarginVert=0,c.vertAlign){case a.ALIGN_TOP:this.origMarginVert=g.y+this.origBounds.y*f.y;break;case a.ALIGN_CENTER:this.origMarginVert=.5*d.height-g.y;break;case a.ALIGN_BOTTOM:this.origMarginVert=d.height-(g.y+this.origBounds.bottom*f.y)}switch(c.horiAlign){case a.ALIGN_LEFT:this.origMarginHori=g.x+this.origBounds.x*f.x;break;case a.ALIGN_CENTER:this.origMarginHori=.5*d.width-g.x;break;case a.ALIGN_RIGHT:this.origMarginHori=d.width-(g.x+this.origBounds.right*f.x)}},c=b.prototype={};Object.defineProperty(c,"display",{get:function(){return this._item}}),c.resize=function(b,c){var d=this._adapter,e=this._item,f=this._settings,g=this._designedScreen,h=this.origBounds,i=this.origScaleX,j=this.origScaleY,k=g.width/g.height,l=b/c,m=l>=k?c/g.height:b/g.width,n=l>=k,o=0,p=0;n?o=(b-g.width*m)/2:p=(c-g.height*m)/2;var q=m;f.minScale&&q<f.minScale?q=f.minScale:f.maxScale&&q>f.maxScale&&(q=f.maxScale),d.setScale(e,i*q,"x"),d.setScale(e,j*q,"y");var r,s=null,t=null;r=this.origMarginVert*m;var u=f.titleSafe===!0||"vertical"===f.titleSafe;switch(f.vertAlign){case a.ALIGN_TOP:t=u?p+r-h.y*j*q:r-h.y*j*q;break;case a.ALIGN_CENTER:t=.5*c-r;break;case a.ALIGN_BOTTOM:t=u?c-p-r-h.bottom*j*q:c-r-h.bottom*j*q}switch(null!==t&&d.setPosition(e,t,"y"),r=this.origMarginHori*m,u=f.titleSafe===!0||"horizontal"===f.titleSafe,f.horiAlign){case a.ALIGN_LEFT:s=u?o+r-h.x*i*q:r-h.x*i*q;break;case a.ALIGN_CENTER:s=f.centeredHorizontally?.5*(b-e.width):.5*b-r;break;case a.ALIGN_RIGHT:s=u?b-o-r-h.right*i*q:b-r-h.right*i*q}null!==s&&d.setPosition(e,s,"x")},c.destroy=function(){this._adapter=null,this.origBounds=null,this._item=null,this._settings=null,this._designedScreen=null},namespace("springroll").UIElement=b}(),function(){var a=function(){this.vertAlign=null,this.horiAlign=null,this.titleSafe=!1,this.maxScale=1,this.minScale=1,this.centeredHorizontally=!1};namespace("springroll").UIElementSettings=a}(),function(a){var b={},c=Math.PI/180;b.initItem=function(d,e,f){f||(f=springroll.UIScaler._getAdapter()),e.x!==a&&f.setPosition(d,e.x,"x"),e.y!==a&&f.setPosition(d,e.y,"y");var g=e.scale,h=f.getScale(d);g&&(f.setScale(d,g.x*h.x,"x"),f.setScale(d,g.y*h.y,"y")),g=e.pivot,g&&f.setPivot(d,g),e.rotation!==a&&(d.rotation=e.rotation,f.useRadians&&(d.rotation*=c)),e.hitArea&&f.setHitArea(d,b.generateHitArea(e.hitArea,1,f))},b.generateHitArea=function(a,b,c){if(c||(c=springroll.UIScaler._getAdapter()),b||(b=1),Array.isArray(a)){if(1==b)return new c.Polygon(a);for(var d=[],e=0,f=a.length;f>e;++e)d.push(new c.Point(a[e].x*b,a[e].y*b));return new c.Polygon(d)}return"rect"!=a.type&&a.type?"ellipse"==a.type?new c.Ellipse((a.x-.5*a.w)*b,(a.y-.5*a.h)*b,a.w*b,a.h*b):"circle"==a.type?new c.Circle(a.x*b,a.y*b,a.r*b):"sector"==a.type?new c.Sector(a.x*b,a.y*b,a.r*b,a.start,a.end):null:new c.Rectangle(a.x*b,a.y*b,a.w*b,a.h*b)},namespace("springroll").Positioner=b}(),function(a){var b,c=include("springroll.UIElementSettings"),d=include("springroll.UIElement"),e=include("springroll.Positioner"),f=include("springroll.Application"),g=function(a){if(b=include("springroll.Debug",!1),a=Object.merge({enabled:!1,size:null,items:null,display:null,container:null},a),this._items=[],this._size=null,this._scale=1,this._adapter=null,this._backgrounds=[],this._enabled=a.enabled,this.size=a.size,this.display=a.display,a.items){if(!a.container)throw"UIScaler requires container to add items";this.addItems(a.container,a.items)}this._resize=this._resize.bind(this),this.enabled=this._enabled},h=g.prototype={};g.ALIGN_TOP="top",g.ALIGN_BOTTOM="bottom",g.ALIGN_LEFT="left",g.ALIGN_RIGHT="right",g.ALIGN_CENTER="center",g._getAdapter=function(b){if(b===a&&(b=f.instance.display),!b)return null;if(!b.adapter)throw"UIScaler incompatible display";return b.adapter},Object.defineProperty(h,"display",{set:function(a){this._adapter=g._getAdapter(a)}}),Object.defineProperty(h,"size",{set:function(a){if(this._size=a,a){if(!a.width||!a.height)throw"Invalid design settings";var b=f.instance.options;a.maxWidth&&(b.maxWidth=a.maxWidth),a.maxHeight&&(b.maxHeight=a.maxHeight)}},get:function(){return this._size}}),Object.defineProperty(h,"scale",{get:function(){return this._scale}}),Object.defineProperty(h,"numItems",{get:function(){return this._items.length}}),Object.defineProperty(h,"enabled",{get:function(){return this._enabled},set:function(a){this._enabled=a;var b=f.instance;b.off("resize",this._resize),a&&(b.on("resize",this._resize),b.triggerResize())}}),h.removeItems=function(a){var b=this._adapter;this._items.forEach(function(c,d,e){b.contains(a,c.display)&&e.splice(d,1)})},h.addItems=function(a,b){var c,d;for(d in b){if(c=b[d],"object"!=typeof c)throw"Scaler settings must be a plain object "+c;a[d]&&this.addItem(a[d],c)}return f.instance.triggerResize(),this},h.addItem=function(a,b){var f=b.align||g.ALIGN_CENTER;switch(f){case g.ALIGN_CENTER:f=f+"-"+f;break;case g.ALIGN_LEFT:case g.ALIGN_RIGHT:f=g.ALIGN_CENTER+"-"+f;break;case g.ALIGN_TOP:case g.ALIGN_BOTTOM:f=f+"-"+g.ALIGN_CENTER}if(!/^(center|top|bottom)\-(left|right|center)$/.test(f))throw"Item align '"+f+"' is invalid for "+a;e.initItem(a,b,this._adapter),f=f.split("-");var h=new c;return h.vertAlign=f[0],h.horiAlign=f[1],h.titleSafe="all"==b.titleSafe?!0:b.titleSafe,h.maxScale=b.maxScale||NaN,h.minScale=b.minScale||NaN,h.centeredHorizontally=!!b.centeredHorizontally,this._items.push(new d(a,h,this._size,this._adapter)),this},h.addBackground=function(a){if(this._backgrounds.indexOf(a)>-1)throw"Background alread added to UIScaler";return this._backgrounds.push(a),this},h.removeBackground=function(a){for(var b=0,c=this._backgrounds.length;c>b;b++)if(a===this._backgrounds[b])return this._backgrounds.splice(b,1),this;return this},h._resize=function(a,b){var c=this._size,d=c.width/c.height,e=a/b;this._scale=e>d?b/c.height:a/c.width;var f,g=e>=d,h=this._items,i=h.length;if(i>0)for(f=0;i>f;++f)h[f].resize(a,b);var j=this._backgrounds,k=this._adapter;if(i=j.length,i>0){var l,m,n,o,p,q=c.maxWidth||c.width,r={x:0,y:0};for(f=0;i>f;f++)l=j[f],m=k.getBitmapSize(l),o=m.w/q,p=o*(g?c.height:c.width),n=(g?b:a)/p,k.setScale(l,n),r.x=.5*(a-m.w*n),r.y=.5*(b-m.h*n),k.setPosition(l,r)}},h.destroy=function(){if(this.enabled=!1,this._items.length>0)for(var a=0,b=this._items.length;b>a;++a)this._items[a].destroy();this._backgrounds=null,this._adapter=null,this._size=null,this._items=null},namespace("springroll").UIScaler=g}(),function(){var a=include("springroll.ApplicationPlugin"),b=include("springroll.UIScaler"),c=function(){a.call(this)},d=extend(c,a);d.setup=function(){this.scaler=new b,this.once("afterInit",function(){if(!this.config)throw"UIScaler requires config";var a=(include("springroll.Debug",!1),this.config),b=a.scalerSize;if(!b)throw"No 'scalerSize' config";if(!a.scaler)throw"No 'scaler' config";this.scaler.size=b,this.scaler.addItems(this,a.scaler),this.scaler.enabled=!0})},d.preload=function(a){this.scaler.display=this.display,a()},d.teardown=function(){this.scaler.destroy(),this.scaler=null},a.register(c)}(),function(){var a=include("springroll.ApplicationPlugin"),b=function(){a.call(this)},c=extend(b,a);c.setup=function(){this.isIOS=navigator.userAgent.search(/iPhone|iPad|iPod/)>-1,this.isAndroid=navigator.userAgent.search(/Android/)>-1,this.hasTouch=!!("ontouchstart"in window||window.navigator.msPointerEnabled&&window.navigator.msMaxTouchPoints>0||window.navigator.pointerEnabled&&window.navigator.maxTouchPoints>0)},c.preload=function(a){this.filters.add("%INTERACTION%",this.hasTouch?"_touch":"_mouse"),a()},a.register(b)}();}();