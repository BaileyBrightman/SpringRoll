/*! SpringRoll 0.2.2 */
!function(){"use strict";!function(a){function b(a){var b=a.lastIndexOf("."),c=parseInt(a.substr(b+1),10),d=a.substr(0,b).split(":"),e=36e5*parseInt(d[0],10),f=6e3*parseInt(d[1],10),g=1e3*parseInt(d[2],10);return e+f+g+c}var c,d=include("springroll.Application"),e=function(b,d,e){c=include("springroll.Debug",!1),h.push(this),this._captionDict=null,this._textField="string"==typeof d?document.getElementById(d):d||null,this._completeCallback=null,this._lines=[],this._currentAlias=0,this._currentDuration=0,this._currentTime=0,this._currentLine=-1,this._lastActiveLine=-1,this._playing=!1,this._isDestroyed=!1,this.update=this.update.bind(this),this.selfUpdate=this._selfUpdate=e===a?!0:e,this.setDictionary(b||null)},f=e.prototype,g=!1,h=[];Object.defineProperty(e,"muteAll",{get:function(){return g},set:function(a){g=a;for(var b=0,c=h.length;c>b;b++)h[b]._updateCaptions()}}),Object.defineProperty(f,"selfUpdate",{set:function(a){this._selfUpdate=!!a,d.instance.off("update",this.update),this._selfUpdate&&d.instance.on("update",this.update)},get:function(){return this._selfUpdate}}),f.setDictionary=function(a){if(this._captionDict=a,a){var c,d,e,f,g=/[0-9]+\:[0-9]{2}\:[0-9]{2}\.[0-9]{3}/;for(var h in a)if(Array.isArray(a[h])&&(a[h]={lines:a[h]}),c=a[h].lines)for(f=c.length,d=0;f>d;++d)e=c[d],"string"==typeof e.start&&(g.test(e.start)?e.start=b(e.start):e.start=parseInt(e.start,10)),"string"==typeof e.end&&(g.test(e.end)?e.end=b(e.end):e.end=parseInt(e.end,10))}},Object.defineProperty(f,"textField",{set:function(a){i(this._textField,""),this._textField=a||null},get:function(){return this._textField}});var i=function(b,c){if(b){if("function"==typeof b.setText)b.setText(c);else if(b.nodeName)b.innerHTML=c;else{if(b.text===a)throw"Unrecognizable captions text field";b.text=c}return b}};f.hasCaption=function(a){return this._captionDict?!!this._captionDict[a]:!1},f.getFullCaption=function(a,b){if(this._captionDict){b=b||" ";var c,d,e;if(Array.isArray(a))for(e=0;e<a.length;e++)"string"==typeof a[e]&&(d=this.getFullCaption(a[e],b),c?c+=b+d:c=d);else{if(!this._captionDict[a])return a;var f=this._captionDict[a].lines;for(e=0;e<f.length;e++)d=f[e].content,c?c+=b+d:c=d}return c}},f._load=function(a){return this._isDestroyed?void 0:(this._reset(),a?void(this._lines=a.lines):void(this._lines=null))},f._reset=function(){this._currentLine=-1,this._lastActiveLine=-1},Object.defineProperty(f,"playing",{get:function(){return this._playing}}),f._getTotalDuration=function(){var a=this._lines;return a?a[a.length-1].end:0},Object.defineProperty(f,"currentDuration",{get:function(){return this._currentDuration}}),Object.defineProperty(f,"currentAlias",{get:function(){return this._currentAlias}}),f.play=function(a,b){this.stop(),this._completeCallback=b,this._playing=!0,this._currentAlias=a,this._load(this._captionDict[a]),this._currentDuration=this._getTotalDuration(),this.seek(0)},f.stop=function(){this._playing=!1,this._currentAlias=null,this._lines=null,this._completeCallback=null,this._reset(),this._updateCaptions()},f.seek=function(a){var b=this._currentTime=a,c=this._lines;if(!c)return void this._updateCaptions();if(b<c[0].start)return this._currentLine=this._lastActiveLine=-1,void this._updateCaptions();for(var d=c.length,e=0;d>e;e++){if(b>=c[e].start&&b<=c[e].end){this._currentLine=this._lastActiveLine=e,this._updateCaptions();break}b>c[e].end?(this._lastActiveLine=e,this._currentLine=-1,this._updateCaptions()):b<c[e].start&&(this._lastActiveLine=e-1,this._currentLine=-1,this._updateCaptions())}},f._updatePercent=function(a){this._isDestroyed||(this._currentTime=a*this._currentDuration,this._calcUpdate())},f.update=function(a){!this._isDestroyed&&this._playing&&(this._currentTime+=a,this._calcUpdate())},f._calcUpdate=function(){var a=this._lines;if(a){var b=a.length,c=this._lastActiveLine+1,d=b-1,e=this._currentTime;e>=a[d].end?this.stop():d>=c&&e>=a[c].start&&e<=a[c].end?(this._currentLine=this._lastActiveLine=c,this._updateCaptions()):-1!=this._currentLine&&e>a[this._currentLine].end&&(this._lastActiveLine=this._currentLine,this._currentLine=-1,this._updateCaptions())}},f._updateCaptions=function(){i(this._textField,-1==this._currentLine||g?"":this._lines[this._currentLine].content)},f.getLength=function(a){var b=0;if(Array.isArray(a))for(var c=0,d=a.length;d>c;c++)"string"==typeof a[c]?b+=this.getLength(a[c]):"number"==typeof a[c]&&(b+=a[c]);else{if(!this._captionDict[a])return b;var e=this._captionDict[a].lines;b+=e[e.length-1].end}return parseInt(b)},f.destroy=function(){if(!this._isDestroyed){var a=h.indexOf(this);a>-1&&h.splice(a,1),this._isDestroyed=!0,this._captionDict=null,this._lines=null}},namespace("springroll").Captions=e}();}();