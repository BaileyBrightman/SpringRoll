/*! CloudKidFramework 0.0.6 */
!function(){"use strict";!function(a){function b(a){var b=a.lastIndexOf("."),c=parseInt(a.substr(b+1),10),d=a.substr(0,b).split(":"),e=36e5*parseInt(d[0],10),f=6e3*parseInt(d[1],10),g=1e3*parseInt(d[2],10);return e+f+g+c}var c=function(a,b){f.push(this),this._captionDict=null,this._textField="string"==typeof b?document.getElementById(b):b||null,this._completeCallback=null,this._lines=[],this._currentDuration=0,this._currentTime=0,this._currentLine=-1,this._lastActiveLine=-1,this._playing=!1,this._isDestroyed=!1,this.setDictionary(a||null)},d=c.prototype,e=!1,f=[];c.VERSION="${version}",Object.defineProperty(c,"muteAll",{get:function(){return e},set:function(a){e=a;for(var b=0;b<f.length;b++)f[b]._updateCaptions()}}),d.setDictionary=function(a){if(this._captionDict=a,a){var c=/[0-9]+\:[0-9]{2}\:[0-9]{2}\.[0-9]{3}/;for(var d in a){var e=Array.isArray(a[d])?a[d]:a[d].lines;if(e)for(var f=0,g=e.length;g>f;++f){var h=e[f];"string"==typeof h.start&&(h.start=c.test(h.start)?b(h.start):parseInt(h.start,10)),"string"==typeof h.end&&(h.end=c.test(h.end)?b(h.end):parseInt(h.end,10))}else Debug.log("alias '"+d+"' has no lines!")}}},Object.defineProperty(d,"textField",{set:function(a){g(this._textField,""),this._textField=a||null},get:function(){return this._textField}});var g=function(b,c){if(b){if("function"==typeof b.setText)b.setText(c);else if(b.nodeName)b.innerHTML=b;else{if(b.text===a)throw"Unrecognizable captions text field";b.text=c}return b}};d.hasCaption=function(a){return this._captionDict?!!this._captionDict[a]:!1},d.getFullCaption=function(a,b){if(this._captionDict&&this._captionDict[a]){b=b||" ";for(var c,d,e=this._captionDict[a].lines,f=e.length,g=0;f>g;g++)d=e[g].content,0===g?c=d:c+=b+d;return c}},d._load=function(a){return this._isDestroyed?void 0:(this._reset(),a?void(this._lines=a.lines):void(this._lines=null))},d._reset=function(){this._currentLine=-1,this._lastActiveLine=-1},d.isPlaying=function(){return this._playing},d._getTotalDuration=function(){var a=this._lines;return a?a[a.length-1].end:0},Object.defineProperty(d,"currentDuration",{get:function(){return this._currentDuration}}),d.play=function(a,b){this.stop(),this._completeCallback=b,this._playing=!0,this._load(this._captionDict[a]),this._currentDuration=this._getTotalDuration(),this.seek(0)},d.stop=function(){this._lines=null,this._completeCallback=null,this._reset(),this._updateCaptions()},d.seek=function(a){var b=this._currentTime=a,c=this._lines;if(!c)return void this._updateCaptions();if(b<c[0].start)return this._currentLine=this._lastActiveLine=-1,void this._updateCaptions();for(var d=c.length,e=0;d>e;e++){if(b>=c[e].start&&b<=c[e].end){this._currentLine=this._lastActiveLine=e,this._updateCaptions();break}b>c[e].end&&(this._lastActiveLine=e,this._currentLine=-1)}},d._updatePercent=function(a){this._isDestroyed||(this._currentTime=a*this._currentDuration,this._calcUpdate())},d.update=function(a){this._isDestroyed||(this._currentTime+=a,this._calcUpdate())},d._calcUpdate=function(){var a=this._lines;if(a){var b=a.length,c=this._lastActiveLine+1,d=b-1,e=this._currentTime;e>=a[d].end?(this._currentLine=-1,this._updateCaptions()):d>=c&&e>=a[c].start&&e<=a[c].end?(this._currentLine=this._lastActiveLine=c,this._updateCaptions()):-1!=this._currentLine&&e>a[this._currentLine].end&&(this._lastActiveLine=this._currentLine,this._currentLine=-1,this._updateCaptions())}},d._updateCaptions=function(){g(this._textField,-1==this._currentLine||e?"":this._lines[this._currentLine].content)},d.destroy=function(){if(!this._isDestroyed){var a=f.indexOf(this);a>-1&&f.splice(a,1),this._isDestroyed=!0,this._captionDict=null,this._lines=null}},namespace("cloudkid").Captions=c}();}();