/*! SpringRoll 0.3.0 */
!function(){"use strict";!function(a){var b=include("springroll.Loader"),c=include("springroll.EventDispatcher"),d=function(){if(g)throw"Only one Languages can exist at a time!";g=this,c.call(this),this._replace="%LANG%",this._current=null,this._default=null,this.languages=null,this._stringTable=null},e=c.prototype,f=extend(d,c);f.setConfig=function(a){if(!a.languages||!a["default"])throw"Languages requires a language dictionary and a default language!";this._replace=a.replace||this._replace,this._default=a["default"],this.languages=a.languages,this.setLanguage(this.getPreferredLanguages()),this.modifyUrl=this.modifyUrl.bind(this),b.instance.cacheManager.registerURLFilter(this.modifyUrl)};var g=null;Object.defineProperty(d,"instance",{get:function(){return g}}),Object.defineProperty(f,"current",{get:function(){return this._current}}),f.getPreferredLanguages=function(){var b,c=a.navigator;return b=c.languages?c.languages:c.language?[c.language||c.userLanguage]:[]},f.setLanguage=function(a){if(a){Array.isArray(a)||(a=[a]);for(var b,c=0,d=a.length;d>c;++c){var e=a[c].toLowerCase();if(this.languages.indexOf(e)>=0){b=e;break}if(e.indexOf("-")>=0&&(e=e.split("-")[0].toLowerCase(),this.languages.indexOf(e)>=0)){b=e;break}}b||(b=this._default),b!=this._current&&(this._current=b,this.trigger("changed",b))}},f.setStringTable=function(a){this._stringTable=a},f.getString=function(a){return this._stringTable?this._stringTable[a]:null},f.getFormattedString=function(a){var b=this._stringTable?this._stringTable[a]:null;return b?b.format(Array.prototype.slice.call(arguments,1)):null},f.modifyUrl=function(a){for(;a.indexOf(this._replace)>=0;)a=a.replace(this._replace,this._current);return a},f.destroy=function(){b.instance&&b.instance.cacheManager.unregisterURLFilter(this.modifyUrl),this.modifyUrl=this.languages=null,g=null,e.destroy.call(this)},namespace("springroll").Languages=d}(window),function(){var a=include("springroll.ApplicationPlugin"),b=include("springroll.Languages"),c=function(){a.call(this)},d=extend(c,a);d.setup=function(){this.languages=new b},d.teardown=function(){this.languages.destroy(),this.languages=null},a.register(c)}();}();