/*! SpringRoll 0.4.0 */
!function(){"use strict";!function(){var a=function(){this.onComplete=null,this.onCancelled=null,this.eventList=null,this.listIndex=-1,this.instance=null,this.isLooping=!1,this.useCaptions=!1,this._paused=!1,this.duration=0,this.speed=1,this.soundAlias=null,this.soundInst=null,this.playSound=!1,this.soundStart=0,this.soundEnd=0,this.complete=!1,this._position=0,this.isTimer=!1},b=a.prototype;b.reset=function(){return this.instance&&(this.instance.destroy(),this.instance=null),this.complete=!1,this.soundEnd=0,this.soundStart=0,this.playSound=!1,this.soundInst=null,this.soundAlias=null,this.speed=1,this._position=0,this.duration=0,this._paused=!1,this.useCaptions=!1,this.isLooping=!1,this.isTimer=!1,this.listIndex=-1,this.eventList=null,this.onCancelled=null,this.onComplete=null,this},Object.defineProperty(b,"position",{get:function(){return this._position},set:function(a){this._position=a,this.isTimer||this.instance.setPosition(a)}}),b._nextItem=function(){var a=!1;if(this.isLooping){var b=this.soundInst;b&&(b.stop(),this.soundInst=null),a=!0}else if(this.isTimer||this.instance.endAnim(),this.soundEnd=this.soundStart=0,this.isLooping=this.playSound=this.useCaptions=!1,this.soundInst=this.soundAlias=null,++this.listIndex>=this.eventList.length)return void(this.complete=!0);var c=this.eventList[this.listIndex];switch(typeof c){case"object":this.isTimer=!1;var d=this.instance;d.startAnim(c,a),this.duration=d.duration,this.speed=c.speed,this.isLooping=d.isLooping||c.loop,this._position=d.position,c.alias&&(this.soundAlias=c.alias,this.soundStart=c.audioStart,this.playSound=!0,this.useCaptions=c.useCaptions);break;case"number":this.isTimer=!0,this.duration=c,this._position=0;break;case"function":c(),this._nextItem()}},Object.defineProperty(b,"time",{get:function(){return 1e3*this.position},set:function(a){this.position=.001*a}}),Object.defineProperty(b,"paused",{get:function(){return this._paused},set:function(a){if(a!=this._paused){this._paused=!!a;var b=this.soundInst;b&&(this.paused?b.pause():b.unpause())}}}),namespace("springroll").AnimatorTimeline=a}(),function(a){function b(a){return"string"==typeof a}function c(a){return"number"==typeof a}function d(a){return"function"==typeof a}var e,f,g,h,i,j,k,l=include("springroll.AnimatorTimeline"),m=function(a){this.debug=!1,this.captions=null,k=a,h=[],f=[];try{g=new Map,("function"!=typeof g["delete"]||"function"!=typeof g.has||"function"!=typeof g.set||"function"!=typeof g.get)&&(g=null)}catch(b){}j=[],_hasTimelines=!1,i=!1,this._update=this._update.bind(this),e=include("springroll.Debug",!1)},n=m.prototype;n.register=function(a,b){var c=include(a);c.priority=b,h.push(c),h.sort(function(a,b){return b.priority-a.priority})},n.play=function(a,b,c,d){d===!0&&(d=c),Array.isArray(b)||(b=[b]),this.stop(a);var e=this._makeTimeline(a,b,c,d);if(e.eventList&&e.eventList.length>=1)return e._nextItem(),_hasTimelines||this._startUpdate(),g&&g.set(instance,e),f.push(e),_hasTimelines=!0,e;return j.push(e.reset()),c&&c(),null},n._makeTimeline=function(a,e,f,g){var h=j.length?j.pop():new l,i=o(a);if(!i)return null;var m=i.create(a);if(!m)return h;h.instance=m,h.eventList=[],h.onComplete=f,h.onCancelled=g,h.speed=r;for(var n,p,q,r,s,t=0,u=e.length;u>t;++t){var v=e[t];if(b(v)){if(!i.hasAnimation(a,v))continue;h.eventList.push({anim:v,audio:null,start:0,speed:1})}else if("object"==typeof v){if(!i.hasAnimation(a,v.anim))continue;n=v.anim,p=v.audio,q=c(v.start)?.001*v.start:0,r=v.speed>0?v.speed:1,p&&k.sound&&(b(p)?(q=0,s=p):(q=p.start>0?.001*p.start:0,s=p.alias),k.sound.exists(s)&&(k.sound.preload(s),animData.alias=s,animData.audioStart=q,animData.useCaptions=this.captions&&this.captions.hasCaption(s))),h.eventList.push(animData)}else c(v)?h.eventList.push(.001*v):d(v)&&h.eventList.push(v)}return h},n.canAnimate=function(a){return a?!!o(a):!1};var o=function(a){for(var b,c=0,d=h.length;d>c;c++)if(b=h[c],b.test(a))return b;return null};n.hasAnimation=function(a,b){var c=o(a);return c?c.hasAnimation(a,b):!1},n.getDuration=function(a,b){var c=o(a);if(!c)return 0;if(!Array.isArray(b))return c.getDuration(a,b.anim||b);for(var d=0,e=0;e<b.length;++e){var f=b[e];"number"==typeof f?d+=f:"string"==typeof f?d+=c.getDuration(a,f):"object"==typeof f&&f.anim&&(d+=c.getDuration(a,f.anim))}return d},n.stop=function(a,b){var c=p(a);c&&(b&&(c.onComplete=c.onCancelled=null),this._remove(c,!0))},n.stopAll=function(a,b){if(_hasTimelines)for(var c,d=f.length-1;d>=0;--d)c=f[d],(!a||a.contains(c.instance.clip))&&(b&&(c.onComplete=c.onCancelled=null),this._remove(c,!0))},n._remove=function(a,b){var c=f.indexOf(a);if(!(0>c)){var d=a.onComplete,e=a.onCancelled;b&&a.soundInst&&a.soundInst.stop(),g&&g["delete"](a.instance.clip),c==f.length-1?f.pop():f.splice(c,1),_hasTimelines=f.length>0,a.useCaptions&&this.captions.stop(),j.push(a.reset()),_hasTimelines||this._stopUpdate(),b?e&&e():d&&d()}},n.pause=function(){if(!i){i=!0;for(var a=f.length-1;a>=0;--a)f[a].paused=!0;this._stopUpdate()}},n.resume=function(){if(i){i=!1;for(var a=f.length-1;a>=0;--a)f[a].paused=!1;_hasTimelines&&this._startUpdate()}},n.pauseInGroup=function(a,b){if(_hasTimelines&&b)for(var c=f.length-1;c>=0;--c)b.contains(f[c].instance.clip)&&(f[c].paused=a)},n.getTimeline=function(a){return _hasTimelines?p(a):null};var p=function(a){if(g)return g.has(a)?g.get(a):null;for(var b=f.length-1;b>=0;--b)if(f[b].instance.clip===a)return f[b];return null};Object.defineProperty(n,"paused",{get:function(){return i}}),n._startUpdate=function(){k.on("update",this._update)},n._stopUpdate=function(){k.off("update",this._update)},n._update=function(a){for(var b,c,d,e,g=.001*a,h=f.length-1;h>=0;--h){if(b=f[h],!b)return;if(c=b.instance,!b.paused){if(e=0,b.soundInst?b.soundInst.isValid?(d=.001*b.soundInst.position,0>d&&(d=0),e=b.soundStart+d,b.useCaptions&&this.captions.seek(b.soundInst.position)):e=b.duration:e=b.position+g*b.speed,e>=b.duration){for(;e>=b.duration&&(e-=b.duration,b.isLooping&&b.onComplete&&b.onComplete(),b._nextItem(),!b.complete););if(b.complete){this._remove(b);continue}}b.playSound&&e>=b.soundStart?(b.position=b.soundStart,b.playSound=!1,b.soundInst=k.sound.play(b.soundAlias,this._onSoundDone.bind(this,b,b.listIndex,b.soundAlias),q.bind(null,b,b.listIndex)),b.useCaptions&&this.captions.play(b.soundAlias)):b.position=e}}};var q=function(a,b){a.listIndex==b&&(a.soundEnd=a.soundStart+.001*a.soundInst.length)};n._onSoundDone=function(a,b,c){this.captions&&this.captions.currentAlias==c&&this.captions.stop(),a.listIndex==b&&(a.soundEnd>a.position&&(a.position=a.soundEnd),a.soundInst=null)},n.destroy=function(){this.stopAll(null,!0),this.captions=null,k=null,f=null,j=null,g=null,h=null},namespace("springroll").Animator=m}(),function(a){var b=(include("springroll.Application"),function(){this.clip=null,this.position=0,this.duration=0,this.isLooping=!1,this.currentName=null}),c=b.prototype;c.init=function(a){this.clip=a},c.beginAnim=function(a,b){},c.endAnim=function(){},c.setPosition=function(a){},b.test=function(a){return!1},b.hasAnimation=function(a,b){return!1},b.getDuration=function(a,b){return 0},b.extend=function(a,c){return a._pool=[],a.create=function(b){var c=a._pool.length>0?a._pool.pop():new a;return c.init(b),c},a.pool=function(b){b.destroy(),a._pool.push(b)},extend(a,c||b)},c.destroy=function(){this.clip=null},namespace("springroll").AnimatorInstance=b}(),function(a){var b=include("springroll.Application"),c=include("springroll.AnimatorInstance"),d=function(){c.call(this),this.startTime=0,this.length=0,this.firstFrame=-1,this.lastFrame=-1},e=c.extend(d,c);e.init=function(a){a.framerate||(fps=b.instance.options.fps||15,a.framerate=fps),a.tickEnabled=!1,this.clip=a,this.isLooping=!1,this.currentName=null,this.position=this.duration=0},e.beginAnim=function(a,b){for(var c,d=this.currentName=a.anim,e=this.clip.getLabels(),f=d+"_stop",g=d+"_loop",h=-1,i=-1,j=!1,k=0,l=e.length;l>k;++k)if(c=e[k],c.label==d)h=c.position;else{if(c.label==f){i=c.position;break}if(c.label==g){i=c.position,j=!0;break}}this.firstFrame=h,this.lastFrame=i,this.isLooping=j;var m=this.instance.framerate;if(this.startTime=this.firstFrame/m,this.duration=this.length/m,b)this.position=0;else{var n=a.start||0;this.position=0>n?Math.random()*this.duration:n}this.clip.play(),this.clip.elapsedTime=this.startTime+this.position,this.clip.advance()},e.endAnim=function(){this.clip.gotoAndStop(this.lastFrame)},e.setPosition=function(a){this.position=a,this.clip.elapsedTime=this.startTime+a,this.clip.advance()},d.test=function(b){return b.framerate!==a&&b.getLabels!==a&&b.elapsedTime!==a&&b.gotoAndStop!==a&&b.gotoAndPlay!==a&&b.stop!==a&&b.play!==a},d.hasAnimation=function(a,b){for(var c,d=a.getLabels(),e=-1,f=-1,g=b+"_stop",h=b+"_loop",i=0,j=d.length;j>i;++i)if(c=d[i],c.label==b)e=c.position;else if(c.label==g||c.label==h){f=c.position;break}},d.getDuration=function(a,c){for(var d,e=a.getLabels(),f=-1,g=-1,h=c+"_stop",i=c+"_loop",j=0,k=e.length;k>j;++j)if(d=e[j],d.label==c)f=d.position;else if(d.label==h||d.label==i){g=d.position;break}if(f>=0&&g>0){if(!a.framerate){var l=b.instance.options.fps||15;a.framerate=l}return(g-f)/a.framerate*1e3}return 0},e.destroy=function(){this.clip=null},namespace("springroll").GenericMovieClipInstance=d}(),function(){var a=include("springroll.ApplicationPlugin"),b=include("springroll.Animator"),c=new a(50);c.setup=function(){this.animator=new b(this),this.animator.captions=this.captions||null,this.animator.register("springroll.GenericMovieClipInstance",0)},c.teardown=function(){this.animator&&(this.animator.destroy(),this.animator=null)}}();}();