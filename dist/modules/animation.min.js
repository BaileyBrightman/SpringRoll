/*! SpringRoll 0.4.0 */
!function(){"use strict";!function(){var a=function(){this.onComplete=null,this.onCancelled=null,this.eventList=null,this.listIndex=-1,this.instance=null,this.firstFrame=-1,this.lastFrame=-1,this.isLooping=!1,this.length=0,this.useCaptions=!1,this._paused=!1,this.startTime=0,this.duration=0,this.speed=1,this.position=0,this.soundAlias=null,this.soundInst=null,this.playSound=!1,this.soundStart=0,this.soundEnd=0,this.complete=!1},b=a.prototype;b.reset=function(){return this.instance&&(this.instance.destroy(),this.instance=null),this.complete=!1,this.soundEnd=0,this.soundStart=0,this.playSound=!1,this.soundInst=null,this.soundAlias=null,this.position=0,this.speed=1,this.duration=0,this.startTime=0,this._paused=!1,this.useCaptions=!1,this.length=0,this.isLooping=!1,this.firstFrame=-1,this.lastFrame=-1,this.listIndex=-1,this.eventList=null,this.onCancelled=null,this.onComplete=null,this},b._nextItem=function(){var a=!1;if(this.isLooping){var b=this.soundInst;b&&(b.stop(),this.soundInst=null),a=!0}else if(this.soundEnd=this.soundStart=0,this.isLooping=this.playSound=this.useCaptions=!1,this.soundInst=this.soundAlias=null,this.startTime=this.length=0,this.firstFrame=this.lastFrame=-1,++this.listIndex>=this.eventList.length)return void(this.complete=!0);var c=this.eventList[this.listIndex];switch(typeof c){case"object":this.firstFrame=c.first,this.lastFrame=c.last,this.length=this.lastFrame-this.firstFrame;var d=this.instance.framerate;this.startTime=this.firstFrame/d,this.duration=this.length/d,this.speed=c.speed,this.isLooping=c.loop;var e=c.animStart;a?this.position=0:this.position=0>e?Math.random()*this.duration:e,c.alias&&(this.soundAlias=c.alias,this.soundStart=c.audioStart,this.playSound=!0,this.useCaptions=c.useCaptions);break;case"number":this.duration=c,this.position=0;break;case"function":c(),this._nextItem()}},Object.defineProperty(b,"time",{get:function(){return 1e3*this.position},set:function(a){this.position=.001*a}}),Object.defineProperty(b,"paused",{get:function(){return this._paused},set:function(a){if(a!=this._paused){this._paused=!!a;var b=this.soundInst;b&&(this.paused?b.pause():b.unpause())}}}),namespace("springroll").AnimatorTimeline=a}(),function(a){function b(a){return"string"==typeof a}function c(a){return"number"==typeof a}function d(a){return"function"==typeof a}var e,f,g,h,i,j,k,l,m=include("springroll.AnimatorTimeline"),n=function(a){this.debug=!1,this.captions=null,l=a,h=[],g=[],f=[],i={},k=[],_hasTimelines=!1,j=!1,this._update=this._update.bind(this),e=include("springroll.Debug",!1)},o=n.prototype;o.register=function(a,b){var c=include(a);c.priority=b,h.push(c),h.sort(function(a,b){return b.priority-a.priority})},o.play=function(c,e,f,h){var j,k;f&&!d(f)?(k=f,f=k.onComplete,h=k.onCancelled):h===!0&&(h=f),b(e)&&k&&(j=k.audio||k.soundData||null,e={anim:e,audio:j}),Array.isArray(e)||(e=[e]);var l=this._makeTimeline(c,e,f,h),m=l.instance;if(i[m.id]!==a&&this.stop(c),l.eventList&&l.eventList.length>=1)return l._nextItem(),m.elapsedTime=l.startTime+l.position,m.play(),_hasTimelines||this._startUpdate(),g.push(l),i[m.id]=l,_hasTimelines=!0,l;return f&&f(),null},o._makeTimeline=function(a,e,f,g){var h=k.length?k.pop():new m,i=p(a);if(!i)return h;var j;i.framerate?j=i.framerate:(j=l.options.fps||15,j||(j=15),i.framerate=j),h.instance=i,h.eventList=[],h.onComplete=f,h.onCancelled=g,h.speed=r;for(var n,o,q,r,s,t=i.getLabels(),u=0,v=e.length;v>u;++u){var w=e[u];if(b(w))n=w,o=null,q=0,r=1;else{if("object"!=typeof w){if(c(w)){h.eventList.push(.001*w);continue}if(d(w)){h.eventList.push(w);continue}continue}n=w.anim,o=w.audio,q=c(w.start)?.001*w.start:0,r=w.speed>0?w.speed:1}for(var x,y=n+"_stop",z=n+"_loop",A=-1,B=-1,C=!1,D=0,E=t.length;E>D;++D)if(x=t[D],x.label==n)A=x.position;else{if(x.label==y){B=x.position;break}if(x.label==z){B=x.position,C=!0;break}}var F;A>=0&&B>0&&(F={name:n,first:A,last:B,loop:C,speed:r,animStart:q},o&&l.sound&&(b(o)?(q=0,s=o):(q=o.start>0?.001*o.start:0,s=o.alias),l.sound.exists(s)&&(l.sound.preload(s),F.alias=s,F.audioStart=q,F.useCaptions=this.captions&&this.captions.hasCaption(s))),h.eventList.push(F))}return h},o.canAnimate=function(a){return a?!!s(a)||!!r(a):!1};var p=function(a){if(!a)return null;var b=s(a);if(b)return b.instance;var c=r(a);return c?c.create(a):null},q=function(a){var b=r(a.clip);b.pool(a)},r=function(a){for(var b,c=0,d=h.length;d>c;c++)if(b=h[c],b.test(a))return b;return null};o.hasAnimation=function(a,b){var c=s(a);if(c)return c.instance.hasAnimation(b);var d=p(a),e=d.hasAnimation(b);return q(d),e},o.getDuration=function(a,b){var c,d,e=s(a);return e?d=e.instance.getDuration(b):(c=p(a),d=c.getDuration(b),q(c)),d},o.stop=function(a,b){var c=s(a);c&&(b&&(c.onComplete=c.onCancelled=null),this._remove(c,!0))},o.stopAll=function(a,b){if(_hasTimelines){for(var c,d=g.slice(),e=0,f=d.length;f>e;e++)c=d[e],(!a||a.contains(c.instance.clip))&&(b&&(c.onComplete=c.onCancelled=null),this._remove(c,!0));_hasTimelines=!1}},o._remove=function(a,b){var c=f.indexOf(a);if(c>=0&&f.splice(c,1),c=g.indexOf(a),!(0>c)){var d=a.onComplete,e=a.onCancelled;b&&a.soundInst&&a.soundInst.stop(),g.splice(c,1),_hasTimelines=g.length>0,delete i[a.instance.id],a.useCaptions&&this.captions.stop(),k.push(a.reset()),_hasTimelines||this._stopUpdate(),b?e&&e():d&&d()}},o.pause=function(){if(!j){j=!0;for(var a=0,b=g.length;b>a;a++)g[a].paused=!0;this._stopUpdate()}},o.resume=function(){if(j){j=!1;for(var a=0,b=g.length;b>a;a++)g[a].paused=!1;_hasTimelines&&this._startUpdate()}},o.pauseInGroup=function(a,b){if(hasTimelines()&&b)for(var c=0,d=g.length;d>c;c++)b.contains(g[c].instance.clip)&&(g[c].paused=a)},o.getTimeline=function(a){return _hasTimelines?s(a):null};var s=function(a){return a.__animatorId?i[a.__animatorId]||null:null};Object.defineProperty(o,"paused",{get:function(){return j}}),o._startUpdate=function(){l.on("update",this._update)},o._stopUpdate=function(){l.off("update",this._update)},o._update=function(a){for(var b,c,d,e,h,i=.001*a,j=g.length-1;j>=0;--j)if(b=g[j],c=b.instance,!b.paused){if(h=!1,e=0,b.soundInst)if(b.soundInst.isValid){if(d=.001*b.soundInst.position,0>d&&(d=0),b.position=b.soundStart+d,b.useCaptions&&this.captions.seek(b.soundInst.position),b.position>=b.duration){if(c.gotoAndStop(b.lastFrame),e=b.position-b.duration,b._nextItem(),b.complete){f.push(b);continue}h=!0}}else{if(b._nextItem(),b.complete){f.push(b);continue}h=!0}else{if(b.position+=i*b.speed,b.position>=b.duration)if(b.isLooping)e=b.position-b.duration,b._nextItem(),h=!0,b.onComplete&&b.onComplete();else{if(e=b.position-b.duration,b.firstFrame>=0&&c.gotoAndStop(b.lastFrame),b._nextItem(),b.complete){f.push(b);continue}h=!0}!h&&b.playSound&&b.position>=b.soundStart&&(b.position=b.soundStart,b.playSound=!1,b.soundInst=l.sound.play(b.soundAlias,this._onSoundDone.bind(this,b,b.listIndex,b.soundAlias),t.bind(null,b,b.listIndex)),b.useCaptions&&this.captions.play(b.soundAlias))}if(h){for(b.position+=e;b.position>=b.duration;)e=b.position-b.duration,b._nextItem(),b.complete?(b.firstFrame>=0&&c.gotoAndStop(b.lastFrame),f.push(b)):b.position+=e;b.firstFrame>=0&&c.gotoAndPlay(b.firstFrame),b.playSound&&b.position>=b.soundStart&&(b.position=b.soundStart,b.playSound=!1,b.soundInst=l.sound.play(b.soundAlias,this._onSoundDone.bind(this,b,b.listIndex,b.soundAlias),t.bind(null,b,b.listIndex)),b.useCaptions&&this.captions.play(b.soundAlias))}b.firstFrame>=0&&(c.elapsedTime=b.startTime+b.position)}if(f){var k=f.length;for(j=0;k>j;j++)b=f[j],this._remove(b)}};var t=function(a,b){a.listIndex==b&&(a.soundEnd=a.soundStart+.001*a.soundInst.length)};o._onSoundDone=function(a,b,c){this.captions&&this.captions.currentAlias==c&&this.captions.stop(),a.listIndex==b&&(a.soundEnd>0&&a.soundEnd>a.position&&(a.position=a.soundEnd),a.soundInst=null)},o.destroy=function(){this.stopAll(null,!0),this.captions=null,l=null,g=null,k=null,f=null,i=null,h=null,_hasTimelines=!1},namespace("springroll").Animator=n}(),function(a){var b=0,c=function(){this.clip=null},d=c.prototype;d.init=function(a){this.clip=a,a.__animatorId=++b},c.test=function(b){return b.framerate!==a&&b.getLabels!==a&&b.elapsedTime!==a&&b.gotoAndStop!==a&&b.gotoAndPlay!==a&&b.stop!==a&&b.play!==a},c.extend=function(a,b){return a._pool=[],a.create=function(b){var c=a._pool.length>0?a._pool.pop():new a;return c.init(b),c},a.pool=function(b){b.destroy(),a._pool.push(b)},extend(a,b||c)},Object.defineProperty(d,"framerate",{get:function(){return this.clip.framerate},set:function(a){this.clip.framerate=a}}),Object.defineProperty(d,"elapsedTime",{get:function(){return this.clip.elapsedTime},set:function(a){this.clip.elapsedTime=a}}),Object.defineProperty(d,"id",{get:function(){return this.clip.__animatorId}}),d.getLabels=function(){return this.clip.getLabels()},d.gotoAndStop=function(a){this.clip.gotoAndStop(a)},d.gotoAndPlay=function(a){this.clip.gotoAndPlay(a)},d.play=function(){this.clip.play()},d.stop=function(){this.clip.stop()},d.hasAnimation=function(a){for(var b,c=this.getLabels(),d=-1,e=-1,f=a+"_stop",g=a+"_loop",h=0,i=c.length;i>h;++h)if(b=c[h],b.label==a)d=b.position;else if(b.label==f||b.label==g){e=b.position;break}},d.getDuration=function(a){if(Array.isArray(a)){for(var b=0,c=0,d=a.length;d>c;c++)b+=this.getDuration(a[c]);return b}if("number"==typeof a)return a;if("object"==typeof a&&a.anim)a=a.anim;else if("string"!=typeof a)return 0;for(var e,f=this.getLabels(),g=-1,h=-1,i=a+"_stop",j=a+"_loop",k=0,l=f.length;l>k;++k)if(e=f[k],e.label==a)g=e.position;else if(e.label==i||e.label==j){h=e.position;break}if(g>=0&&h>0){if(!this.framerate){var m=_app.options.fps;m||(m=15),this.framerate=m}return(h-g)/this.framerate*1e3}return 0},d.destroy=function(){this.stop(),delete this.clip.__animatorId,this.clip=null},namespace("springroll").AnimatorInstance=c}(),function(){var a=include("springroll.ApplicationPlugin"),b=include("springroll.Animator"),c=new a(50);c.setup=function(){this.animator=new b(this),this.animator.captions=this.captions||null,this.animator.register("springroll.AnimatorInstance",0)},c.teardown=function(){this.animator&&(this.animator.destroy(),this.animator=null)}}();}();