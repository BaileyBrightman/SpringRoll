/*! SpringRoll 0.3.0 */
!function(){"use strict";!function(a,b){var c=include("springroll.Loader"),d=include("springroll.EventDispatcher"),e=function(a){if(i)throw"Only one Language can exist at a time!";i=this,d.call(this),this._replace="%LANG%",this._current=null,this._default=null,this.languages=null,this._stringTable=null},f=d.prototype,g=e.prototype=Object.create(f),h="changed";g.setConfig=function(a){if(!a.languages||!a["default"])throw"Language requires a language dictionary and a default language!";this._replace=a.replace||this._replace,this._default=a["default"],this.languages=a.languages,this.setLanguage(this.getPreferredLanguages()),this.modifyUrl=this.modifyUrl.bind(this),c.instance.cacheManager.registerURLFilter(this.modifyUrl)};var i=null;Object.defineProperty(e,"instance",{get:function(){return i}}),Object.defineProperty(g,"current",{get:function(){return this._current}}),g.getPreferredLanguages=function(){var b,c=a.navigator;return b=c.languages?c.languages:c.language?[c.language||c.userLanguage]:[]},g.setLanguage=function(a){if(a){Array.isArray(a)||(a=[a]);for(var b,c=0,d=a.length;d>c;++c){var e=a[c].toLowerCase();if(this.languages.indexOf(e)>=0){b=e;break}if(e.indexOf("-")>=0&&(e=e.split("-")[0].toLowerCase(),this.languages.indexOf(e)>=0)){b=e;break}}b||(b=this._default),b!=this._current&&(this._current=b,this.trigger(h,b))}},g.setStringTable=function(a){this._stringTable=a},g.getString=function(a){return this._stringTable?this._stringTable[a]:null},g.getFormattedString=function(a){var b=this._stringTable?this._stringTable[a]:null;return b?b.format(Array.prototype.slice.call(arguments,1)):null},g.modifyUrl=function(a){for(;a.indexOf(this._replace)>=0;)a=a.replace(this._replace,this._current);return a},g.destroy=function(){c.instance&&c.instance.cacheManager.unregisterURLFilter(this.modifyUrl),this.modifyUrl=this.languages=null,i=null,f.destroy.call(this)},namespace("springroll").Language=e}(window),function(){var a=include("springroll.ApplicationPlugin"),b=include("springroll.Language"),c=function(){a.call(this)},d=extend(c,a);d.init=function(){this.language=new b},d.destroy=function(){this.language.destroy(),this.language=null},a.register(c)}();}();