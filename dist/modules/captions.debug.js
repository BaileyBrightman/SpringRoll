/*! CloudKidFramework 0.0.3 */
!function(){function a(a){var b=a.lastIndexOf("."),c=parseInt(a.substr(b+1),10),d=a.substr(0,b).split(":"),e=36e5*parseInt(d[0],10),f=6e3*parseInt(d[1],10),g=1e3*parseInt(d[2],10);return e+f+g+c}var b,c,d=function(a,d){b=cloudkid.Audio,c=cloudkid.Application,this.initialize(a,d)},e=d.prototype;e._captionDict=null,e._textField=null,e._completeCallback=null,e._lines=null,e._currentDuration=0,e._currentTime=0,e._currentLine=-1,e._lastActiveLine=-1,e._playing=!1;var f=null,g=!1;e._isSlave=!1,e.textIsProp=!0,e._animTimeline=null,e._isDestroyed=!1,e._boundUpdate=null,e._boundComplete=null,d.VERSION="${version}",d.init=function(a,b){f=new d(a,b)},Object.defineProperty(d,"instance",{get:function(){return f}}),e.initialize=function(a,b){this._lines=[],this.setDictionary(a||null),this.setTextField(b),this._boundUpdate=this._updatePercent.bind(this),this._boundComplete=this._onSoundComplete.bind(this),this._updateToAnim=this._updateToAnim.bind(this)},d.setMuteAll=function(a){g=a,f&&f._updateCaptions()},d.getMuteAll=function(){return g},e.setDictionary=function(b){if(this._captionDict=b,b){var c=/[0-9]+\:[0-9]{2}\:[0-9]{2}\.[0-9]{3}/;for(var d in b){var e=Array.isArray(b[d])?b[d]:b[d].lines;if(e)for(var f=0,g=e.length;g>f;++f){var h=e[f];"string"==typeof h.start&&(h.start=c.test(h.start)?a(h.start):parseInt(h.start,10)),"string"==typeof h.end&&(h.end=c.test(h.end)?a(h.end):parseInt(h.end,10))}else Debug.log("alias '"+d+"' has no lines!")}}},e.setTextField=function(a){this._textField&&(this.textIsProp?this._textField.text="":this._textField.setText("")),this._textField=a||null},e.hasCaption=function(a){return this._captionDict?!!this._captionDict[a]:!1},e.getFullCaption=function(a,b){if(this._captionDict&&this._captionDict[a]){b=b||" ";for(var c,d,e=this._captionDict[a].lines,f=e.length,g=0;f>g;g++)d=e[g].content,0===g?c=d:c+=b+d;return c}},e._load=function(a){return this._isDestroyed?void 0:(this._reset(),a?void(this._lines=a.lines):void(this._lines=null))},e._reset=function(){this._currentLine=-1,this._lastActiveLine=-1},e.isPlaying=function(){return this._playing},e._getTotalDuration=function(){var a=this._lines;return a?a[a.length-1].end:0},Object.defineProperty(e,"currentDuration",{get:function(){return this._currentDuration}}),Object.defineProperty(e,"isSlave",{get:function(){return this._isSlave},set:function(a){this._isSlave=a}}),e.play=function(a,c){return this.stop(),this._completeCallback=c,this._playing=!0,this._load(this._captionDict[a]),this._isSlave?this._currentDuration=this._getTotalDuration():(this._currentDuration=1e3*b.instance.getLength(a),b.instance.play(a,this._boundComplete,null,this._boundUpdate)),this.seek(0),this._isSlave?this._boundUpdate:void 0},e.run=function(a){if(!this._isSlave)throw"Captions.isSlave needs to be set to tru to use run";return this.play(a)},e.runWithAnimation=function(a){a.soundAlias&&(this.stop(),this._animTimeline=a,this._load(this._captionDict[a.soundAlias]),c.instance.on("update",this._updateToAnim))},e._onSoundComplete=function(){var a=this._completeCallback;this.stop(),a&&a()},e.stop=function(){!this._isSlave&&this._playing&&(b.instance.stop(),this._playing=!1),this._animTimeline&&(this._animTimeline=null,c.instance.off("update",this._updateToAnim)),this._lines=null,this._completeCallback=null,this._reset(),this._updateCaptions()},e.seek=function(a){var b=this._currentTime=a,c=this._lines;if(!c)return void this._updateCaptions();if(b<c[0].start)return currentLine=this._lastActiveLine=-1,void this._updateCaptions();for(var d=c.length,e=0;d>e;e++){if(b>=c[e].start&&b<=c[e].end){this._currentLine=this._lastActiveLine=e,this._updateCaptions();break}b>c[e].end&&(this._lastActiveLine=e,this._currentLine=-1)}},e._updateToAnim=function(){!this._animTimeline||!this._animTimeline.playSound&&!this._animTimeline.soundInst||this._animTimeline.soundInst&&!this._animTimeline.soundInst.isValid?this.stop():this._animTimeline.soundInst&&this.seek(this._animTimeline.soundInst.position)},e._updatePercent=function(a){this._isDestroyed||(this._currentTime=a*this._currentDuration,this._calcUpdate())},e.updateTime=function(a){this._isDestroyed||(this._currentTime+=a,this._calcUpdate())},e._calcUpdate=function(){var a=this._lines;if(a){var b=a.length,c=this._lastActiveLine+1,d=b-1,e=this._currentTime;e>=a[d].end?(this._currentLine=-1,this._updateCaptions()):d>=c&&e>=a[c].start&&e<=a[c].end?(this._currentLine=this._lastActiveLine=c,this._updateCaptions()):-1!=this._currentLine&&e>a[this._currentLine].end&&(this._lastActiveLine=this._currentLine,this._currentLine=-1,this._updateCaptions())}},e._updateCaptions=function(){if(this._textField){var a=-1==this._currentLine||g?"":this._lines[this._currentLine].content;this.textIsProp?this._textField.text=a:this._textField.setText(a)}},e.destroy=function(){this._isDestroyed||(this._isDestroyed=!0,f===this&&(f=null),this._captionDict=null,this._lines=null)},namespace("cloudkid").Captions=d}();