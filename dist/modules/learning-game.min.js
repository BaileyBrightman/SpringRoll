/*! SpringRoll 0.3.0 */
!function(){"use strict";!function(){var a=function(){},b=a.prototype;b._filters=[],b.add=function(a,b){if(!a||"string"!=typeof a&&a instanceof RegExp==!1)throw"invalide replace value";if("string"!=typeof b)throw"invalid replacement value";if(this._filters){for(var c=this._filters.length-1;c>=0;c--)if(a.toString()==this._filters[c].replace.toString())throw"Filter already exists.";this._filters.push({replace:a,replacement:b})}},b.filter=function(a){if(!this._filters)return a;for(var b=this._filters.length-1;b>=0;b--){var c=this._filters[b].replace,d=this._filters[b].replacement;a=a.replace(c,d)}return a},b.destroy=function(){this._filters=null},namespace("springroll").StringFilters=a}(),function(){var a=(include("springroll.Debug",!1),include("springroll.StringFilters"),function(a){this.filters=a.filters,this.learning=a.learning,this.player=a.player,this.display=a.display}),b=a.prototype;b.playMovie=function(a,b,c,d){return this.learning?this.triggerMoviePlay(a,b,c,d,"movie"):this.display.animator.play(a,b,options)},b.playInstruction=function(a,b,c,d){var e=this.learning,f=this.display.animator;return f.canAnimate(a)?e?this.triggerMoviePlay(a,b,c,d,"instruction"):f.play(a,b,c,d):(d=c,c=b,b=a,e?void this.triggerVOPlay(b,e.startInstruction,e.endInstruction,c,d):void this.player.play(b,c,d))},b.playIncorrectFeedback=function(a,b,c,d){var e=this.learning,f=this.display.animator;return f.canAnimate(a)?e?this.triggerMoviePlay(a,b,c,d,"incorrect"):f.play(a,b,c,d):(d=c,c=b,b=a,e?void this.triggerVOPlay(b,e.startIncorrectFeedback,e.endIncorrectFeedback,c,d):void this.player.play(b,c,d))},b.playCorrectFeedback=function(a,b,c,d){var e=this.learning,f=this.display.animator;return f.canAnimate(a)?e?this.triggerMoviePlay(a,b,c,d,"correct"):f.play(a,b,c,d):(d=c,c=b,b=a,e?void this.triggerVOPlay(b,e.startCorrectFeedback,e.endCorrectFeedback,c,d):void this.player.play(b,c,d))},b.triggerVOPlay=function(a,b,d,e,f){var g=this.display.animator;this.player.stop(),this._learningAnimatorInstance&&g.stop(this._learningAnimatorInstance);var h=this.player.captions,i=function(a){d.call(this.learning),a&&a()};f===!0&&(f=e),this.player.play(a,i.bind(this,e),i.bind(this,f)),b.call(this.learning,h.getFullCaption(a),c(a),"audio",h.getLength(a))},b.triggerMoviePlay=function(a,b,c,d,e){var f=this.learning,g=this.display.animator;this.player.stop(),this._learningAnimatorInstance&&g.stop(this._learningAnimatorInstance),Array.isArray(b)||(b=[b]);for(var h,i,j,k,l,m,n,o=0,p="",q="",r=this.player.captions,s=0,t=b.length;t>s;++s){switch(h=b[s],n=null,m=null,typeof h){case"number":o+=h;break;case"string":h=this.filters.filter(h),o+=g.getDuration(a,h),n=h,m=r.getFullCaption(h),b[s]={anim:h,audio:h};break;case"object":h.anim=i=this.filters.filter(h.anim),h.audio&&("object"==typeof h.audio?h.audio.alias=j=this.filters.filter(h.audio.alias):h.audio=j=this.filters.filter(h.audio)),o+=g.getDuration(a,i),j?"string"!=typeof j&&(j=j.alias):j=i,m=r.getFullCaption(j),n=j}n&&(q.length>0&&(q+=","),q+=n),m&&(p.length>0&&(p+=" "),p+=m)}switch(o=0|o,e){case"instruction":f.startInstruction(p,q,"animation",o),k=f.endInstruction.bind(f);break;case"correct":f.startCorrectFeedback(p,q,"animation",o),k=f.endCorrectFeedback.bind(f);break;case"incorrect":f.startIncorrectFeedback(p,q,"animation",o),k=f.endIncorrectFeedback.bind(f);break;case"movie":f.startMovie(q,o,p),k=f.endMovie.bind(f),l=f.skipMovie.bind(f)}var u=function(a,b){this._learningAnimatorInstance=null,a&&a(),b&&b()},v=u.bind(this,k,c),w=u.bind(this,l?l:k,d===!0?c:d);return this._learningAnimatorInstance=a,g.play(a,b,v,w)};var c=function(a){if(Array.isArray(a)){for(var b="",c=0,d=a.length;d>c;++c)"string"==typeof a[c]&&(b.length>0&&(b+=","),b+=a[c]);return b}return String(a)};b.stop=function(){this._learningAnimatorInstance?this.display.animator.stop(this._learningAnimatorInstance):this.player.stop()},b.isPlaying=function(){return this.player.playing||!!this._learningAnimatorInstance},b.destroy=function(){this.learning=null,this.player=null},namespace("springroll").LearningGameMedia=a}(),function(){var a,b,c=include("springroll.Debug",!1),d=(include("springroll.DebugOptions",!1),include("springroll.Captions"),include("springroll.Application")),e=include("Bellhop"),f=include("springroll.TaskManager"),g=include("springroll.LoadTask"),h=include("springroll.UIScaler"),i=include("springroll.LearningGameMedia"),j=include("springroll.StringFilters"),k=include("springroll.PageVisibility"),l=function(c){if(b=include("springroll.HintPlayer",!1),a=include("springroll.LearningDispatcher",!1),d.call(this,Object.merge({configPath:"assets/config/config.json",debug:!1,useQueryString:!1,cacheBust:!1,canvasId:"stage",resizeElement:"frame",singlePlay:!1,playOptions:null},c)),!this.name)throw"LearningGame name is undefined";if(this.learning=null,this.filters=null,this.scaler=null,this.config=null,this.media=null,this.singlePlay=!!this.options.singlePlay,this.playOptions=this.options.playOptions||{},this.messenger=new e,this.messenger.connect(),this.messenger.supported){var f=this.messenger;f.on({soundMuted:x.bind(this),captionsMuted:y.bind(this),musicMuted:z.bind(this,"music"),voMuted:z.bind(this,"vo"),sfxMuted:z.bind(this,"sfx"),captionsStyles:w.bind(this),pause:p.bind(this),singlePlay:r.bind(this),playOptions:q.bind(this),close:t.bind(this)}),this.autoPause=!1,this._pageVisibility=new k(f.send.bind(f,"gameFocus",!0),f.send.bind(f,"gameFocus",!1))}this.hint=b?new b(this):null,this.filters=new j,this.filters.add("%INTERACTION%",this.hasTouch?"_touch":"_mouse"),this.once("beforeInit",o.bind(this))},m=d.prototype,n=extend(l,d),o=function(){this._readyToInit=!1;var a=[new g("config",this.options.configPath,u.bind(this))];this.trigger("loading",a),f.process(a,v.bind(this))},p=function(a){this.paused=!!a.data,this.enabled=!this.paused},q=function(a){Object.merge(this.playOptions,a.data||{})},r=function(){this.singlePlay=!0};n.singlePlayEnd=function(){this.singlePlay&&this.endGame()};var s=function(){return void this.endGame("left_site")},t=function(){this.endGame("closed_container")},u=function(b,c,d){var e=this.config=b.content,f=e.sounds;f&&(f.vo&&this.addSounds(f.vo),f.sfx&&this.addSounds(f.sfx),f.music&&this.addSounds(f.music)),a&&e.spec&&(this.learning=new a(this,e.spec,!1,e.specDictionary||null),this.learning.on("learningEvent",this.learningEvent.bind(this)),window.onunload=window.onbeforeunload=s.bind(this)),this.media=new i(this),this.trigger("configLoaded",e,d)},v=function(){this.trigger("addStates");var a=this.config,b=a.designedSettings;if(!b)throw"'designedSettings' required in config";if(!a.scaling)throw"'scaling' required in config";this.scaler=new h(this,b,a.scaling,!0,this.display),this.messenger.send("loadDone"),this.learning&&this.learning.startGame(),this._readyToInit=!0,this.trigger("loaded"),this._doInit()},w=function(a){var b=a.data,c=this.captions||{},d=c.textField||null;d&&d.nodeName&&(d.className="size-"+b.size+" bg-"+b.background+" color-"+b.color+" edge-"+b.edge+" font-"+b.font+" align-"+b.align)},x=function(a){this.sound.muteAll=!!a.data},y=function(a){this.captions.muteAll=!!a.data},z=function(a,b){this.sound.setContextMute(a,!!b.data)};n.learningEvent=function(a){this.messenger.send("learningEvent",a)},n.analyticEvent=function(a,b,c){this.messenger.send("analyticEvent",{category:this.name,action:a,label:b,value:c})},n.normalizePosition=function(a,b,c){if(a instanceof createjs.Point&&(c=b,b=a.y,a=a.x),c&&c.localToGlobal){var d=c.localToGlobal(a,b);a=d.x,b=d.y}var e=this.display;return{x:0|a,y:0|b,stage_width:e.width,stage_height:e.height}},n.endGame=function(a){window.onunload=window.onbeforeunload=null,this.learning&&this.learning.endGame(a||"game_completed"),this.destroy()},n.destroy=function(){this.hint&&(this.hint.destroy(),this.hint=null),this.scaler&&(this.scaler.destroy(),this.scaler=null),this.media&&(this.media.destroy(),this.media=null),this._pageVisibility&&(this._pageVisibility.destroy(),this._pageVisibility=null),this.config=null;try{m.destroy.call(this)}catch(a){c?(c.error(a.message),c.error(a.stack)):console.log(a.message,a.stack)}this.learning&&(this.learning.destroy(),this.learning=null),this.messenger.send("endGame"),this.messenger.destroy(),this.messenger=null},namespace("springroll").LearningGame=l}();}();