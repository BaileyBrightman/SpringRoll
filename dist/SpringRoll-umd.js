!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.window=e.window||{})}(this,function(e){"use strict";var t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},s=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},o=function(){function e(){n(this,e)}return i(e,null,[{key:"minLevel",value:function(t){e.initParams(),"number"!=typeof t?(t=t.toUpperCase(),e.isValidLevelName(t)?window[e.paramKey].minLevel=e.LEVEL[t]:window[e.paramKey].minLevel=e.LEVEL.GENERAL):window[e.paramKey].minLevel=t}},{key:"initParams",value:function(){window[e.paramKey]||(window[e.paramKey]={emitEnabled:!1,enabled:!0,minLevel:1})}},{key:"emit",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Debugger";e.initParams(),e.params.emitEnabled&&window.dispatchEvent(new Event(t))}},{key:"meetsLevelRequirement",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"GENERAL";return e.initParams(),!!(e.isValidLevelName(t)&&e.LEVEL[t]>=e.params.minLevel)}},{key:"log",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"log";if(e.initParams(),e.isEnabled()){for(var n=arguments.length,i=Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];switch(t.toLowerCase()){case"info":var s;return!!e.meetsLevelRequirement("INFO")&&((s=console).info.apply(s,i),e.emit(),!0);case"debug":var o;return!!e.meetsLevelRequirement("DEBUG")&&((o=console).debug.apply(o,i),e.emit(),!0);case"error":var a;return!!e.meetsLevelRequirement("ERROR")&&((a=console).error.apply(a,i),e.emit(),!0);case"warn":var l;return!!e.meetsLevelRequirement("WARN")&&((l=console).warn.apply(l,i),e.emit(),!0);case"log":case"general":default:var u;return!!e.meetsLevelRequirement("GENERAL")&&((u=console).log.apply(u,i),e.emit(),!0)}}}},{key:"isValidLevelName",value:function(t){return e.initParams(),"GENERAL"==t||"DEBUG"==t||"INFO"==t||"WARN"==t||"ERROR"==t}},{key:"assert",value:function(t){if(e.initParams(),!t)throw"Assert Error: "+t}},{key:"isEnabled",value:function(){return window[e.paramKey].enabled}},{key:"enable",value:function(t){e.initParams(),window[e.paramKey].enabled=t}},{key:"params",get:function(){return e.initParams(),window[e.paramKey]}},{key:"LEVEL",get:function(){return{GENERAL:1,DEBUG:2,INFO:3,WARN:4,ERROR:5}}},{key:"paramKey",get:function(){return"__spring_roll_debugger_params__"}}]),e}(),a=function(){function e(){n(this,e),this.listeners=[]}return i(e,[{key:"start",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:15e3;e?(this.length=e,this.timer=setTimeout(this.dispatch.bind(this),e)):o.log("warn","[IdleTimer.start()] must specify a time!")}},{key:"reset",value:function(){this.timer?(clearTimeout(this.timer),this.timer=setTimeout(this.dispatch.bind(this),this.length)):o.log("warn","[IdleTimer.reset()] timer has not been started")}},{key:"stop",value:function(){this.timer?(clearTimeout(this.timer),this.timer=null):o.log("warn","[IdleTimer.reset()] timer has not been started")}},{key:"dispatch",value:function(){var e=this;this.listeners.forEach(function(t){t(e._value)}),this.reset()}},{key:"subscribe",value:function(e){this.listeners.push(e)}},{key:"unsubscribe",value:function(e){this.listeners=this.listeners.filter(function(t){return t!==e})}}]),e}(),l=function e(){n(this,e),"function"!=typeof this.play&&console.error('Springroll Hint Player not implemented correctly. Please ensure you have a "play" function in your class.')},u=function(e){function t(){n(this,t);var e=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.hints=[],e.index=0,e}return r(t,l),i(t,[{key:"play",value:function(){0!=this.hints.length?(this.index>=this.hints.length&&(this.index=0),this.hints[this.index](),this.index++):o.log("warn","[HintSequencePlayer.play()] No hints?!")}},{key:"clear",value:function(){this.hints.length=0}},{key:"add",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];for(var i=t.length,r=0;r<i;r++)this.hints.push(t[r])}},{key:"remove",value:function(){for(var e=this,t=arguments.length,n=Array(t),i=0;i<t;i++)n[i]=arguments[i];for(var r=n.length,s=function(t){e.hints=e.hints.filter(function(e){return e!==n[t]})},o=0;o<r;o++)s(o)}}]),t}(),c=function(){function e(t){n(this,e),this._value=t,this.listeners=[]}return i(e,[{key:"notifyChange",value:function(){var e=this;this.listeners.forEach(function(t){t(e._value)})}},{key:"subscribe",value:function(e){this.listeners.push(e)}},{key:"unsubscribe",value:function(e){this.listeners=this.listeners.filter(function(t){return t!==e})}},{key:"value",get:function(){return this._value},set:function(e){this._value=e,this.notifyChange()}},{key:"hasListeners",get:function(){return this.listeners.length>0}}]),e}(),h=function(){function e(){n(this,e)}return i(e,[{key:"addField",value:function(e,t){if(void 0!==this[e])throw new Error('"'+e+'" is already a registered property');return this[e]=new c(t),this[e]}}]),e}(),f=function(){function e(t){n(this,e),this.width=1,this.height=1,this.callback=t,t instanceof Function&&this.enable(t),this.onResize=this.onResize.bind(this)}return i(e,[{key:"onResize",value:function(e){var t=e.target.innerWidth,n=e.target.innerHeight;this.callback({width:t,height:n,ratio:t/n}),this.width=t,this.height=n}},{key:"enable",value:function(e){e instanceof Function?(this.callback=e,window.addEventListener("resize",this.onResize)):console.warn("Scale Manager was not passed a function")}},{key:"disable",value:function(){window.removeEventListener("resize",this.onResize)}}]),e}(),d=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=t.voice,r=void 0===i?0:i,s=t.rate,o=void 0===s?1:s,a=t.pitch,l=void 0===a?0:a,u=t.volume,c=void 0===u?1:u;n(this,e),this.voiceOptions=[],this.voicesLoaded=!1,this.queue=[],this.options={voice:{},rate:o,pitch:l,volume:c};var h=function(){this.voiceOptions=window.speechSynthesis.getVoices(),this.voice=this.setVoice(r),this.voicesLoaded=!0}.bind(this),f=window.speechSynthesis.getVoices();Array.isArray(f)&&0<f.length?h():window.speechSynthesis.addEventListener("voiceschanged",h,{once:!0})}return i(e,[{key:"pause",value:function(){this.speaking=!1,window.speechSynthesis.pause()}},{key:"resume",value:function(){this.speaking=!0,window.speechSynthesis.resume()}},{key:"cancel",value:function(){this.speaking=!1,this.pause(),this.queue.length=0,window.speechSynthesis.cancel()}},{key:"say",value:function(e){var t=this;if(!this.speaking&&this.voicesLoaded){this.speaking=!0;var n=new SpeechSynthesisUtterance(e);Object.assign(n,this.options),n.onend=function(){t.speaking=!1,0<t.queue.length&&t.say(t.queue.shift())},window.speechSynthesis.speak(n)}else this.queue.push(e)}},{key:"rangeLimit",value:function(e,t,n){return isNaN(n)?(console.warn("'"+n+"' is not a valid number!"),e):n>=t?t:e>=n?e:n}},{key:"setVoice",value:function(e){this.options.voice=this.voiceOptions[e]}},{key:"getVoice",value:function(){return this.options.voice}},{key:"rate",set:function(e){this.options.rate=this.rangeLimit(.1,10,e)},get:function(){return this.options.rate}},{key:"pitch",set:function(e){this.options.pitch=this.rangeLimit(0,2,e)},get:function(){return this.options.pitch}},{key:"volume",set:function(e){this.options.volume=this.rangeLimit(0,1,e)},get:function(){return this.options.volume}}]),e}(),p=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;if(n(this,e),this.element=null,null===document.getElementById("color__filter__svg")){var r=document.createElement("div");r.style.width="0",r.style.height="0",r.style.position="absolute",r.style.opacity="0",r.innerHTML+='<svg id="color__filter__svg" style="width: 0; height: 0; position: absolute;" xmlns="http://www.w3.org/2000/svg"\n      version="1.1">\n      <defs>\n        <filter id="color__filter__protanopia">\n          <feColorMatrix\n            in="SourceGraphic"\n            type="matrix"\n            values="0.567, 0.433, 0,     0, 0\n                    0.558, 0.442, 0,     0, 0\n                    0,     0.242, 0.758, 0, 0\n                    0,     0,     0,     1, 0"/>\n        </filter>\n        <filter id="color__filter__protanomaly">\n          <feColorMatrix\n            in="SourceGraphic"\n            type="matrix"\n            values="0.817, 0.183, 0,     0, 0\n                    0.333, 0.667, 0,     0, 0\n                    0,     0.125, 0.875, 0, 0\n                    0,     0,     0,     1, 0"/>\n        </filter>\n        <filter id="color__filter__deuteranopia">\n          <feColorMatrix\n            in="SourceGraphic"\n            type="matrix"\n            values="0.625, 0.375, 0,   0, 0\n                    0.7,   0.3,   0,   0, 0\n                    0,     0.3,   0.7, 0, 0\n                    0,     0,     0,   1, 0"/>\n        </filter>\n        <filter id="color__filter__deuteranomaly">\n          <feColorMatrix\n            in="SourceGraphic"\n            type="matrix"\n            values="0.8,   0.2,   0,     0, 0\n                    0.258, 0.742, 0,     0, 0\n                    0,     0.142, 0.858, 0, 0\n                    0,     0,     0,     1, 0"/>\n        </filter>\n        <filter id="color__filter__tritanopia">\n          <feColorMatrix\n            in="SourceGraphic"\n            type="matrix"\n            values="0.95, 0.05,  0,     0, 0\n                    0,    0.433, 0.567, 0, 0\n                    0,    0.475, 0.525, 0, 0\n                    0,    0,     0,     1, 0"/>\n        </filter>\n        <filter id="color__filter__tritanomaly">\n          <feColorMatrix\n            in="SourceGraphic"\n            type="matrix"\n            values="0.967, 0.033, 0,     0, 0\n                    0,     0.733, 0.267, 0, 0\n                    0,     0.183, 0.817, 0, 0\n                    0,     0,     0,     1, 0"/>\n        </filter>\n        <filter id="color__filter__achromatopsia">\n          <feColorMatrix\n            in="SourceGraphic"\n            type="matrix"\n            values="0.299, 0.587, 0.114, 0, 0\n                    0.299, 0.587, 0.114, 0, 0\n                    0.299, 0.587, 0.114, 0, 0\n                    0,     0,     0,     1, 0"/>\n        </filter>\n        <filter id="color__filter__achromatomaly">\n          <feColorMatrix\n            in="SourceGraphic"\n            type="matrix"\n            values="0.618, 0.320, 0.062, 0, 0\n                    0.163, 0.775, 0.062, 0, 0\n                    0.163, 0.320, 0.516, 0, 0\n                    0,     0,     0,     1, 0"/>\n        </filter>\n      </defs>\n      </svg>\n      ',document.body.appendChild(r)}t instanceof HTMLElement&&"string"==typeof i&&this.applyFilter(t,i)}return i(e,[{key:"applyFilter",value:function(e,t){this.element=e,this.changeFilter(t)}},{key:"changeFilter",value:function(e){null!==this.element&&(this.element.style.filter="url(#color__filter__"+e+")")}},{key:"removeFilter",value:function(){this.element.style.filter=null}},{key:"types",get:function(){return[{name:"Protanopia",value:"protanopia"},{name:"Protanomaly",value:"protanomaly"},{name:"Deuteranopia",value:"deuteranopia"},{name:"Deuteranomaly",value:"deuteranomaly"},{name:"Tritanopia",value:"tritanopia"},{name:"Tritanomaly",value:"tritanomaly"},{name:"Achromatopsia",value:"achromatopsia"},{name:"Achromatomaly",value:"achromatomaly"}]}}]),e}(),v=function(){function e(t,i,r){n(this,e),this.key=t,this._state=0,this.actions={up:r,down:i}}return i(e,[{key:"updateState",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;e<3&&e>-1&&(this._state=e)}},{key:"action",value:function(){1===this.state?this.actions.down():2===this.state&&(this.actions.up(),this.updateState(0))}},{key:"state",get:function(){return this._state}}]),e}(),y=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];n(this,e),this.assignButtons(t),window.addEventListener("keydown",this.onKeyDown.bind(this)),window.addEventListener("keyup",this.onKeyUp.bind(this))}return i(e,[{key:"update",value:function(){for(var e=0,t=this.keys.length;e<t;e++)this.buttons[this.keys[e]].action()}},{key:"onKeyDown",value:function(e){this.onKey(e,1)}},{key:"onKeyUp",value:function(e){this.onKey(e,2)}},{key:"assignButtons",value:function(e){this.buttons={},this.keys=[];for(var t=0,n=e.length;t<n;t++)this.keys.push(e[t].key),this.buttons[e[t].key]=new v(e[t].key,e[t].down,e[t].up)}},{key:"onKey",value:function(e,t){var n=e.key.toLowerCase();this.buttons[n]&&this.buttons[n].updateState(t)}}]),e}(),g=function(){function e(){n(this,e),this._listeners={}}return i(e,[{key:"on",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this._listeners[e]||(this._listeners[e]=[]),t._priority=parseInt(n)||0,-1===this._listeners[e].indexOf(t)&&(this._listeners[e].push(t),this._listeners[e].length>1&&this._listeners[e].sort(this.listenerSorter))}},{key:"listenerSorter",value:function(e,t){return e._priority-t._priority}},{key:"off",value:function(e,t){if(void 0!==this._listeners[e])if(void 0!==t){var n=this._listeners[e].indexOf(t);-1<n&&this._listeners[e].splice(n,1)}else delete this._listeners[e]}},{key:"trigger",value:function(e){if("string"==typeof e&&(e={type:e}),void 0!==this._listeners[e.type])for(var t=this._listeners[e.type].length-1;t>=0;t--)this._listeners[e.type][t](e)}},{key:"destroy",value:function(){this._listeners={}}}]),e}(),m=function(e){function o(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100*Math.random()|0;n(this,o);var t=s(this,(o.__proto__||Object.getPrototypeOf(o)).call(this));return t.id="BELLHOP:"+e,t.connected=!1,t.isChild=!0,t.connecting=!1,t.origin="*",t._sendLater=[],t.iframe=null,t}return r(o,g),i(o,[{key:"receive",value:function(e){this.target===e.source&&("connected"===e.data?this.onConnectionReceived(e.data):this.connected&&"object"===t(e.data)&&e.data.type&&this.trigger(e.data))}},{key:"onConnectionReceived",value:function(e){this.connecting=!1,this.connected=!0,this.trigger("connected"),this.isChild||this.target.postMessage(e,this.origin);for(var t=0,n=this._sendLater.length;t<n;t++){var i=this._sendLater[t],r=i.type,s=i.data;this.send(r,s)}this._sendLater.length=0}},{key:"connect",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"*";this.connecting||(this.disconnect(),this.connecting=!0,e instanceof HTMLIFrameElement&&(this.iframe=e),this.isChild=void 0===e,this.origin=t,window.addEventListener("message",this.receive.bind(this)),this.isChild&&(window===this.target?this.trigger("failed"):this.target.postMessage("connected",this.origin)))}},{key:"disconnect",value:function(){this.connected=!1,this.connecting=!1,this.origin=null,this.iframe=null,this.isChild=!0,this._sendLater.length=0,window.removeEventListener("message",this.receive)}},{key:"send",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("string"!=typeof e)throw"The event type must be a string";var n={type:e,data:t};this.connecting?this._sendLater.push(n):this.target.postMessage(n,this.origin)}},{key:"fetch",value:function(e,t){var n=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(!this.connecting&&!this.connected)throw"No connection, please call connect() first";this.on(e,function e(i){r&&n.off(i.type,e),t(i)}),this.send(e,i)}},{key:"respond",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.on(e,function r(s){i&&t.off(s.type,r),t.send(e,n)})}},{key:"destroy",value:function(){(function e(t,n,i){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,n);if(void 0===r){var s=Object.getPrototypeOf(t);return null===s?void 0:e(s,n,i)}if("value"in r)return r.value;var o=r.get;return void 0!==o?o.call(i):void 0})(o.prototype.__proto__||Object.getPrototypeOf(o.prototype),"destroy",this).call(this),this.disconnect(),this._sendLater.length=0}},{key:"target",get:function(){return this.isChild?window.parent:this.iframe.contentWindow}}]),o}(),w="ready",k="pause",_="captionsMuted",b="playOptions",L="soundVolume",E="musicVolume",x="voVolume",C="sfxVolume",O="playHelp",T=function(){function e(){var t=this,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=i.features,s=i.hintPlayer,a=void 0===s?new u:s;n(this,e),this.state=new h,this.state.addField(w,!1),this.state.addField(k,!1),this.state.addField(_,!0),this.state.addField(b,{}),this.state.addField(L,1),this.state.addField(E,1),this.state.addField(x,1),this.state.addField(C,1),console.log(a),this.features=Object.assign({captions:!1,sound:!1,vo:!1,music:!1,sfx:!1},r||{}),(this.features.vo||this.features.music||this.features.sfx)&&(this.features.sound=!0),this.container=new m,this.container.connect(),this.container.send("features",this.features),this.container.send("keepFocus",!1),[L,E,x,C,_,k].forEach(function(e){var n=t.state[e];t.container.on(e,function(e){return n.value=e.data})}),[{mute:"soundMuted",volume:L},{mute:"musicMuted",volume:E},{mute:"voMuted",volume:x},{mute:"sfxMuted",volume:C}].forEach(function(e){var n=t.state[e.volume];t.container.on(e.mute,function(e){var t=n._previousValue||1;n._previousValue=n.value,n.value=e.data?0:t})}),window.addEventListener("focus",function(){return t.container.send("focus",!0)}),window.addEventListener("blur",function(){return t.container.send("focus",!1)});var l=/playOptions=[^&$]*/.exec(window.location.search);if(null!==l){var c=l[0],f=decodeURIComponent(c.split("=")[1]);try{this.playOptions=JSON.parse(f)}catch(e){o.log("warn","Failed to parse playOptions from query string:"+e.message)}}this.container.fetch("playOptions",function(e){return t.playOptions.value=e.data});var d=e.validatePlugins();if(d.length>0){var p=d.join(". ")+".";throw new Error(p)}e.sortPlugins(),e._plugins.forEach(function(e){return e.setup(t)});var v=Promise.resolve(),y=function(e){v=v.then(function(){return e.preload(t)})},g=!0,T=!1,S=void 0;try{for(var P,F=e._plugins[Symbol.iterator]();!(g=(P=F.next()).done);g=!0){y(P.value)}}catch(e){T=!0,S=e}finally{try{!g&&F.return&&F.return()}finally{if(T)throw S}}v.catch(function(e){o.log("warn",e)}).then(function(){t.validateListeners()}).catch(function(e){o.log("warn",e)}).then(function(){t.container.send("loaded"),t.state.ready.value=!0}),this.hints=a,this.container.on(O,function(){t.hints?t.hints.play():o.log("warn","[Springroll] Missing IHintPlayer")})}return i(e,[{key:"validateListeners",value:function(){var e=this,t=[],n={captions:_,sound:L,music:E,vo:x,sfx:C};if(Object.keys(n).forEach(function(i){var r=n[i];e.features[i]&&!e.state[r].hasListeners&&t.push(r)}),this.state.pause.hasListeners||t.push("pause"),t.length)throw new Error("Application state is missing required listeners: "+t.join(", ")+".")}}],[{key:"validatePlugins",value:function(){var t=[],n=e._plugins.map(function(e){return e.name});return e._plugins.forEach(function(e){var i=e.name,r=e.required.filter(function(e){return n.indexOf(e)<0}).map(function(e){return'"'+e+'"'});if(0!==r.length){var s='Application plugin "'+i+'" missing required plugins '+r.join(", ");t.push(s)}}),t}},{key:"sortPlugins",value:function(){if(0!==e._plugins.length){var t=e._plugins.map(function(e){return e.name}),n={};e._plugins.forEach(function(e){var i=e.optional.filter(function(n){return-1!==t.indexOf(n)||(o.log("warn",e.name+" missing optional plugin "+n),!1)});n[e.name]={plugin:e,name:e.name,dependencies:[].concat(e.required).concat(i)}});var i=[],r=new Set;if(Object.keys(n).map(function(e){return n[e]}).filter(function(e){return 0===e.dependencies.length}).forEach(function(e){return r.add(e.name)}),0===r.size)throw new Error("Every registered plugin has a dependency!");for(var s=function(){var e=r.values().next().value;r.delete(e),i.push(e),Object.keys(n).forEach(function(t){var s=n[t].dependencies.indexOf(e);s>-1&&n[t].dependencies.splice(s,1),0===n[t].dependencies.length&&-1===i.indexOf(t)&&r.add(t)})};r.size>0;)s();if(Object.keys(n).filter(function(e){return n[e].dependencies.length>0}).length>0)throw new Error("Dependency graph has a cycle");e._plugins=[],i.forEach(function(t){e._plugins.push(n[t].plugin)})}}}]),e}();T._plugins=[],T.uses=function(e){T._plugins.push(e)};var S=function(){function e(t){n(this,e),this.lines=t,this.lines.sort(function(e,t){return e.endTime<t.endTime?-1:e.endTime>t.endTime?1:0}),this.reset()}return i(e,[{key:"reset",value:function(){this.time=0,this.lineIndex=0,this.renderer=null}},{key:"update",value:function(e){var t=this.time+1e3*e;t!==this.time&&(this.updateState(t,this.time),this.time=t)}},{key:"updateState",value:function(e,t){if(!this.isFinished()){for(e>this.lines[this.lineIndex].endTime&&this.renderer.lineEnd();e>this.lines[this.lineIndex].endTime;)if(this.lineIndex++,this.isFinished())return;var n=this.lines[this.lineIndex];e>=n.startTime&&t<n.startTime&&this.renderer.lineBegin(n)}}},{key:"isFinished",value:function(){return this.lineIndex>=this.lines.length}},{key:"start",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{lineBegin:function(){},lineEnd:function(){}};this.reset(),this.renderer=t,this.updateTimeIndex(e),this.updateState(this.time,this.lines[this.lineIndex].startTime-1)}},{key:"updateTimeIndex",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(this.time=e,!this.isFinished())for(var t=this.lines.length-1;t>-1;t--)if(this.lines[t].startTime<=e){this.lineIndex=t;break}}}]),e}(),P=function(){function e(t,i,r){n(this,e),this.startTime=t||0,this.endTime=i||0,this.content="",this.setContent(r)}return i(e,[{key:"setContent",value:function(e){this.content=e}}]),e}(),F=function(){function e(){n(this,e)}return i(e,null,[{key:"createCaptionMap",value:function(e){var t={};for(var n in e){var i=this.createCaption(e[n]);i?t[n]=i:o.log("error","[CaptionFactory.createCaptionMap] failed to create caption:",n)}return t}},{key:"createCaption",value:function(e){for(var t=[],n=0,i=e.length;n<i;n++){var r=this.createLine(e[n]);r&&t.push(r)}if(!(t.length<=0))return new S(t);o.log("error","[CaptionFactory.createCaption] captions should not have 0 lines.")}},{key:"createLine",value:function(e){if("number"==typeof e.start)if("number"==typeof e.end)if("string"==typeof e.content){if(""!==e.content)return new P(e.start,e.end,e.content);o.log("warn","[CaptionFactory.createLine] lineData.content should not be empty","Its recommended to add time to the start of the next line to add delays.")}else o.log("error","[CaptionFactory.createLine] lineData.content must be defined as a string");else o.log("error","[CaptionFactory.createLine] lineData.end must be defined as a number");else o.log("error","[CaptionFactory.createLine] lineData.start must be defined as a number")}}]),e}(),R=function(){function e(t,i){n(this,e),this.captions=F.createCaptionMap(t),this.renderer=i,this.activeCaption=null}return i(e,[{key:"update",value:function(e){this.activeCaption&&(this.activeCaption.update(e),this.activeCaption.isFinished()&&this.stop())}},{key:"start",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(this.stop(),this.activeCaption=this.captions[e],this.activeCaption)return this.renderer.start(n),void this.activeCaption.start(t,this.renderer);o.log("warn","[CaptionPlayer.Start()] caption "+e+" not found")}},{key:"stop",value:function(){this.activeCaption&&this.renderer.stop&&this.renderer.stop(),this.activeCaption=null}}]),e}(),M=function e(){n(this,e),"function"==typeof this.start&&"function"==typeof this.stop&&"function"==typeof this.lineBegin&&"function"==typeof this.lineEnd||console.error('Springroll Caption Renderer not implemented corrected. Please ensure you have a "start", "end", "lineBegin", and "lineEnd" function in your class.')},I=function(e){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};n(this,t);var r=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e instanceof HTMLElement||console.error("Invalid html element provided to renderer"),r.renderTarget=e,r.templateVariables=i,r}return r(t,M),i(t,[{key:"start",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.renderTarget.style.visibility="visible",this.templateVariables=e}},{key:"stop",value:function(){this.renderTarget.style.visibility="hidden",this.templateVariables={}}}]),t}();function j(e,t){return e.replace(/{{([a-zA-Z][A-Za-z0-9]*)}}/g,function(e,n){return t[n]||e})}var K=function(e){function t(){return n(this,t),s(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return r(t,I),i(t,[{key:"lineBegin",value:function(e){this.renderTarget.innerHTML=j(e.content,this.templateVariables)}},{key:"lineEnd",value:function(){this.renderTarget.innerHTML=""}}]),t}(),A=function(e){function t(){return n(this,t),s(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return r(t,I),i(t,[{key:"lineBegin",value:function(e){this.renderTarget.innerText=this.sanitize(j(e.content,this.templateVariables))}},{key:"lineEnd",value:function(){this.renderTarget.textContent=""}},{key:"sanitize",value:function(e){var t=document.createElement("div");return t.innerHTML=e,t.textContent||t.innerText||""}}]),t}(),V=function(){function e(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};n(this,e),this.locales=t.locales,this.setPrimaryLocale(i.language||this.getBrowsersLocaleKey()||t.default),this.setFallbackLocale(i.fallback||t.default)}return i(e,[{key:"resolve",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.language?this.getLocaleKey(t.language):this.primaryLanguage,i=this.getLocaleKey(t.fallback)||this.fallbackLanguage,r=this.locales[n],s=this.locales[i];return r?{path:r.path+e,language:n}:s?{path:s.path+e,language:i}:void 0}},{key:"setPrimaryLocale",value:function(e){var t=this.getLocaleKey(e);return!!t&&(this.primaryLanguage=t,!0)}},{key:"setFallbackLocale",value:function(e){var t=this.getLocaleKey(e);return!!t&&(this.fallbackLanguage=t,!0)}},{key:"getLocaleKey",value:function(e){if(e){var t=e.toLowerCase();if(this.locales[t])return t;if(t.indexOf("-")>0)return t=t.split("-")[0],this.getLocaleKey(t)}}},{key:"getBrowsersLocaleKey",value:function(){for(var e=this.getBrowserLanguages(),t=0,n=e.length;t<n;t++){var i=this.getLocaleKey(e[t]);if(i)return i}}},{key:"getBrowserLanguages",value:function(){return navigator.languages?navigator.languages:navigator.language?[navigator.language||navigator.userLanguage]:[]}}]),e}(),q=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(n(this,e),void 0===t.name)throw new Error("Application plugin not provided a name field");this.name=t.name,this.required=t.required||[],this.optional=t.optional||[]}return i(e,[{key:"setup",value:function(){}},{key:"preload",value:function(){return Promise.resolve()}}]),e}();e.Debugger=o,e.IdleTimer=a,e.IHintPlayer=l,e.HintSequencePlayer=u,e.StateManager=h,e.Property=c,e.ScaleManager=f,e.SpeechSynth=d,e.ColorFilter=p,e.Controller=y,e.Application=T,e.Caption=S,e.CaptionFactory=F,e.CaptionPlayer=R,e.TimedLine=P,e.IRender=M,e.DOMRenderer=I,e.HtmlRenderer=K,e.TemplateRenderer=j,e.TextRenderer=A,e.Localizer=V,e.ApplicationPlugin=q,Object.defineProperty(e,"__esModule",{value:!0})});
