/*! CloudKidFramework 0.0.4 */
!function(){"use strict";!function(a){if(!("namespace"in a)){var b=function(a){for(var b=a.split("."),c=window,d="",e=0,f=b.length;f>e;e++)d=b[e],c[d]=c[d]||{},c=c[d];return c};a.namespace=b}}(window),function(){for(var a=["ms","moz","webkit","o"],b=0;b<a.length&&!window.requestAnimationFrame;++b)window.requestAnimationFrame=window[a[b]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[a[b]+"CancelAnimationFrame"]||window[a[b]+"CancelRequestAnimationFrame"];if(!window.requestAnimationFrame){var c=0;window.requestAnimationFrame=function(a){var b=nowFunc(),d=Math.max(0,16-(b-c)),e=window.setTimeout(function(){a(b+d)},d);return c=b+d,e},window.cancelAnimationFrame=function(a){clearTimeout(a)}}window.requestAnimFrame=window.requestAnimationFrame}(),function(a,b){function c(a){return null===a?String(a):"object"==typeof a||"function"==typeof a?Object.prototype.toString.call(a).match(/\s([a-z]+)/i)[1].toLowerCase()||"object":typeof a}var d=function(){},e=d.prototype;e._listeners=[],e.trigger=function(a){if(this._listeners[a]!==b){var c,d=this._listeners[a];arguments.length>1&&(c=Array.prototype.slice.call(arguments,1));for(var e=d.length-1;e>=0;--e)c?d[e].apply(this,c):d[e]()}},e.on=function(a,b){if("object"===c(a))for(var d in a)a.hasOwnProperty(d)&&this.on(d,a[d]);else if("function"===c(b))for(var e=a.split(" "),f=null,g=0,h=e.length;h>g;g++)f=e[g],this._listeners[f]=this._listeners[f]||[],-1===this._listeners[f].indexOf(b)&&this._listeners[f].push(b);else if("array"===c(b))for(var i=0,j=b.length;j>i;i++)this.on(a,b[i]);return this},e.off=function(a,d){if(a===b)this._listeners=[];else if("array"===c(d))for(var e=0,f=d.length;f>e;e++)this.off(a,d[e]);else for(var g=a.split(" "),h=null,i=0,j=g.length;j>i;i++)if(h=g[i],this._listeners[h]=this._listeners[h]||[],d===b)this._listeners[h].length=0;else{var k=this._listeners[h].indexOf(d);-1!==k&&this._listeners[h].splice(k,1)}return this},e.has=function(a,b){if(!a||!b)return!1;var c=this._listeners[a];return c?c.indexOf(b)>=0:!1},namespace("cloudkid").EventDispatcher=d}(window),function(a,b,c){var d=function(a,b){this.initialize(a,b)},e=d.prototype,f=null;e._onFocus=null,e._onBlur=null,e._onToggle=null,b.hidden!==c?f="visibilitychange":b.mozHidden!==c?f="mozvisibilitychange":b.msHidden!==c?f="msvisibilitychange":b.webkitHidden!==c&&(f="webkitvisibilitychange"),e.initialize=function(c,d){if(f){this._onBlur=d,this._onFocus=c;var e=function(){b.hidden||b.webkitHidden||b.msHidden||b.mozHidden?d():c()};b.addEventListener(f,e,!1),a.addEventListener("pagehide",d),a.addEventListener("pageshow",c),a.addEventListener("blur",d),a.addEventListener("focus",c),a.addEventListener("visibilitychange",e,!1),this._onToggle=e}},e.destroy=function(){f&&(a.removeEventListener("pagehide",this._onBlur),a.removeEventListener("pageshow",this._onFocus),a.removeEventListener("blur",this._onBlur),a.removeEventListener("focus",this._onFocus),a.removeEventListener("visibilitychange",this._onToggle),b.removeEventListener(f,this._onToggle,!1),this._onFocus=null,this._onBlur=null)},namespace("cloudkid").PageVisibility=d}(window,document),function(a){var b=a.performance&&(performance.now||performance.mozNow||performance.msNow||performance.oNow||performance.webkitNow);b&&(performance.now=b);var c={};c.now=b?function(){return performance.now()}:Date.now,namespace("cloudkid").TimeUtils=c}(window),function(a){var b=null,c=function(c){if(B)throw"Only one Application can be opened at a time";B=this,window.Debug!==a&&(b=window.Debug),this.options=c||{},this.display=null,r={},i=this._tick.bind(this),this._internalInit()},d=c.prototype=Object.create(cloudkid.EventDispatcher.prototype);c._globalInit=[],c._globalDestroy=[];var e=null,f=0,g=0,h=0,i=null,j=!1,k=-1,l=!1,m=0,n=0,o=null,p=0,q=null,r=null,s={raf:!0,fps:60,resizeElement:null,uniformResize:!0,queryStringParameters:!1,debug:!1,minLogLevel:0,ip:null,canvasId:null,display:null,displayOptions:null,updateTween:!1},t={width:0,height:0},u="init",v="update",w="resize",x="pause",y="paused",z="resumed",A="destroy";c.registerInit=function(a){c._globalInit.push(a)},c.registerDestroy=function(a){c._globalDestroy.push(a)};var B=null;Object.defineProperty(c,"instance",{get:function(){return B}}),d._internalInit=function(){this.options.parseQueryString&&C(this.options);for(var d in s)this.options.hasOwnProperty(d)||(this.options[d]=s[d]);for(var f=0;f<c._globalInit.length;++f)c._globalInit[f]();l=this.options.raf,this.fps=this.options.fps;var g=this.options.framerate;g&&(e="string"==typeof g?document.getElementById(g):g);var h=this.options.resizeElement;h&&(o="string"==typeof h?document.getElementById(h):h,this._resize=this._resize.bind(this),window.addEventListener("resize",this._resize)),b&&(this.options.debug!==a&&(b.enabled=this.options.debug===!0||"true"===this.options.debug),this.options.minLogLevel!==a&&(b.minLogLevel=parseInt(this.options.minLogLevel,10)),"string"==typeof this.options.ip&&b.connect(this.options.ip)),window.createjs&&createjs.Tween&&this.options.updateTween&&(createjs.Ticker&&createjs.Ticker.setPaused(!0),this.on("update",createjs.Tween.tick)),q=new cloudkid.PageVisibility(this._onVisible.bind(this),this._onHidden.bind(this)),this.options.canvasId&&this.options.display&&this.addDisplay(this.options.canvasId,this.options.display,this.options.displayOptions);var i=function(){this.init&&this.init(),this._resize(),this.paused=!1,this.trigger(u)}.bind(this);this.options.versionsFile!==a?cloudkid.MediaLoader.instance.cacheManager.addVersionsFile(this.options.versionsFile,i):setTimeout(i,0)};var C=function(a){var b=window.location.search;if(!b)return a;var c=b.substr(b.indexOf("?")+1),d=c.indexOf("#");c=0>d?c:c.substring(0,d);for(var e,f=c.split("&"),g=0;g<f.length;g++)e=f[g].split("="),a[e[0]]=e[1];return a};d.init=null,d._onHidden=function(){this.paused=!0},d._onVisible=function(){this.paused=!1},Object.defineProperty(d,"paused",{get:function(){return j},set:function(a){j=!!a,this.trigger(x,j),this.trigger(j?y:z,j),j?-1!=k&&(l?cancelAnimationFrame(k):clearTimeout(k),k=-1):(-1==k&&(k=l?requestAnimFrame(i):D(i)),g=f=cloudkid.TimeUtils.now())}});var D=function(a,b){var c=n;return b&&(c=Math.max(0,n-b)),setTimeout(a,c)};d._resize=function(){if(o){t.width=0|(o.innerWidth||o.clientWidth),t.height=0|(o.innerHeight||o.clientHeight),this.calculateDisplaySize(t),t.width|=0,t.height|=0;for(var a in r)r[a].resize(t.width,t.height);this.trigger(w,t.width,t.height)}},d.calculateDisplaySize=function(a){p&&this.options.uniformResize&&(a.width/a.height<p?a.height=a.width/p:a.width=a.height*p)},d.addDisplay=function(a,b,c){if(!r[a]){var d=r[a]=new b(a,c);return this.display||(this.display=d,p=d.width/d.height),d}},d.getDisplay=function(a){return r[a]},d.getDisplays=function(){var a=[];for(var b in r)a.push(r[b]);return a},d.removeDisplay=function(a){var b=r[a];b&&(b.destroy(),delete r[a])},Object.defineProperty(d,"fps",{get:function(){return m},set:function(a){"number"==typeof a&&(m=a,n=1e3/m|0)}}),Object.defineProperty(d,"raf",{get:function(){return l},set:function(a){l=!!a}}),d._tick=function(){if(j)return void(k=-1);var a=cloudkid.TimeUtils.now(),b=a-f;if(e){h++;var c=a-g;if(c>1e3){var d=1e3/c*h;e.innerHTML="FPS: "+Math.round(1e3*d)/1e3,g=a,h=0}}f=a,this.trigger(v,b);for(var m in r)r[m].render(b);k=l?requestAnimFrame(i):D(i,cloudkid.TimeUtils.now()-f)},d.destroy=function(){this.paused=!0,this.trigger(A);for(var a in r)r[a].destroy();r=null;for(var b=0;b<c._globalDestroy.length;++b)c._globalDestroy[b]();o&&window.removeEventListener("resize",this._resize),e=o=null,q.destroy(),q=null,this._listeners=null,i=null},namespace("cloudkid").Application=c}(),function(a){var b=function(){this.initialize()},c=b.prototype={};c._versions=null,c.cacheBust=!1,c.initialize=function(){this._versions=[];var a=cloudkid.Application.instance.options.cacheBust;this.cacheBust=a?"true"===a||a===!0:!1},c.destroy=function(){this._versions=null},c.addVersionsFile=function(a,b,c){Debug.assert(/^.*\.txt$/.test(a),"The versions file must be a *.txt file");var d=cloudkid.MediaLoader.instance;if(this.cacheBust)return void(b&&b());this.addVersion(a,Math.round(1e5*Math.random()));var e=this;d.load(a,function(a){if(a&&a.content){var d,f,g=a.content.replace(/\r/g,"").split("\n");for(d=0;d<g.length;d++)g[d]&&(f=g[d].split(" "),2==f.length&&e.addVersion((c||"")+f[0],f[1]))}b&&b()})},c.addVersion=function(a,b){var c=this._getVersionByUrl(a);c||this._versions.push({url:a,version:b})},c._getVersionByUrl=function(a){var b,c=this._versions.length;for(b=0;c>b;b++)if(a==this._versions[b].url)return this._versions[b];return null},c.prepare=function(b,c){var d=this._getVersionByUrl(b);if(this.cacheBust&&/(\?|\&)cb\=[0-9]*/.test(b)===!1?(this._cbVal||(this._cbVal=(new Date).getTime().toString()),b=b+(b.indexOf("?")<0?"?":"&")+"cb="+this._cbVal):d&&/(\?|\&)v\=[0-9]*/.test(b)===!1&&(b=b+(b.indexOf("?")<0?"?":"&")+"v="+d.version),c){var e=cloudkid.Application.instance.options.basePath;/^http(s)?\:/.test(b)===!1&&e!==a&&-1==b.search(e)&&(b=e+b)}return b},namespace("cloudkid").CacheManager=b}(),function(){var a=function(){},b=a.prototype;a.PRIORITY_HIGH=1,a.PRIORITY_NORMAL=0,a.PRIORITY_LOW=-1,b.url=null,b.data=null,b.callback=null,b.priority=0,b.progress=0,b.updateCallback=null,b._boundFail=null,b._boundProgress=null,b._boundComplete=null,b.toString=function(){return"[LoaderQueueItem(url:'"+this.url+"', priority:"+this.priority+")]"},b.destroy=function(){this.callback=null,this.updateCallback=null,this.data=null,this._boundFail=null,this._boundProgress=null,this._boundComplete=null},namespace("cloudkid").LoaderQueueItem=a}(),function(){var a=function(){},b=a.prototype;a._instance=null;var c=null,d=null,e=null,f=null,g=null,h=null,i=0,j=null;b._canLoad=!0,b.maxSimultaneousLoads=2,b.cacheManager=null,a.init=function(){return a._instance||(a._instance=new a,a._instance._initialize(),cloudkid.Application.registerDestroy(a._instance.destroy.bind(a._instance))),a._instance},cloudkid.Application.registerInit(a.init),Object.defineProperty(a,"instance",{get:function(){if(!a._instance)throw"Call cloudkid.MediaLoader.init()";return a._instance}}),b.destroy=function(){var b,i,k,l=this.queue;if(l){for(b=0,i=l.length;b>b;++b)l[b].destroy();for(l=f,b=0,i=l.length;b>b;++b)l[b].destroy();for(l=h,b=0,i=l.length;b>b;++b)l[b].destroy();for(k in e)d[k].destroy(),e[k].close()}a._instance=null,this.cacheManager&&this.cacheManager.destroy(),this.cacheManager=null,c=null,h=null,g=null,f=null,d=null,j=null,e=null},b._initialize=function(){f=[],g=[],h=[],c=[],d={},e={},j={},this.cacheManager=new cloudkid.CacheManager},b.load=function(a,b,d,e,f){var g=this._getQI(),h=cloudkid.Application.instance.options.basePath;void 0!==h&&/^http(s)?\:/.test(a)===!1&&-1==a.search(h)&&(g.basePath=h),g.url=a,g.callback=b,g.updateCallback=d||null,g.priority=e||cloudkid.LoaderQueueItem.PRIORITY_NORMAL,g.data=f||null,c.push(g),c.sort(function(a,b){return a.priority-b.priority}),this._tryNextLoad()},b._onLoadFailed=function(a,b){Debug.error("Unable to load file: "+a.url+" - reason: "+b.error);var f=e[a.url];f.removeAllEventListeners(),f.close(),this._poolLoader(f),delete d[a.url],delete e[a.url],j[a.url]?j[a.url]++:j[a.url]=1,j[a.url]>3?this._loadDone(a,null):(i--,c.push(a),this._tryNextLoad())},b._onLoadProgress=function(a,b){a.progress=b.progress,a.updateCallback&&a.updateCallback(a.progress)},b._onLoadCompleted=function(a,b){var c=e[a.url];c.removeAllEventListeners(),c.close(),this._poolLoader(c),delete d[a.url],delete e[a.url],this._loadDone(a,this._getResult(b.result,a.url,c))},b._tryNextLoad=function(){if(!(i>this.maxSimultaneousLoads-1||0===c.length)){i++;var a=c.shift();d[a.url]=a;var b=this._getLoader(a.basePath);e[a.url]=b,b.addEventListener("fileload",a._boundComplete),b.addEventListener("error",a._boundFail),b.addEventListener("fileprogress",a._boundProgress);var f=this.cacheManager.prepare(a.url);b.loadFile(a.data?{id:a.data.id,src:f,data:a.data}:f)}},b._loadDone=function(a,b){i--,a.data&&b&&(b.id=a.data.id),a.callback(b),this._poolQI(a),this._tryNextLoad()},b.cancel=function(a){var b=d[a],f=e[a];if(b&&f)return f.close(),delete e[a],delete d[b.url],i--,this._poolLoader(f),this._poolQI(b),!0;for(var g=0,h=c.length;h>g;g++)if(b=c[g],b.url==a)return c.splice(g,1),this._poolQI(b),!0;return!1},b._getQI=function(){var a;return f.length?a=f.pop():(a=new cloudkid.LoaderQueueItem,a._boundFail=this._onLoadFailed.bind(this,a),a._boundProgress=this._onLoadProgress.bind(this,a),a._boundComplete=this._onLoadCompleted.bind(this,a)),a},b._poolQI=function(a){f.push(a),a.callback=a.updateCallback=a.data=a.url=null,a.progress=0},b._getLoader=function(a){var b;return g.length?(b=g.pop(),b._basePath=a):b=new createjs.LoadQueue(!0,a),createjs.Sound&&b.installPlugin(createjs.Sound),b},b._poolLoader=function(a){a.removeAll(),g.push(a)},b._getResult=function(a,b,c){var d;return h.length?(d=h.pop(),d.content=a,d.url=b,d.loader=c):d=new cloudkid.MediaLoaderResult(a,b,c),d},b._poolResult=function(a){a.content=a.url=a.loader=a.id=null,h.push(a)},namespace("cloudkid").MediaLoader=a}(),function(){var a=function(a,b,c){this.content=a,this.url=b,this.loader=c},b=a.prototype;b.content=null,b.url=null,b.loader=null,b.toString=function(){return"[MediaLoaderResult('"+this.url+"')]"},b.destroy=function(){this.callback=null,this.url=null,this.content=null},namespace("cloudkid").MediaLoaderResult=a}(),function(){var a=function(a,b,c,d){b[c]?b[d]=a:a()};a.create=function(b,c,d,e){return a.bind(this,b,c,d,e)},namespace("cloudkid").CombinedCallback=a}(),function(a){var b={},c=window.Storage!==a,d=-1;if(c)try{localStorage.setItem("LS_TEST","test"),localStorage.removeItem("LS_TEST")}catch(e){c=!1}b.remove=function(a){c?(localStorage.removeItem(a),sessionStorage.removeItem(a)):b.write(a,"",d)},b.write=function(a,b,e){if(c)e?sessionStorage.setItem(a,JSON.stringify(b)):localStorage.setItem(a,JSON.stringify(b));else{var f;f=e?e!==d?"":"; expires=Thu, 01 Jan 1970 00:00:00 GMT":"; expires="+new Date(2147483646e3).toGMTString(),document.cookie=a+"="+escape(JSON.stringify(b))+f+"; path=/"}},b.read=function(a){if(c){var b=localStorage.getItem(a)||sessionStorage.getItem(a);return b?JSON.parse(b):null}var d,e=a+"=",f=document.cookie.split(";"),g=0;for(g=0;g<f.length;g++){for(d=f[g];" "==d.charAt(0);)d=d.substring(1,d.length);if(0===d.indexOf(e))return JSON.parse(unescape(d.substring(e.length,d.length)))}return null},namespace("cloudkid").SavedData=b}(),function(a){var b=cloudkid.Application,c=function(c,d,e,f){this._callback=c,this._delay=d,this._timer=d,this._repeat=!!e,this._autoDestroy=f===a?!0:!!f,this._paused=!1,this._update=this._update.bind(this),b.instance.on("update",this._update)},d=c.prototype;d._update=function(a){return this._callback?(this._timer-=a,void(this._timer<=0&&(this._callback(),this._repeat?this._timer+=this._delay:this._autoDestroy?this.destroy():b.instance.off("update",this._update)))):void this.destroy()},d.restart=function(){if(this._callback){var a=b.instance;a.has("update",this._update)||a.on("update",this._update),this._timer=this._delay,this._paused=!1}},d.stop=function(){b.instance.off("update",this._update),this._paused=!1},Object.defineProperty(d,"paused",{get:function(){return this._paused},set:function(a){if(this._callback){var c=b.instance;this._paused&&!a?(this._paused=!1,c.has("update",this._update)||c.on("update",this._update)):a&&c.has("update",this._update)&&(this._paused=!0,c.off("update",this._update))}}}),d.destroy=function(){b.instance.off("update",this._update),this._callback=null},namespace("cloudkid").DelayedCall=c}();}();