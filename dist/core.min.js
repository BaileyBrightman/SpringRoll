/*! CloudKidFramework 0.0.5 */
!function(){"use strict";!function(a){if(!("namespace"in a)){var b=function(b){for(var c=b.split("."),d=a,e="",f=0,g=c.length;g>f;f++)e=c[f],d[e]=d[e]||{},d=d[e];return d};a.namespace=b}}(window),function(a,b){if(!("include"in a)){var c=function(c,d){var e=c.split("."),f=a,g="";d=d!==b?!!d:!0;for(var h=0,i=e.length;i>h;h++){if(g=e[h],!f[g]){if(!d)return null;throw"Unable to include '"+c+"'"}f=f[g]}return f};a.include=c}}(window),function(a,b){function c(a,b){f.output&&f.output.append('<div class="'+a+'">'+b+"</div>")}function d(a,b){b||(b=1);for(var c="",e="",f=0;4*b>f;++f)c+="&nbsp;",4*(b-1)>f&&(e+="&nbsp;");var g="{<br />";for(var h in a)if("document"!=h&&"window"!=h&&"ownerDocument"!=h&&"view"!=h&&"target"!=h&&"currentTarget"!=h&&"originalTarget"!=h&&"explicitOriginalTarget"!=h&&"rangeParent"!=h&&"srcElement"!=h&&"relatedTarget"!=h&&"fromElement"!=h&&"toElement"!=h)switch(typeof a[h]){case"string":case"number":case"boolean":case"bool":g+=c+h+": "+a[h]+"<br />";break;case"object":g+=c+h+": "+d(a[h],b+1)+"<br />";break;case"function":g+=c+h+": (function)<br />";break;default:g+=c+h+": "+a[h]+"<br />"}return g+=e+"}"}function e(a){return"string"==typeof a?a.replace(/\t/g,"&nbsp;&nbsp;&nbsp;&nbsp;").replace(/\n/g,"<br />"):"object"==typeof a?d(a):a}var f=function(){},g=a.console!==b;f.GENERAL=0,f.DEBUG=1,f.INFO=2,f.WARN=3,f.ERROR=4,f.minLogLevel=f.GENERAL,f.enabled=!0,f.output=null,f._isJSConsole=a.remote===a.console,f._NET_PORT=1025,f._isConnected=!1,f._socket=null,f._messageObj=null,f._messageQueue=null,f.connect=function(b){if(!("WebSocket"in a||"MozWebSocket"in a))return!1;a.WebSocket=WebSocket||MozWebSocket;try{var c=f._socket=new WebSocket("ws://"+b+":"+f._NET_PORT);c.onopen=h,c.onmessage=function(){},c.onclose=j,c.onerror=j,f._messageQueue=[],f._isConnected=!0}catch(d){return!1}return!0},f.disconnect=function(){f._isConnected&&(f._socket.close(),j())};var h=function(){a.onerror=i,f._messageObj={level:"session",message:""},f._socket.send(JSON.stringify(f._messageObj));for(var b=0;b<f._messageQueue.length;++b)f._socket.send(JSON.stringify(f._messageQueue[b]));f._messageQueue=null},i=function(a,b,c){return f.remoteLog("Error: "+a+" in "+b+" at line "+c,"ERROR"),!1},j=function(){a.onerror=null,f._isConnected=!1;var b=f._socket;b.onopen=null,b.onmessage=null,b.onclose=null,b.onerror=null,f._socket=null,f._messageObj=null,f._messageQueue=null};f.remoteLog=function(a,b){b||(b="GENERAL"),f._messageQueue?f._messageQueue.push({message:a,level:b}):(f._messageObj.level=b,f._messageObj.message=a,f._socket.send(JSON.stringify(f._messageObj)))},f.log=function(a){f.enabled&&(f._isConnected?f.remoteLog(a,"GENERAL"):f.minLogLevel==f.GENERAL&&g&&(console.log(f._isJSConsole?e(a):a),c("general",a)))},f.debug=function(a){f.enabled&&(f._isConnected?f.remoteLog(a,"DEBUG"):f.minLogLevel<=f.DEBUG&&g&&(console.debug(f._isJSConsole?e(a):a),c("debug",a)))},f.info=function(a){f.enabled&&(f._isConnected?f.remoteLog(a,"INFO"):f.minLogLevel<=f.INFO&&g&&(console.info(f._isJSConsole?e(a):a),c("info",a)))},f.warn=function(a){f.enabled&&(f._isConnected?f.remoteLog(a,"WARNING"):f.minLogLevel<=f.WARN&&g&&(console.warn(f._isJSConsole?e(a):a),c("warn",a)))},f.error=function(a){f.enabled&&(f._isConnected?f.remoteLog(a,"ERROR"):g&&(console.error(f._isJSConsole?e(a):a),c("error",a)))},f.assert=function(a,b){g&&f.enabled&&console.assert&&(console.assert(a,f._isJSConsole?e(b):b),a||c("error",b))},f.dir=function(a){f.minLogLevel==f.GENERAL&&g&&f.enabled&&console.dir(f._isJSConsole?e(a):a)},f.clear=function(){g&&f.enabled&&(console.clear(),f.output&&f.output.html(""))},f.trace=function(a){f.minLogLevel==f.GENERAL&&g&&f.enabled&&console.trace(f._isJSConsole?e(a):a)},a.Debug=f}(window),function(){for(var a=["ms","moz","webkit","o"],b=0;b<a.length&&!window.requestAnimationFrame;++b)window.requestAnimationFrame=window[a[b]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[a[b]+"CancelAnimationFrame"]||window[a[b]+"CancelRequestAnimationFrame"];if(!window.requestAnimationFrame){var c=0;window.requestAnimationFrame=function(a){var b=nowFunc(),d=Math.max(0,16-(b-c)),e=window.setTimeout(function(){a(b+d)},d);return c=b+d,e},window.cancelAnimationFrame=function(a){clearTimeout(a)}}window.requestAnimFrame=window.requestAnimationFrame}(),function(a){function b(a){return null===a?String(a):"object"==typeof a||"function"==typeof a?Object.prototype.toString.call(a).match(/\s([a-z]+)/i)[1].toLowerCase()||"object":typeof a}var c=function(){this._listeners=[]},d=c.prototype;d.trigger=function(b){if(this._listeners[b]!==a){var c,d=this._listeners[b];arguments.length>1&&(c=Array.prototype.slice.call(arguments,1));for(var e=d.length-1;e>=0;--e)c?d[e].apply(this,c):d[e]()}},d.on=function(a,c){if("object"===b(a))for(var d in a)a.hasOwnProperty(d)&&this.on(d,a[d]);else if("function"===b(c))for(var e=a.split(" "),f=null,g=0,h=e.length;h>g;g++)f=e[g],this._listeners[f]=this._listeners[f]||[],-1===this._listeners[f].indexOf(c)&&this._listeners[f].push(c);else if("array"===b(c))for(var i=0,j=c.length;j>i;i++)this.on(a,c[i]);return this},d.off=function(c,d){if(c===a)this._listeners=[];else if("array"===b(d))for(var e=0,f=d.length;f>e;e++)this.off(c,d[e]);else for(var g=c.split(" "),h=null,i=0,j=g.length;j>i;i++)if(h=g[i],this._listeners[h]=this._listeners[h]||[],d===a)this._listeners[h].length=0;else{var k=this._listeners[h].indexOf(d);-1!==k&&this._listeners[h].splice(k,1)}return this},d.has=function(a,b){if(!a)return!1;var c=this._listeners[a];return c?b?c.indexOf(b)>=0:c.length>0:!1},c.mixIn=function(a,b){a.trigger=d.trigger,a.on=d.on,a.off=d.off,a.has=d.has,b&&c.call(a)},namespace("cloudkid").EventDispatcher=c}(),function(a,b,c){var d=function(a,b){this._onFocus=a,this._onBlur=b,this._onToggle=null,this.initialize()},e=d.prototype,f=null;b.hidden!==c?f="visibilitychange":b.mozHidden!==c?f="mozvisibilitychange":b.msHidden!==c?f="msvisibilitychange":b.webkitHidden!==c&&(f="webkitvisibilitychange"),e.initialize=function(){if(f){var c=function(){b.hidden||b.webkitHidden||b.msHidden||b.mozHidden?this._onBlur():this._onFocus()}.bind(this);b.addEventListener(f,c,!1),a.addEventListener("pagehide",this._onBlur),a.addEventListener("pageshow",this._onFocus),a.addEventListener("blur",this._onBlur),a.addEventListener("focus",this._onFocus),a.addEventListener("visibilitychange",c,!1),this._onToggle=c}},e.destroy=function(){f&&(a.removeEventListener("pagehide",this._onBlur),a.removeEventListener("pageshow",this._onFocus),a.removeEventListener("blur",this._onBlur),a.removeEventListener("focus",this._onFocus),a.removeEventListener("visibilitychange",this._onToggle),b.removeEventListener(f,this._onToggle,!1),this._onFocus=null,this._onBlur=null)},namespace("cloudkid").PageVisibility=d}(window,document),function(){var a=include("performance",!1),b=a&&(a.now||a.mozNow||a.msNow||a.oNow||a.webkitNow);b&&(a.now=b);var c={};c.now=b?function(){return a.now()}:Date.now,namespace("cloudkid").TimeUtils=c}(window),function(a){var b,c,d,e,f=include("cloudkid.EventDispatcher"),g=function(a){if(F)throw"Only one Application can be opened at a time";F=this,f.call(this),b||(b=include("Debug"),c=include("cloudkid.Loader"),d=include("cloudkid.TimeUtils"),e=include("cloudkid.PageVisibility")),this.options=a||{},this.display=null,v={},m=this._tick.bind(this),this._internalInit()},h=g.prototype=Object.create(f.prototype);g._globalInit=[],g._globalDestroy=[];var i=null,j=0,k=0,l=0,m=null,n=!1,o=-1,p=!1,q=0,r=0,s=null,t=0,u=null,v=null,w={raf:!0,fps:60,resizeElement:null,uniformResize:!0,queryStringParameters:!1,debug:!1,minLogLevel:0,ip:null,canvasId:null,display:null,displayOptions:null,updateTween:!1},x={width:0,height:0},y="init",z="update",A="resize",B="pause",C="paused",D="resumed",E="destroy";g.registerInit=function(a){g._globalInit.push(a)},g.registerDestroy=function(a){g._globalDestroy.push(a)};var F=null;Object.defineProperty(g,"instance",{get:function(){return F}}),h._internalInit=function(){this.options.parseQueryString&&G(this.options);for(var d in w)this.options.hasOwnProperty(d)||(this.options[d]=w[d]);for(var f=0;f<g._globalInit.length;++f)g._globalInit[f]();p=this.options.raf,this.fps=this.options.fps;var h=this.options.framerate;h&&(i="string"==typeof h?document.getElementById(h):h);var j=this.options.resizeElement;j&&(s="string"==typeof j?document.getElementById(j):j,this._resize=this._resize.bind(this),window.addEventListener("resize",this._resize)),this.options.debug!==a&&(b.enabled=this.options.debug===!0||"true"===this.options.debug),this.options.minLogLevel!==a&&(b.minLogLevel=parseInt(this.options.minLogLevel,10)),"string"==typeof this.options.ip&&b.connect(this.options.ip);var k=include("createjs.Tween",!1),l=include("createjs.Ticker",!1);k&&this.options.updateTween&&(l&&l.setPaused(!0),this.on("update",k.tick)),u=new e(this._onVisible.bind(this),this._onHidden.bind(this)),this.options.canvasId&&this.options.display&&this.addDisplay(this.options.canvasId,this.options.display,this.options.displayOptions);var m=function(){this.init&&this.init(),this._resize(),this.paused=!1,this.trigger(y)}.bind(this);this.options.versionsFile!==a?c.instance.cacheManager.addVersionsFile(this.options.versionsFile,m):setTimeout(m,0)};var G=function(a){var b=window.location.search;if(!b)return a;var c=b.substr(b.indexOf("?")+1),d=c.indexOf("#");c=0>d?c:c.substring(0,d);for(var e,f=c.split("&"),g=0;g<f.length;g++)e=f[g].split("="),a[e[0]]=e[1];return a};h.init=null,h._onHidden=function(){this.paused=!0},h._onVisible=function(){this.paused=!1},Object.defineProperty(h,"paused",{get:function(){return n},set:function(a){n=!!a,this.trigger(B,n),this.trigger(n?C:D,n),n?-1!=o&&(p?cancelAnimationFrame(o):clearTimeout(o),o=-1):(-1==o&&(o=p?requestAnimFrame(m):H(m)),k=j=d.now())}});var H=function(a,b){var c=r;return b&&(c=Math.max(0,r-b)),setTimeout(a,c)};h._resize=function(){if(s){x.width=0|(s.innerWidth||s.clientWidth),x.height=0|(s.innerHeight||s.clientHeight),this.calculateDisplaySize(x),x.width|=0,x.height|=0;for(var a in v)v[a].resize(x.width,x.height);this.trigger(A,x.width,x.height)}},h.calculateDisplaySize=function(a){t&&this.options.uniformResize&&(a.width/a.height<t?a.height=a.width/t:a.width=a.height*t)},h.addDisplay=function(a,b,c){if(!v[a]){var d=v[a]=new b(a,c);return this.display||(this.display=d,t=d.width/d.height),d}},h.getDisplay=function(a){return v[a]},h.getDisplays=function(){var a=[];for(var b in v)a.push(v[b]);return a},h.removeDisplay=function(a){var b=v[a];b&&(b.destroy(),delete v[a])},Object.defineProperty(h,"fps",{get:function(){return q},set:function(a){"number"==typeof a&&(q=a,r=1e3/q|0)}}),Object.defineProperty(h,"raf",{get:function(){return p},set:function(a){p=!!a}}),h._tick=function(){if(n)return void(o=-1);var a=d.now(),b=a-j;if(i){l++;var c=a-k;if(c>1e3){var e=1e3/c*l;i.innerHTML="FPS: "+Math.round(1e3*e)/1e3,k=a,l=0}}j=a,this.trigger(z,b);for(var f in v)v[f].render(b);o=p?requestAnimFrame(m):H(m,d.now()-j)},h.destroy=function(){this.paused=!0,this.trigger(E);for(var a in v)v[a].destroy();v=null;for(var b=0;b<g._globalDestroy.length;++b)g._globalDestroy[b]();s&&window.removeEventListener("resize",this._resize),i=s=null,u.destroy(),u=null,this._listeners=null,m=null},namespace("cloudkid").Application=g}(),function(a){var b,c,d=function(){b||(b=include("cloudkid.Application"),c=include("cloudkid.Loader")),this._versions=[];var a=b.instance.options.cacheBust;this.cacheBust="true"===a||a===!0},e=d.prototype={};e.destroy=function(){this._versions=null},e.addVersionsFile=function(a,b,d){Debug.assert(/^.*\.txt$/.test(a),"The versions file must be a *.txt file");var e=c.instance;if(this.cacheBust)return void(b&&b());this.addVersion(a,Math.round(1e5*Math.random()));var f=this;e.load(a,function(a){if(a&&a.content){var c,e,g=a.content.replace(/\r/g,"").split("\n");for(c=0;c<g.length;c++)g[c]&&(e=g[c].split(" "),2==e.length&&f.addVersion((d||"")+e[0],e[1]))}b&&b()})},e.addVersion=function(a,b){var c=this._getVersionByUrl(a);c||this._versions.push({url:a,version:b})},e._getVersionByUrl=function(a){var b,c=this._versions.length;for(b=0;c>b;b++)if(a==this._versions[b].url)return this._versions[b];return null},e.prepare=function(c,d){var e=this._getVersionByUrl(c);if(this.cacheBust&&/(\?|\&)cb\=[0-9]*/.test(c)===!1?(this._cbVal||(this._cbVal=(new Date).getTime().toString()),c=c+(c.indexOf("?")<0?"?":"&")+"cb="+this._cbVal):e&&/(\?|\&)v\=[0-9]*/.test(c)===!1&&(c=c+(c.indexOf("?")<0?"?":"&")+"v="+e.version),d){var f=b.instance.options.basePath;/^http(s)?\:/.test(c)===!1&&f!==a&&-1==c.search(f)&&(c=f+c)}return c},namespace("cloudkid").CacheManager=d}(),function(){var a=function(){this.url=null,this.data=null,this.callback=null,this.priority=0,this.progress=0,this.updateCallback=null,this._boundFail=null,this._boundProgress=null,this._boundComplete=null},b=a.prototype;a.PRIORITY_HIGH=1,a.PRIORITY_NORMAL=0,a.PRIORITY_LOW=-1,b.toString=function(){return"[LoaderQueueItem(url:'"+this.url+"', priority:"+this.priority+")]"},b.destroy=function(){this.callback=null,this.updateCallback=null,this.data=null,this._boundFail=null,this._boundProgress=null,this._boundComplete=null},namespace("cloudkid").LoaderQueueItem=a}(),function(){var a,b,c,d,e,f,g=function(){c||(a=include("cloudkid.LoaderQueueItem"),b=include("cloudkid.CacheManager"),c=include("cloudkid.Application"),f=include("cloudkid.LoaderResult"),e=include("createjs.LoadQueue"),d=include("createjs.Sound",!1)),this._canLoad=!0,this.maxSimultaneousLoads=2,this.cacheManager=null},h=g.prototype,i=null,j=null,k=null,l=null,m=null,n=null,o=null,p=0,q=null;g.init=function(){return i||(i=new g,i._initialize(),c.registerDestroy(i.destroy.bind(i))),i},cloudkid.Application.registerInit(g.init),Object.defineProperty(g,"instance",{get:function(){if(!i)throw"Call Loader.init()";return i}}),h.destroy=function(){var a,b,c,d=this.queue;if(d){for(a=0,b=d.length;a>a;++a)d[a].destroy();for(d=m,a=0,b=d.length;a>a;++a)d[a].destroy();for(d=o,a=0,b=d.length;a>a;++a)d[a].destroy();for(c in l)k[c].destroy(),l[c].close()}i=null,this.cacheManager&&this.cacheManager.destroy(),this.cacheManager=null,j=null,o=null,n=null,m=null,k=null,q=null,l=null},h._initialize=function(){m=[],n=[],o=[],j=[],k={},l={},q={},this.cacheManager=new b},h.load=function(b,d,e,f,g){var h=this._getQI(),i=c.instance.options.basePath;void 0!==i&&/^http(s)?\:/.test(b)===!1&&-1==b.search(i)&&(h.basePath=i),h.url=b,h.callback=d,h.updateCallback=e||null,h.priority=f||a.PRIORITY_NORMAL,h.data=g||null,j.push(h),j.sort(function(a,b){return a.priority-b.priority}),this._tryNextLoad()},h._onLoadFailed=function(a,b){Debug.error("Unable to load file: "+a.url+" - reason: "+b.error);var c=l[a.url];c.removeAllEventListeners(),c.close(),this._poolLoader(c),delete k[a.url],delete l[a.url],q[a.url]?q[a.url]++:q[a.url]=1,q[a.url]>3?this._loadDone(a,null):(p--,j.push(a),this._tryNextLoad())},h._onLoadProgress=function(a,b){a.progress=b.progress,a.updateCallback&&a.updateCallback(a.progress)},h._onLoadCompleted=function(a,b){var c=l[a.url];c.removeAllEventListeners(),c.close(),this._poolLoader(c),delete k[a.url],delete l[a.url],this._loadDone(a,this._getResult(b.result,a.url,c))},h._tryNextLoad=function(){if(!(p>this.maxSimultaneousLoads-1||0===j.length)){p++;var a=j.shift();k[a.url]=a;var b=this._getLoader(a.basePath);l[a.url]=b,b.addEventListener("fileload",a._boundComplete),b.addEventListener("error",a._boundFail),b.addEventListener("fileprogress",a._boundProgress);var c=this.cacheManager.prepare(a.url);b.loadFile(a.data?{id:a.data.id,src:c,data:a.data}:c)}},h._loadDone=function(a,b){p--,a.data&&b&&(b.id=a.data.id),a.callback(b),this._poolQI(a),this._tryNextLoad()},h.cancel=function(a){var b=k[a],c=l[a];if(b&&c)return c.close(),delete l[a],delete k[b.url],p--,this._poolLoader(c),this._poolQI(b),!0;for(var d=0,e=j.length;e>d;d++)if(b=j[d],b.url==a)return j.splice(d,1),this._poolQI(b),!0;return!1},h._getQI=function(){var b;return m.length?b=m.pop():(b=new a,b._boundFail=this._onLoadFailed.bind(this,b),b._boundProgress=this._onLoadProgress.bind(this,b),b._boundComplete=this._onLoadCompleted.bind(this,b)),b},h._poolQI=function(a){m.push(a),a.callback=a.updateCallback=a.data=a.url=null,a.progress=0},h._getLoader=function(a){var b;return n.length?(b=n.pop(),b._basePath=a):b=new e(!0,a),d&&b.installPlugin(d),b},h._poolLoader=function(a){a.removeAll(),n.push(a)},h._getResult=function(a,b,c){var d;return o.length?(d=o.pop(),d.content=a,d.url=b,d.loader=c):d=new f(a,b,c),d},h._poolResult=function(a){a.content=a.url=a.loader=a.id=null,o.push(a)},namespace("cloudkid").MediaLoader=g,namespace("cloudkid").Loader=g}(),function(){var a=function(a,b,c){this.content=a,this.url=b,this.loader=c},b=a.prototype;b.toString=function(){return"[LoaderResult('"+this.url+"')]"},b.destroy=function(){this.callback=null,this.url=null,this.content=null},namespace("cloudkid").MediaLoaderResult=a,namespace("cloudkid").LoaderResult=a}(),function(){var a=function(a,b,c,d){b[c]?b[d]=a:a()};a.create=function(b,c,d,e){return a.bind(this,b,c,d,e)},namespace("cloudkid").CombinedCallback=a}(),function(a){var b={},c=window.Storage!==a,d=-1;if(c)try{localStorage.setItem("LS_TEST","test"),localStorage.removeItem("LS_TEST")}catch(e){c=!1}b.remove=function(a){c?(localStorage.removeItem(a),sessionStorage.removeItem(a)):b.write(a,"",d)},b.write=function(a,b,e){if(c)e?sessionStorage.setItem(a,JSON.stringify(b)):localStorage.setItem(a,JSON.stringify(b));else{var f;f=e?e!==d?"":"; expires=Thu, 01 Jan 1970 00:00:00 GMT":"; expires="+new Date(2147483646e3).toGMTString(),document.cookie=a+"="+escape(JSON.stringify(b))+f+"; path=/"}},b.read=function(a){if(c){var b=localStorage.getItem(a)||sessionStorage.getItem(a);return b?JSON.parse(b):null}var d,e=a+"=",f=document.cookie.split(";"),g=0;for(g=0;g<f.length;g++){for(d=f[g];" "==d.charAt(0);)d=d.substring(1,d.length);if(0===d.indexOf(e))return JSON.parse(unescape(d.substring(e.length,d.length)))}return null},namespace("cloudkid").SavedData=b}(),function(a){var b=include("cloudkid.Application"),c=function(c,d,e,f){this._callback=c,this._delay=d,this._timer=d,this._repeat=!!e,this._autoDestroy=f===a?!0:!!f,this._paused=!1,this._update=this._update.bind(this),b.instance.on("update",this._update)},d=c.prototype;d._update=function(a){return this._callback?(this._timer-=a,void(this._timer<=0&&(this._callback(),this._repeat?this._timer+=this._delay:this._autoDestroy?this.destroy():b.instance.off("update",this._update)))):void this.destroy()},d.restart=function(){if(this._callback){var a=b.instance;a.has("update",this._update)||a.on("update",this._update),this._timer=this._delay,this._paused=!1}},d.stop=function(){b.instance.off("update",this._update),this._paused=!1},Object.defineProperty(d,"paused",{get:function(){return this._paused},set:function(a){if(this._callback){var c=b.instance;this._paused&&!a?(this._paused=!1,c.has("update",this._update)||c.on("update",this._update)):a&&c.has("update",this._update)&&(this._paused=!0,c.off("update",this._update))}}}),d.destroy=function(){b.instance.off("update",this._update),this._callback=null},namespace("cloudkid").DelayedCall=c}();}();